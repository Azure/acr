<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>AAD Integration | Azure Container Registry</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/acr/assets/css/0.styles.1adce09e.css" as="style"><link rel="preload" href="/acr/assets/js/app.3ca3959d.js" as="script"><link rel="preload" href="/acr/assets/js/2.4abe739f.js" as="script"><link rel="preload" href="/acr/assets/js/13.88956df0.js" as="script"><link rel="prefetch" href="/acr/assets/js/10.080d8072.js"><link rel="prefetch" href="/acr/assets/js/11.a8cae62e.js"><link rel="prefetch" href="/acr/assets/js/12.e62ede07.js"><link rel="prefetch" href="/acr/assets/js/14.da996b77.js"><link rel="prefetch" href="/acr/assets/js/15.128615bf.js"><link rel="prefetch" href="/acr/assets/js/16.28bd344b.js"><link rel="prefetch" href="/acr/assets/js/17.3154ce14.js"><link rel="prefetch" href="/acr/assets/js/18.1a01df13.js"><link rel="prefetch" href="/acr/assets/js/19.d6cd2dad.js"><link rel="prefetch" href="/acr/assets/js/20.3cb003a6.js"><link rel="prefetch" href="/acr/assets/js/21.b60fd558.js"><link rel="prefetch" href="/acr/assets/js/22.7d86dba4.js"><link rel="prefetch" href="/acr/assets/js/23.dd656471.js"><link rel="prefetch" href="/acr/assets/js/24.e228cfdd.js"><link rel="prefetch" href="/acr/assets/js/25.197c3531.js"><link rel="prefetch" href="/acr/assets/js/26.29caa7ed.js"><link rel="prefetch" href="/acr/assets/js/27.fb8da073.js"><link rel="prefetch" href="/acr/assets/js/28.6e4543d4.js"><link rel="prefetch" href="/acr/assets/js/29.a76509db.js"><link rel="prefetch" href="/acr/assets/js/3.f910cf4c.js"><link rel="prefetch" href="/acr/assets/js/30.994ccbbb.js"><link rel="prefetch" href="/acr/assets/js/31.f2c11b52.js"><link rel="prefetch" href="/acr/assets/js/32.840e79d8.js"><link rel="prefetch" href="/acr/assets/js/33.2df67567.js"><link rel="prefetch" href="/acr/assets/js/34.e38730f2.js"><link rel="prefetch" href="/acr/assets/js/35.46229160.js"><link rel="prefetch" href="/acr/assets/js/36.9f898214.js"><link rel="prefetch" href="/acr/assets/js/37.9c3a93a2.js"><link rel="prefetch" href="/acr/assets/js/38.2cbce8d9.js"><link rel="prefetch" href="/acr/assets/js/39.f4bfa261.js"><link rel="prefetch" href="/acr/assets/js/4.1d1d93b6.js"><link rel="prefetch" href="/acr/assets/js/40.bc1f46d1.js"><link rel="prefetch" href="/acr/assets/js/41.2dbb6a30.js"><link rel="prefetch" href="/acr/assets/js/42.84fa6a12.js"><link rel="prefetch" href="/acr/assets/js/43.428cb1ec.js"><link rel="prefetch" href="/acr/assets/js/44.3b6b967d.js"><link rel="prefetch" href="/acr/assets/js/45.fd0d1d9e.js"><link rel="prefetch" href="/acr/assets/js/46.19cb06fd.js"><link rel="prefetch" href="/acr/assets/js/47.8c0d7628.js"><link rel="prefetch" href="/acr/assets/js/48.619e29e6.js"><link rel="prefetch" href="/acr/assets/js/49.3ba8bd2c.js"><link rel="prefetch" href="/acr/assets/js/5.943fad70.js"><link rel="prefetch" href="/acr/assets/js/50.0c02f626.js"><link rel="prefetch" href="/acr/assets/js/51.b822281a.js"><link rel="prefetch" href="/acr/assets/js/52.9a8a029d.js"><link rel="prefetch" href="/acr/assets/js/53.57ca9884.js"><link rel="prefetch" href="/acr/assets/js/54.86e09cf3.js"><link rel="prefetch" href="/acr/assets/js/55.21039511.js"><link rel="prefetch" href="/acr/assets/js/56.b6f67eae.js"><link rel="prefetch" href="/acr/assets/js/57.0266cf09.js"><link rel="prefetch" href="/acr/assets/js/58.249e8925.js"><link rel="prefetch" href="/acr/assets/js/59.a2f8607d.js"><link rel="prefetch" href="/acr/assets/js/6.c89b0c48.js"><link rel="prefetch" href="/acr/assets/js/60.f13d2f1c.js"><link rel="prefetch" href="/acr/assets/js/7.cf63200c.js"><link rel="prefetch" href="/acr/assets/js/8.9e525704.js"><link rel="prefetch" href="/acr/assets/js/9.b9ebe781.js">
    <link rel="stylesheet" href="/acr/assets/css/0.styles.1adce09e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/acr/" class="home-link router-link-active"><img src="/acr/files/acr.svg" alt="Azure Container Registry" class="logo"> <span class="site-name can-hide">Azure Container Registry</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/azure/acr" target="_blank" rel="noopener noreferrer" class="repo-link">
    Star this Repo
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/azure/acr" target="_blank" rel="noopener noreferrer" class="repo-link">
    Star this Repo
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/acr/" aria-current="page" class="sidebar-link">Overview</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acr/#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/acr/#blog-posts" class="sidebar-link">Blog posts</a></li><li class="sidebar-sub-header"><a href="/acr/#links" class="sidebar-link">Links</a></li></ul></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Teleport</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Tasks</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Authentication</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/acr/AAD-OAuth.html" aria-current="page" class="active sidebar-link">AAD Integration</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acr/AAD-OAuth.html#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/acr/AAD-OAuth.html#authenticating-to-a-registry-with-azure-cli" class="sidebar-link">Authenticating to a registry with Azure CLI</a></li><li class="sidebar-sub-header"><a href="/acr/AAD-OAuth.html#listing-a-repository-with-azure-cli" class="sidebar-link">Listing a repository with Azure CLI</a></li><li class="sidebar-sub-header"><a href="/acr/AAD-OAuth.html#calling-post-oauth2-exchange-to-get-an-acr-refresh-token" class="sidebar-link">Calling POST /oauth2/exchange to get an ACR refresh token</a></li><li class="sidebar-sub-header"><a href="/acr/AAD-OAuth.html#authenticating-docker-with-an-acr-refresh-token" class="sidebar-link">Authenticating docker with an ACR refresh token</a></li><li class="sidebar-sub-header"><a href="/acr/AAD-OAuth.html#calling-post-oauth2-token-to-get-an-acr-access-token" class="sidebar-link">Calling POST /oauth2/token to get an ACR access token</a></li><li class="sidebar-sub-header"><a href="/acr/AAD-OAuth.html#calling-post-oauth2-token-to-get-an-acr-access-token-for-helm-repository" class="sidebar-link">Calling POST /oauth2/token to get an ACR access token for Helm repository</a></li><li class="sidebar-sub-header"><a href="/acr/AAD-OAuth.html#calling-an-azure-container-registry-api" class="sidebar-link">Calling an Azure Container Registry API</a></li><li class="sidebar-sub-header"><a href="/acr/AAD-OAuth.html#samples-api-call-scripts" class="sidebar-link">Samples API Call scripts</a></li></ul></li><li><a href="/acr/Token-BasicAuth.html" class="sidebar-link">Token with Basic Auth</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acr/Token-BasicAuth.html#using-the-token-api" class="sidebar-link">Using the token API</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Integration</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="azure-container-registry-integration-with-azure-active-directory"><a href="#azure-container-registry-integration-with-azure-active-directory" class="header-anchor">#</a> Azure Container Registry integration with Azure Active Directory</h1> <ul><li><a href="#azure-container-registry-integration-with-azure-active-directory">Azure Container Registry integration with Azure Active Directory</a> <ul><li><a href="#overview">Overview</a></li> <li><a href="#authenticating-to-a-registry-with-azure-cli">Authenticating to a registry with Azure CLI</a></li> <li><a href="#listing-a-repository-with-azure-cli">Listing a repository with Azure CLI</a></li></ul></li> <li><a href="#azure-container-registry-token-claim-sets">Azure Container Registry token claim sets</a></li> <li><a href="#getting-credentials-programmatically">Getting credentials programmatically</a> <ul><li><a href="#calling-post-oauth2exchange-to-get-an-acr-refresh-token">Calling <code>POST /oauth2/exchange</code> to get an ACR refresh token</a></li> <li><a href="#authenticating-docker-with-an-acr-refresh-token">Authenticating docker with an ACR refresh token</a></li> <li><a href="#calling-post-oauth2token-to-get-an-acr-access-token">Calling <code>POST /oauth2/token</code> to get an ACR access token</a></li> <li><a href="#calling-post-oauth2token-to-get-an-acr-access-token-for-helm-repository">Calling <code>POST /oauth2/token</code> to get an ACR access token for Helm repository</a></li> <li><a href="#calling-an-azure-container-registry-api">Calling an Azure Container Registry API</a> <ul><li><a href="#catalog-listing">Catalog Listing</a> <ul><li><a href="#pagination">Pagination</a></li></ul></li> <li><a href="#tag-listing">Tag Listing</a> <ul><li><a href="#pagination-1">Pagination</a></li></ul></li></ul></li> <li><a href="#samples-api-call-scripts">Samples API Call scripts</a> <ul><li><a href="#catalog-listing-with-aad-refresh-token">Catalog Listing with AAD refresh token</a></li> <li><a href="#catalog-listing-using-spadmin-with-basic-auth">Catalog listing using SP/Admin with Basic Auth</a></li> <li><a href="#catalog-listing-using-admin-keys-with-bearer-auth">Catalog listing using Admin Keys with Bearer Auth</a></li> <li><a href="#docker-login-with-acr-access-token---single-repository-scope">Docker login with ACR Access Token - Single repository scope</a></li> <li><a href="#fetch-helm-indexyaml-with-admin-keys-or-sp-with-basic-auth">Fetch helm index.yaml with Admin Keys or SP with Basic Auth</a></li></ul></li></ul></li></ul> <h2 id="overview"><a href="#overview" class="header-anchor">#</a> Overview</h2> <p>The Azure Container Registry allows users to manage a private Docker registry on the cloud. Our service enables customers to store and manage container images across all types of Azure deployments, keep container images near deployments to reduce latency and costs, maintain Windows and Linux container images in a single Docker registry, use familiar, open-source Docker command line interface (CLI) tools, and simplify registry access management with Azure Active Directory.</p> <p>The integration of Azure Container Registry with Azure Active Directory is crucial in order to enable transparent authentication and authorization of users and headless services using AAD credentials. In this scenario, a user will only have to use their AAD credentials to log-in to their private registry, and the Azure Container Service will take care of the authorization validation of each operation using the provided credentials.</p> <p>Under the hood Azure Container Service utilizes the <a href="https://oauth.net/2/" target="_blank" rel="noopener noreferrer">oauth2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> authorization protocol, as described by the <a href="https://docs.docker.com/registry/spec/auth/token/" target="_blank" rel="noopener noreferrer">Docker Registry v2 authentication via central service documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> as well as the <a href="https://docs.docker.com/registry/spec/auth/jwt/" target="_blank" rel="noopener noreferrer">Docker Registry v2 Bearer token specification<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. The JWT tokens generated by the Azure Container Registry are easy to observe in <a href="https://jwt.ms/" target="_blank" rel="noopener noreferrer">jwt.ms<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="authenticating-to-a-registry-with-azure-cli"><a href="#authenticating-to-a-registry-with-azure-cli" class="header-anchor">#</a> Authenticating to a registry with Azure CLI</h2> <p>The process to log in to the registry, from the user's perspective, is simple. The user will use the Microsoft Azure CLI 2.0:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>az acr login -n contosoregistry
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Internally, the CLI will follow these steps:</p> <ol><li>Calls to Azure Resource Manager to resolve the login server for the specified registry.</li> <li>Obtains refresh credentials from the profile in use. For a headless call, this will give you the registered SPN, for a regular user this will give you a refresh token.</li> <li>Makes an HTTPS GET call to the registry server's <code>/v2</code> endpoint, without credentials. A bearer token authentication challenge is expected, specifying realm and service values. The realm contains the authentication server's URL.</li> <li>Makes an HTTPS POST call to the authentication server's <code>POST /oauth2/exchange</code> endpoint, with a body indicating the grant type, the service, the tenant, and the credentials.</li> <li>From the server's response, we extract an Azure Container Registry refresh token.</li> <li>Pass the refresh token as the password to the Docker CLI, using a null GUID as the username and calling <code>docker login</code>. From here on, the docker CLI takes care of the authorization cycle using oauth2.</li></ol> <p>At the end Docker will store the refresh token and go through the oauth2 flow on each operation it does against the Azure Container Registry.</p> <h2 id="listing-a-repository-with-azure-cli"><a href="#listing-a-repository-with-azure-cli" class="header-anchor">#</a> Listing a repository with Azure CLI</h2> <p>The Microsoft Azure CLI 2.0 allows users to also list the repositories registries, and list tags for a repository in a registry. Here's how users can achieve listing the repositories in a registry:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>az acr repository list -n contosoregistry
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Internally, the CLI will follow these steps:</p> <ol><li>Calls to Azure Resource Manager to resolve the login server for the specified registry.</li> <li>Obtains refresh credentials from the profile in use. For a headless call, this will give you the registered SPN, for a regular user this will give you a refresh token.</li> <li>Makes an HTTPS GET call to the registry server's <code>/v2</code> endpoint, without credentials. A bearer token authentication challenge is expected, specifying realm and service values. The realm contains the authentication server's URL.</li> <li>Makes an HTTPS POST call to the authentication server's <code>POST /oauth2/exchange</code> endpoint, with a body indicating the grant type, the service, the tenant, and the credentials.</li> <li>From the server's response we extract an Azure Container Registry refresh token.</li> <li>Makes an HTTPS POST call to the authentication server's <code>POST /oauth2/token</code> endpoint, with a body indicating the grant type, the service, the scope, and the Azure Container Registry refresh token.</li> <li>From the server's response we extract an Azure Container Registry access token.</li> <li>Makes an HTTPS GET call to the registry server's <code>GET /v2/_catalog</code> endpoint using the access token as the bearer token.</li> <li>Obtains the data from the service and displays it.</li></ol> <p>When listing the tags of a repository, every step above is the same except for the call to the endpoint that gives the tags which is <code>GET /v2/contosoregistry/tags/list</code> instead of <code>GET /v2/_catalog</code>.</p> <h1 id="azure-container-registry-token-claim-sets"><a href="#azure-container-registry-token-claim-sets" class="header-anchor">#</a> Azure Container Registry token claim sets</h1> <p>Following the command of repository list in the previous section:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>az acr repository list -n contosoregistry
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>A JWT refresh token extracted at step 5 has the following claim set:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;jti&quot;</span><span class="token operator">:</span> <span class="token string">&quot;365e3b5b-844e-4a21-a38c-4d8aebdd6a06&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;sub&quot;</span><span class="token operator">:</span> <span class="token string">&quot;user@contoso.com&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;nbf&quot;</span><span class="token operator">:</span> <span class="token number">1497988712</span><span class="token punctuation">,</span>
  <span class="token property">&quot;exp&quot;</span><span class="token operator">:</span> <span class="token number">1497990801</span><span class="token punctuation">,</span>
  <span class="token property">&quot;iat&quot;</span><span class="token operator">:</span> <span class="token number">1497988712</span><span class="token punctuation">,</span>
  <span class="token property">&quot;iss&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Azure Container Registry&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;aud&quot;</span><span class="token operator">:</span> <span class="token string">&quot;contosoregistry.azurecr.io&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;grant_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;refresh_token&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;tenant&quot;</span><span class="token operator">:</span> <span class="token string">&quot;409520d4-8100-4d1d-ad47-72432ddcc120&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;permissions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;actions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;*&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;notActions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;roles&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>Followed by an access token at step 7 with the following claim set:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;jti&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ec425c1e-7eda-4f70-adb5-19f927e34a41&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;sub&quot;</span><span class="token operator">:</span> <span class="token string">&quot;user@contoso.com&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;nbf&quot;</span><span class="token operator">:</span> <span class="token number">1497988907</span><span class="token punctuation">,</span>
  <span class="token property">&quot;exp&quot;</span><span class="token operator">:</span> <span class="token number">1497993407</span><span class="token punctuation">,</span>
  <span class="token property">&quot;iat&quot;</span><span class="token operator">:</span> <span class="token number">1497988907</span><span class="token punctuation">,</span>
  <span class="token property">&quot;iss&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Azure Container Registry&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;aud&quot;</span><span class="token operator">:</span> <span class="token string">&quot;contosoregistry.azurecr.io&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;access&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;registry&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;catalog&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;actions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;*&quot;</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;roles&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;grant_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;access_token&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h1 id="getting-credentials-programmatically"><a href="#getting-credentials-programmatically" class="header-anchor">#</a> Getting credentials programmatically</h1> <p>In order to sign in to a container you'll need to exchange AAD credentials for ACR credentials. The accepted form of credential exchange are:</p> <ul><li>AAD access token.</li> <li>[Deprecated] AAD refresh token.</li> <li>[Deprecated] AAD access token and refresh token.</li></ul> <p>The AAD access token is used to talk to the Azure Resource Manager and query for the set of permissions that the user has for the container registry resource.</p> <p>[Deprecated] The AAD refresh token is used in two ways:</p> <ol><li>If no AAD access token was presented, the AAD refresh token is used to obtain an AAD access token.</li> <li>The AAD refresh token is sent back to the user so they can initiate a token refresh cycle against AAD. If no AAD refresh token is sent, then the client won't have this credential at hand to initiate a credential refresh.</li></ol> <p>The cycle to get credentials looks as follows:</p> <ol><li>Call <code>POST /oauth2/exchange</code> presenting the AAD access token or the AAD refresh token [Deprecated]. The service will return you an ACR refresh token.</li> <li>Call <code>POST /oauth2/token</code> presenting the ACR refresh token. The service will return you an ACR access token which you can use to call the Azure Container Registry's APIs.</li></ol> <h2 id="calling-post-oauth2-exchange-to-get-an-acr-refresh-token"><a href="#calling-post-oauth2-exchange-to-get-an-acr-refresh-token" class="header-anchor">#</a> Calling <code>POST /oauth2/exchange</code> to get an ACR refresh token</h2> <p>In this example, we'll try to obtain an ACR refresh token from existing AAD tokens. Assume you have the following:</p> <ol><li>A valid container registry, which here we'll call <code>contosoregistry.azurecr.io</code>.</li> <li>The AAD tenant identifier associated to the credentials, which here we'll take to be <code>409520d4-8100-4d1d-ad47-72432ddcc120</code>.</li> <li>Valid AAD access token credential with access to the aforementioned container registry.</li></ol> <p>The AAD access token can be obtained from the Azure CLI. After running <code>az login</code> check file <code>$HOME/.azure/accessTokens.json</code> (<code>%HOMEDRIVE%%HOMEPATH%\.azure\accessTokens.json</code> in Windows) for the token values.</p> <p>We'll now call <code>POST /oauth2/exchange</code> to exchange the AAD tokens for an ACR refresh token. Here's how such a call looks when done via <code>curl</code>:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">registry</span><span class="token operator">=</span><span class="token string">&quot;contosoregistry.azurecr.io&quot;</span>
<span class="token assign-left variable">tenant</span><span class="token operator">=</span><span class="token string">&quot;409520d4-8100-4d1d-ad47-72432ddcc120&quot;</span>
<span class="token assign-left variable">aad_access_token</span><span class="token operator">=</span><span class="token string">&quot;eyJ...H-g&quot;</span>
<span class="token function">curl</span> -v -X POST -H <span class="token string">&quot;Content-Type: application/x-www-form-urlencoded&quot;</span> -d <span class="token punctuation">\</span>
    <span class="token string">&quot;grant_type=access_token&amp;service=<span class="token variable">$registry</span>&amp;tenant=<span class="token variable">$tenant</span>&amp;access_token=<span class="token variable">$aad_access_token</span>&quot;</span> <span class="token punctuation">\</span>
    https://<span class="token variable">$registry</span>/oauth2/exchange
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>The body of the POST message is a querystring-like text that specifies the following values:</p> <ul><li><code>grant_type</code>, which can take a value of <code>access_token</code>, or <code>access_token_refresh_token</code> [Deprecated], or <code>refresh_token</code> [Deprecated].</li> <li><code>service</code>, which must indicate the name of your Azure container registry.</li> <li><code>tenant</code>, which is the AAD tenant associated to the AAD credentials.</li> <li><code>access_token</code>, the AAD access token, mandatory when <code>grant_type</code> is <code>access_token</code> or <code>access_token_refresh_token</code> [Deprecated].</li> <li>[Deprecated] <code>refresh_token</code>, the AAD refresh token, mandatory when <code>grant_type</code> is <code>access_token_refresh_token</code> or <code>refresh_token</code>.</li></ul> <p>The outcome of this operation will be a response with status 200 OK and a body with the following JSON payload:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;refresh_token&quot;</span><span class="token operator">:</span><span class="token string">&quot;eyJ...L7a&quot;</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>This response is the ACR refresh token which you can inspect with <a href="https://jwt.ms/" target="_blank" rel="noopener noreferrer">jwt.ms<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. You can now use it to obtain an ACR access token programmatically or simply send it to the <code>docker login</code> command to get docker talking to the Azure Container Registry.</p> <h2 id="authenticating-docker-with-an-acr-refresh-token"><a href="#authenticating-docker-with-an-acr-refresh-token" class="header-anchor">#</a> Authenticating docker with an ACR refresh token</h2> <p>Once you have obtained an ACR refresh token, you can use the docker CLI to sign in to your registry like this:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">registry</span><span class="token operator">=</span><span class="token string">&quot;contosoregistry.azurecr.io&quot;</span>
<span class="token assign-left variable">acr_username</span><span class="token operator">=</span><span class="token string">&quot;00000000-0000-0000-0000-000000000000&quot;</span>
<span class="token assign-left variable">acr_refresh_token</span><span class="token operator">=</span><span class="token string">&quot;eyJ...L7a&quot;</span>
<span class="token function">docker</span> login -u <span class="token string">&quot;<span class="token variable">$acr_username</span>&quot;</span> -p <span class="token string">&quot;<span class="token variable">$acr_refresh_token</span>&quot;</span> <span class="token variable">$registry</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>The null GUID tells the container registry that this is an ACR refresh token during the login flow. Once the authentication succeeds you can talk to the Azure Container Registry with commands like <code>docker pull</code> and <code>docker push</code>. For example:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> pull contosoregistry.azurecr.io/contoso-marketing
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Notice that the ACR refresh token will be saved by the docker CLI in its credential store, and will be used by the docker CLI to obtain an ACR access token on each operation it performs against the Azure Container Registry. The ACR refresh token is made so it stops working after a period of time, but if you obtained it using either <code>grant_type=access_token_refresh_token</code> or <code>grant_type=refresh_token</code> then it can be refreshed automatically by installing the <a href="https://github.com/azure/acr-docker-credential-helper" target="_blank" rel="noopener noreferrer">ACR docker credential helper<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="calling-post-oauth2-token-to-get-an-acr-access-token"><a href="#calling-post-oauth2-token-to-get-an-acr-access-token" class="header-anchor">#</a> Calling <code>POST /oauth2/token</code> to get an ACR access token</h2> <p>In this example, we'll try to obtain an ACR access token from existing ACR refresh token, and this access token will only work for the operation we're trying to perform, which is a call to the <code>GET /v2/_catalog</code> API. Assume you have the following:</p> <ol><li>A valid container registry, which here we'll call <code>contosoregistry.azurecr.io</code>.</li> <li>A valid ACR refresh token.</li></ol> <p>The first thing you want is to obtain an authentication challenge for the operation you want to on the Azure Container Registry. That can be done by targetting the API you want to call without any authentication. Here's how to do that via <code>curl</code>:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">registry</span><span class="token operator">=</span><span class="token string">&quot;contosoregistry.azurecr.io&quot;</span>
<span class="token function">curl</span> -v https://<span class="token variable">$registry</span>/v2/_catalog
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Note that <code>curl</code> by default does the request as a <code>GET</code> unless you specify a different verb with the <code>-X</code> modifier.</p> <p>This will output the following payload, with <code>...</code> used to shorten it for illustrative purposes:</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code>&lt; HTTP/1.1 401 Unauthorized
...
&lt; Www-Authenticate: Bearer realm=&quot;https://contosoregistry.azurecr.io/oauth2/token&quot;,service=&quot;contosoregistry.azurecr.io&quot;,scope=&quot;registry:catalog:*&quot;
...
{&quot;errors&quot;:[{&quot;code&quot;:&quot;UNAUTHORIZED&quot;,&quot;message&quot;:&quot;authentication required&quot;,&quot;detail&quot;:[{&quot;Type&quot;:&quot;registry&quot;,&quot;Name&quot;:&quot;catalog&quot;,&quot;Action&quot;:&quot;*&quot;}]}]}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Notice the response payload has a header called <code>Www-Authenticate</code> that gives us the following information:</p> <ul><li>The type of challenge: <code>Bearer</code>.</li> <li>The realm of the challenge: <code>https://contosoregistry.azurecr.io/oauth2/token</code>.</li> <li>The service of the challenge: <code>contosoregistry.azurecr.io</code>.</li> <li>The scope of the challenge: <code>registry:catalog:*</code>.</li></ul> <p>The body of the payload might provide additional details, but all the information you need is contained in the <code>Www-Authenticate</code> header.</p> <p>With this information we're now ready to call <code>POST /oauth2/token</code> to obtain an ACR access token that will allow us to use the <code>GET /v2/_catalog</code> API. Here's how such a call looks when done via <code>curl</code>:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">registry</span><span class="token operator">=</span><span class="token string">&quot;contosoregistry.azurecr.io&quot;</span>
<span class="token assign-left variable">acr_refresh_token</span><span class="token operator">=</span><span class="token string">&quot;eyJ...L7a&quot;</span>
<span class="token assign-left variable">scope</span><span class="token operator">=</span><span class="token string">&quot;registry:catalog:*&quot;</span>
<span class="token function">curl</span> -v -X POST -H <span class="token string">&quot;Content-Type: application/x-www-form-urlencoded&quot;</span> -d <span class="token punctuation">\</span>
<span class="token string">&quot;grant_type=refresh_token&amp;service=<span class="token variable">$registry</span>&amp;scope=<span class="token variable">$scope</span>&amp;refresh_token=<span class="token variable">$acr_refresh_token</span>&quot;</span> <span class="token punctuation">\</span>
https://<span class="token variable">$registry</span>/oauth2/token
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>The body of the POST message is a querystring-like text that specifies the following values:</p> <ul><li><code>grant_type</code> which is expected to be <code>refresh_token</code>.</li> <li><code>service</code>, which must indicate the name of your Azure container registry. You obtained this from the <code>Www-Authenticate</code> response header from the challenge.</li> <li><code>scope</code>, which is expected to be a valid <a href="https://docs.docker.com/registry/spec/auth/scope/" target="_blank" rel="noopener noreferrer">scope<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, and can be specified more than once for multiple scope requests. You obtained this from the <code>Www-Authenticate</code> response header from the challenge.</li> <li><code>refresh_token</code>, which must be a valid ACR refresh token, as obtained by calling <code>POST /oauth2/exchange</code>.</li></ul> <p>The outcome of this operation will be a response with status 200 OK and a body with the following JSON payload:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;access_token&quot;</span><span class="token operator">:</span><span class="token string">&quot;eyJ...xcg&quot;</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>This response is the ACR access token which you can inspect with <a href="https://jwt.ms/" target="_blank" rel="noopener noreferrer">jwt.ms<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. You can now use it to call APIs exposed by the Azure Container Registry</p> <h2 id="calling-post-oauth2-token-to-get-an-acr-access-token-for-helm-repository"><a href="#calling-post-oauth2-token-to-get-an-acr-access-token-for-helm-repository" class="header-anchor">#</a> Calling <code>POST /oauth2/token</code> to get an ACR access token for Helm repository</h2> <p>In this example, we'll try to obtain an ACR access token from existing ACR refresh token to access Helm repository, and this access token will only work for the operation we're trying to perform, which is a call to the <code>GET /helm/v1/repo/index.yaml</code> API. Assume you have the following:</p> <ol><li>A valid container registry, which here we'll call <code>contosoregistry.azurecr.io</code>.</li> <li>A valid ACR refresh token.</li></ol> <p>The first thing you want is to obtain an authentication challenge for the operation you want to on the Azure Container Registry. That can be done by targetting the API you want to call without any authentication. Here's how to do that via <code>curl</code>:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">registry</span><span class="token operator">=</span><span class="token string">&quot;contosoregistry.azurecr.io&quot;</span>
<span class="token function">curl</span> -v https://<span class="token variable">$registry</span>/helm/v1/repo/index.yaml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Note that <code>curl</code> by default does the request as a <code>GET</code> unless you specify a different verb with the <code>-X</code> modifier.</p> <p>This will output the following payload, with <code>...</code> used to shorten it for illustrative purposes:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token operator">&lt;</span> HTTP/1.1 <span class="token number">401</span> Unauthorized
<span class="token punctuation">..</span>.
<span class="token operator">&lt;</span> Www-Authenticate: Bearer <span class="token assign-left variable">realm</span><span class="token operator">=</span><span class="token string">&quot;https://contosoregistry.azurecr.io/oauth2/token&quot;</span>,service<span class="token operator">=</span><span class="token string">&quot;contosoregistry.azurecr.io&quot;</span>,scope<span class="token operator">=</span><span class="token string">&quot;artifact-repository:repo:pull&quot;</span>
<span class="token punctuation">..</span>.
<span class="token punctuation">{</span><span class="token string">&quot;errors&quot;</span>:<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;code&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;UNAUTHORIZED&quot;</span>,<span class="token string">&quot;message&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;authentication required&quot;</span>,<span class="token string">&quot;detail&quot;</span>:<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;Type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;artifact-repository&quot;</span>,<span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;repo&quot;</span>,<span class="token string">&quot;Action&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;pull&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Notice the response payload has a header called <code>Www-Authenticate</code> that gives us the following information:</p> <ul><li>The type of challenge: <code>Bearer</code>.</li> <li>The realm of the challenge: <code>https://contosoregistry.azurecr.io/oauth2/token</code>.</li> <li>The service of the challenge: <code>contosoregistry.azurecr.io</code>.</li> <li>The scope of the challenge: <code>artifact-repository:repo:pull</code>.</li></ul> <p>The body of the payload might provide additional details, but all the information you need is contained in the <code>Www-Authenticate</code> header.</p> <p>With this information we're now ready to call <code>POST /oauth2/token</code> to obtain an ACR access token that will allow us to use the <code>GET /helm/v1/repo/index.yaml</code> API. Here's how such a call looks when done via <code>curl</code>:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">registry</span><span class="token operator">=</span><span class="token string">&quot;contosoregistry.azurecr.io&quot;</span>
<span class="token assign-left variable">acr_refresh_token</span><span class="token operator">=</span><span class="token string">&quot;eyJ...L7a&quot;</span>
<span class="token assign-left variable">scope</span><span class="token operator">=</span><span class="token string">&quot;artifact-repository:repo:pull&quot;</span>
<span class="token function">curl</span> -v -X POST -H <span class="token string">&quot;Content-Type: application/x-www-form-urlencoded&quot;</span> -d <span class="token punctuation">\</span>
<span class="token string">&quot;grant_type=refresh_token&amp;service=<span class="token variable">$registry</span>&amp;scope=<span class="token variable">$scope</span>&amp;refresh_token=<span class="token variable">$acr_refresh_token</span>&quot;</span> <span class="token punctuation">\</span>
https://<span class="token variable">$registry</span>/oauth2/token
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>The body of the POST message is a querystring-like text that specifies the following values:</p> <ul><li><code>grant_type</code> which is expected to be <code>refresh_token</code>.</li> <li><code>service</code>, which must indicate the name of your Azure container registry. You obtained this from the <code>Www-Authenticate</code> response header from the challenge.</li> <li><code>scope</code>, which is expected to be a <code>artifact-repository:repo:pull</code> for read operations and <code>artifact-repository:repo:*</code> for write operations, and can be specified more than once for multiple scope requests. You obtained this from the <code>Www-Authenticate</code> response header from the challenge.</li> <li><code>refresh_token</code>, which must be a valid ACR refresh token, as obtained by calling <code>POST /oauth2/exchange</code>.</li></ul> <p>The outcome of this operation will be a response with status 200 OK and a body with the following JSON payload:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;access_token&quot;</span><span class="token operator">:</span><span class="token string">&quot;eyJ...xcg&quot;</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>This response is the ACR access token which you can inspect with <a href="https://jwt.ms/" target="_blank" rel="noopener noreferrer">jwt.ms<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. You can now use it to call APIs exposed by the Azure Container Registry. Refer the full script to <a href="#fetch-helm-indexyaml">fetch the helm index.yaml</a>.</p> <h2 id="calling-an-azure-container-registry-api"><a href="#calling-an-azure-container-registry-api" class="header-anchor">#</a> Calling an Azure Container Registry API</h2> <p>In this example we'll call catalog listing and tag listing APIs on an Azure Container Registry.</p> <h3 id="catalog-listing"><a href="#catalog-listing" class="header-anchor">#</a> Catalog Listing</h3> <p>Assume you have the following:</p> <ol><li>A valid container registry, which here we'll call <code>contosoregistry.azurecr.io</code>.</li> <li>A valid ACR access token, created with the correct scope for the API we're going to call.</li></ol> <p>Here's how a call to the <code>GET /v2/_catalog</code> API of the given registry would look like when done via <code>curl</code>:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">registry</span><span class="token operator">=</span><span class="token string">&quot;contosoregistry.azurecr.io&quot;</span>
<span class="token assign-left variable">acr_access_token</span><span class="token operator">=</span><span class="token string">&quot;eyJ...xcg&quot;</span>
<span class="token function">curl</span> -v -H <span class="token string">&quot;Authorization: Bearer <span class="token variable">$acr_access_token</span>&quot;</span> https://<span class="token variable">$registry</span>/v2/_catalog
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Note that <code>curl</code> by default does the request as a <code>GET</code> unless you specify a different verb with the <code>-X</code> modifier.</p> <p>This should result in a status 200 OK, and a body with a JSON payload listing the repositories held in this registry:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;repositories&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;alpine&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;contoso-marketing&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;hello-world&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;node&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="pagination"><a href="#pagination" class="header-anchor">#</a> Pagination</h4> <p>To retrieve paginated catalog results, add an <code>n</code> parameter to limit the number or results. We take <code>n=2</code> as example:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">registry</span><span class="token operator">=</span><span class="token string">&quot;contosoregistry.azurecr.io&quot;</span>
<span class="token assign-left variable">acr_access_token</span><span class="token operator">=</span><span class="token string">&quot;eyJ...xcg&quot;</span>
<span class="token assign-left variable">limit</span><span class="token operator">=</span><span class="token number">2</span>
<span class="token function">curl</span> -v -H <span class="token string">&quot;Authorization: Bearer <span class="token variable">$acr_access_token</span>&quot;</span> <span class="token string">&quot;https://<span class="token variable">$registry</span>/v2/_catalog?n=<span class="token variable">$limit</span>&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>This should result in a status 200 OK, and a body with a JSON payload listing the first <code>n</code> repositories held in this registry. If there are more results, a <code>Link</code> header containing the request URL for the next result block is also returned.  If the entire result set has been received, the <code>Link</code> header will not be returned.</p> <p>In this case, the first 2 repositories are returned, and there are more entries in the result set. The response would look like:</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code>&lt; HTTP/1.1 200 OK
...
<span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/json</span></span>
<span class="token header"><span class="token header-name keyword">Link</span><span class="token punctuation">:</span> <span class="token header-value">&lt;/v2/_catalog?last=contoso-marketing&amp;n=2&amp;orderby=&gt;; rel=&quot;next&quot;</span></span>
<span class="token application-json">
<span class="token punctuation">{</span><span class="token property">&quot;repositories&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;alpine&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;contoso-marketing&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>To get the next result block, issue the request using the <code>/v2/_catalog?last=contoso-marketing&amp;n=2&amp;orderby=</code> URL encoded in the <code>Link</code> header. Here is how the call would look like:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> -v -H <span class="token string">&quot;Authorization: Bearer <span class="token variable">$acr_access_token</span>&quot;</span> <span class="token string">&quot;https://<span class="token variable">$registry</span>/v2/_catalog?last=contoso-marketing&amp;n=2&amp;orderby=&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>You can query the paginated results in a loop, as the following shows:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">registry</span><span class="token operator">=</span><span class="token string">&quot;contosoregistry.azurecr.io&quot;</span>
<span class="token assign-left variable">acr_access_token</span><span class="token operator">=</span><span class="token string">&quot;eyJ...xcg&quot;</span>

<span class="token assign-left variable">limit</span><span class="token operator">=</span><span class="token number">2</span>
<span class="token assign-left variable">operation</span><span class="token operator">=</span>/v2/_catalog?n<span class="token operator">=</span><span class="token variable">$limit</span>

<span class="token assign-left variable">headers</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>mktemp -t headers.XXXXX<span class="token variable">)</span></span>

<span class="token keyword">while</span> <span class="token punctuation">[</span> -n <span class="token string">&quot;<span class="token variable">$operation</span>&quot;</span> <span class="token punctuation">]</span>
<span class="token keyword">do</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;Operation&quot;</span>
    <span class="token builtin class-name">echo</span> <span class="token variable">$operation</span>
    
    <span class="token assign-left variable">catalog</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> -H <span class="token string">&quot;Authorization: Bearer <span class="token variable">$acr_access_token</span>&quot;</span> <span class="token string">&quot;https://<span class="token variable">$registry</span><span class="token variable">$operation</span>&quot;</span> -D $headers<span class="token variable">)</span></span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;Catalog&quot;</span>
    <span class="token builtin class-name">echo</span> <span class="token variable">$catalog</span>
    
    <span class="token assign-left variable">operation</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> $headers <span class="token operator">|</span> <span class="token function">sed</span> -n <span class="token string">'s/^Link: &lt;\(.*\)&gt;.*/\1/p'</span><span class="token variable">)</span></span>
<span class="token keyword">done</span>
<span class="token function">rm</span> <span class="token variable">$headers</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>For more information, visit <a href="https://docs.docker.com/registry/spec/api/#listing-repositories" target="_blank" rel="noopener noreferrer">Docker V2 API Reference - Listing Repositories<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h3 id="tag-listing"><a href="#tag-listing" class="header-anchor">#</a> Tag Listing</h3> <p>Assume you have the following:</p> <ol><li>A valid container registry, which here we'll call <code>contosoregistry.azurecr.io</code>.</li> <li>A valid ACR access token, created with the correct scope for the API we're going to call.</li> <li>A valid image in the registry, for example <code>hello-world</code>.</li></ol> <p>Here's how a call to the <code>GET /v2/&lt;name&gt;/tags/list</code> API of the given image would look like when done via <code>curl</code>:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">registry</span><span class="token operator">=</span><span class="token string">&quot;contosoregistry.azurecr.io&quot;</span>
<span class="token assign-left variable">acr_access_token</span><span class="token operator">=</span><span class="token string">&quot;eyJ...xcg&quot;</span>
<span class="token assign-left variable">image</span><span class="token operator">=</span><span class="token string">&quot;hello-world&quot;</span>
<span class="token function">curl</span> -v -H <span class="token string">&quot;Authorization: Bearer <span class="token variable">$acr_access_token</span>&quot;</span> <span class="token string">&quot;https://<span class="token variable">$registry</span>/v2/<span class="token variable">$image</span>/tags/list&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Note that <code>curl</code> by default does the request as a <code>GET</code> unless you specify a different verb with the <code>-X</code> modifier.</p> <p>This should result in a status 200 OK, and a body with a JSON payload listing the tags of this image:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;hello-world&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;tags&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;latest&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;v1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;v2&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;v3&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="pagination-2"><a href="#pagination-2" class="header-anchor">#</a> Pagination</h4> <p>To retrieve paginated tag results, add an <code>n</code> parameter to limit the number or results. We take <code>n=2</code> as example:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">registry</span><span class="token operator">=</span><span class="token string">&quot;contosoregistry.azurecr.io&quot;</span>
<span class="token assign-left variable">acr_access_token</span><span class="token operator">=</span><span class="token string">&quot;eyJ...xcg&quot;</span>
<span class="token assign-left variable">image</span><span class="token operator">=</span><span class="token string">&quot;hello-world&quot;</span>
<span class="token assign-left variable">limit</span><span class="token operator">=</span><span class="token number">2</span>
<span class="token function">curl</span> -v -H <span class="token string">&quot;Authorization: Bearer <span class="token variable">$acr_access_token</span>&quot;</span> <span class="token string">&quot;https://<span class="token variable">$registry</span>/v2/<span class="token variable">$image</span>/tags/list?n=<span class="token variable">$limit</span>&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>This should result in a status 200 OK, and a body with a JSON payload listing the first <code>n</code> tags of this image. If there are more results, a <code>Link</code> header containing the request URL for the next result block is also returned.  If the entire result set has been received, the <code>Link</code> header will not be returned.</p> <p>In this case, the first 2 tags are returned, and there are more entries in the result set. The response would look like:</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code>&lt; HTTP/1.1 200 OK
...
<span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/json</span></span>
<span class="token header"><span class="token header-name keyword">Link</span><span class="token punctuation">:</span> <span class="token header-value">&lt;/v2/hello-world/tags/list?last=v1&amp;n=2&amp;orderby=&gt;; rel=&quot;next&quot;</span></span>
<span class="token application-json">
<span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;hello-world&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;tags&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;latest&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;v1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>To get the next result block, issue the request using the <code>/v2/hello-world/tags/list?last=v1&amp;n=2&amp;orderby=</code> URL encoded in the <code>Link</code> header. Here is how the call would look like:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> -v -H <span class="token string">&quot;Authorization: Bearer <span class="token variable">$acr_access_token</span>&quot;</span> <span class="token string">&quot;https://<span class="token variable">$registry</span>/v2/<span class="token variable">$image</span>/tags/list?last=v1&amp;n=2&amp;orderby=&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>You can query the paginated results in a loop, as the following shows:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">registry</span><span class="token operator">=</span><span class="token string">&quot;contosoregistry.azurecr.io&quot;</span>
<span class="token assign-left variable">acr_access_token</span><span class="token operator">=</span><span class="token string">&quot;eyJ...xcg&quot;</span>
<span class="token assign-left variable">image</span><span class="token operator">=</span><span class="token string">&quot;hello-world&quot;</span>

<span class="token assign-left variable">limit</span><span class="token operator">=</span><span class="token number">2</span>
<span class="token assign-left variable">operation</span><span class="token operator">=</span>/v2/<span class="token variable">$image</span>/tags/list?n<span class="token operator">=</span><span class="token variable">$limit</span>

<span class="token assign-left variable">headers</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>mktemp -t headers.XXXXX<span class="token variable">)</span></span>

<span class="token keyword">while</span> <span class="token punctuation">[</span> -n <span class="token string">&quot;<span class="token variable">$operation</span>&quot;</span> <span class="token punctuation">]</span>
<span class="token keyword">do</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;Operation&quot;</span>
    <span class="token builtin class-name">echo</span> <span class="token variable">$operation</span>
    
    <span class="token assign-left variable">tags</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> -H <span class="token string">&quot;Authorization: Bearer <span class="token variable">$acr_access_token</span>&quot;</span> <span class="token string">&quot;https://<span class="token variable">$registry</span><span class="token variable">$operation</span>&quot;</span> -D $headers<span class="token variable">)</span></span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;Tags&quot;</span>
    <span class="token builtin class-name">echo</span> <span class="token variable">$tags</span>
    
    <span class="token assign-left variable">operation</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> $headers <span class="token operator">|</span> <span class="token function">sed</span> -n <span class="token string">'s/^Link: &lt;\(.*\)&gt;.*/\1/p'</span><span class="token variable">)</span></span>
<span class="token keyword">done</span>
<span class="token function">rm</span> <span class="token variable">$headers</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>For more information, visit <a href="https://docs.docker.com/registry/spec/api/#listing-image-tags" target="_blank" rel="noopener noreferrer">Docker V2 API Reference - Listing Image Tags<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="samples-api-call-scripts"><a href="#samples-api-call-scripts" class="header-anchor">#</a> Samples API Call scripts</h2> <p>This is a summary script of the points discussed above. The first three variables have to be filled out.</p> <ul><li>Variable <code>registry</code> can be something like <code>&quot;contosoregistry.azurecr.io&quot;</code>.</li> <li>The AAD access token and AAD refresh token values can be obtained from the Azure CLI, after running <code>az login</code> check file <code>$HOME/.azure/accessTokens.json</code> (<code>%HOMEDRIVE%%HOMEPATH%\.azure\accessTokens.json</code> in Windows) for the token values.</li></ul> <p>Note that a stale AAD tokens will result in this script failing to obtain an ACR refresh token, and therefore it won't succeed in obtaining an ACR access token or in executing the operation against the registry.</p> <h3 id="catalog-listing-with-aad-refresh-token"><a href="#catalog-listing-with-aad-refresh-token" class="header-anchor">#</a> Catalog Listing with AAD refresh token</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">registry</span><span class="token operator">=</span><span class="token string">&quot; --- you have to fill this out --- &quot;</span>
<span class="token assign-left variable">aad_refresh_token</span><span class="token operator">=</span><span class="token string">&quot; --- you have to fill this out --- &quot;</span>
<span class="token assign-left variable">aad_access_token</span><span class="token operator">=</span><span class="token string">&quot; --- you have to fill this out --- &quot;</span>

<span class="token assign-left variable">operation</span><span class="token operator">=</span><span class="token string">&quot;/v2/_catalog&quot;</span>

<span class="token assign-left variable">acr_refresh_token</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> -s -X POST -H <span class="token string">&quot;Content-Type: application/x-www-form-urlencoded&quot;</span> -d <span class="token string">&quot;grant_type=access_token_refresh_token&amp;service=<span class="token variable">$registry</span>&amp;refresh_token=<span class="token variable">$aad_refresh_token</span>&amp;access_token=<span class="token variable">$aad_access_token</span>&quot;</span> https://$registry/oauth2/exchange <span class="token operator">|</span> jq <span class="token string">'.refresh_token'</span> <span class="token operator">|</span> <span class="token function">sed</span> -e <span class="token string">'s/^&quot;//'</span> -e <span class="token string">'s/&quot;$//'</span><span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;ACR Refresh Token&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$acr_refresh_token</span>

<span class="token assign-left variable">challenge</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> -vs https://$registry$operation <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;Www-Authenticate:&quot;</span><span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;Challenge&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$challenge</span>

<span class="token assign-left variable">scope</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> $challenge <span class="token operator">|</span> <span class="token function">egrep</span> -o <span class="token string">'scope=\&quot;([^\&quot;]*)\&quot;'</span> <span class="token operator">|</span> <span class="token function">egrep</span> -o <span class="token string">'\&quot;([^\&quot;]*)\&quot;'</span> <span class="token operator">|</span> <span class="token function">sed</span> -e <span class="token string">'s/^&quot;//'</span> -e <span class="token string">'s/&quot;$//'</span><span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;Scope&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$scope</span>

<span class="token assign-left variable">acr_access_token</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> -s -X POST -H <span class="token string">&quot;Content-Type: application/x-www-form-urlencoded&quot;</span> -d <span class="token string">&quot;grant_type=refresh_token&amp;service=<span class="token variable">$registry</span>&amp;scope=<span class="token variable">$scope</span>&amp;refresh_token=<span class="token variable">$acr_refresh_token</span>&quot;</span> https://$registry/oauth2/token <span class="token operator">|</span> jq <span class="token string">'.access_token'</span> <span class="token operator">|</span> <span class="token function">sed</span> -e <span class="token string">'s/^&quot;//'</span> -e <span class="token string">'s/&quot;$//'</span><span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;ACR Access Token&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$acr_access_token</span>

<span class="token assign-left variable">catalog</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> -s -H <span class="token string">&quot;Authorization: Bearer <span class="token variable">$acr_access_token</span>&quot;</span> https://$registry$operation<span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;Catalog&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$catalog</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="catalog-listing-using-sp-admin-with-basic-auth"><a href="#catalog-listing-using-sp-admin-with-basic-auth" class="header-anchor">#</a> Catalog listing using SP/Admin with Basic Auth</h3> <p>Here's an equivalent set of scripts that will allow you to execute an operation against an Azure Container Registry, but this time using only the admin credentials, and not AAD.</p> <p>If you'd like to use basic auth, you can do a direct call to the registry like this:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
 
<span class="token assign-left variable">registry</span><span class="token operator">=</span><span class="token string">&quot; --- you have to fill this out --- &quot;</span>
<span class="token assign-left variable">user</span><span class="token operator">=</span><span class="token string">&quot; --- you have to fill this out --- &quot;</span>
<span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token string">&quot; --- you have to fill this out --- &quot;</span>
 
<span class="token assign-left variable">operation</span><span class="token operator">=</span><span class="token string">&quot;/v2/_catalog&quot;</span>
 
<span class="token assign-left variable">credentials</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> -n <span class="token string">&quot;<span class="token variable">$user</span>:<span class="token variable">$password</span>&quot;</span> <span class="token operator">|</span> base64 -w <span class="token number">0</span><span class="token variable">)</span></span>
 
<span class="token assign-left variable">catalog</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> -s -H <span class="token string">&quot;Authorization: Basic <span class="token variable">$credentials</span>&quot;</span> https://$registry$operation<span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;Catalog&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$catalog</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="catalog-listing-using-admin-keys-with-bearer-auth"><a href="#catalog-listing-using-admin-keys-with-bearer-auth" class="header-anchor">#</a> Catalog listing using Admin Keys with Bearer Auth</h3> <p>If you'd like to use bearer auth, you have to first convert your admin credentials to an ACR access token like this:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
 
<span class="token assign-left variable">registry</span><span class="token operator">=</span><span class="token string">&quot; --- you have to fill this out --- &quot;</span>
<span class="token assign-left variable">user</span><span class="token operator">=</span><span class="token string">&quot; --- you have to fill this out --- &quot;</span>
<span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token string">&quot; --- you have to fill this out --- &quot;</span>
 
<span class="token assign-left variable">operation</span><span class="token operator">=</span><span class="token string">&quot;/v2/_catalog&quot;</span>
 
<span class="token assign-left variable">challenge</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> -vs https://$registry$operation <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;Www-Authenticate:&quot;</span><span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;Challenge&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$challenge</span>
 
<span class="token assign-left variable">scope</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> $challenge <span class="token operator">|</span> <span class="token function">egrep</span> -o <span class="token string">'scope=\&quot;([^\&quot;]*)\&quot;'</span> <span class="token operator">|</span> <span class="token function">egrep</span> -o <span class="token string">'\&quot;([^\&quot;]*)\&quot;'</span> <span class="token operator">|</span> <span class="token function">sed</span> -e <span class="token string">'s/^&quot;//'</span> -e <span class="token string">'s/&quot;$//'</span><span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;Scope&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$scope</span>

<span class="token assign-left variable">credentials</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> -n <span class="token string">&quot;<span class="token variable">$user</span>:<span class="token variable">$password</span>&quot;</span> <span class="token operator">|</span> base64 -w <span class="token number">0</span><span class="token variable">)</span></span>
 
<span class="token assign-left variable">acr_access_token</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> -s -H <span class="token string">&quot;Content-Type: application/x-www-form-urlencoded&quot;</span> -H <span class="token string">&quot;Authorization: Basic <span class="token variable">$credentials</span>&quot;</span> <span class="token string">&quot;https://<span class="token variable">$registry</span>/oauth2/token?service=<span class="token variable">$registry</span>&amp;scope=<span class="token variable">$scope</span>&quot;</span> <span class="token operator">|</span> jq <span class="token string">'.access_token'</span> <span class="token operator">|</span> <span class="token function">sed</span> -e <span class="token string">'s/^&quot;//'</span> -e <span class="token string">'s/&quot;$//'</span><span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;ACR Access Token&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$acr_access_token</span>
 
<span class="token assign-left variable">catalog</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> -s -H <span class="token string">&quot;Authorization: Bearer <span class="token variable">$acr_access_token</span>&quot;</span> https://$registry$operation<span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;Catalog&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$catalog</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="docker-login-with-acr-access-token-single-repository-scope"><a href="#docker-login-with-acr-access-token-single-repository-scope" class="header-anchor">#</a> Docker login with ACR Access Token - Single repository scope</h3> <p>The following script uses an AAD token to request an 'ACR access token` which can be used as a docker login credential.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#/bin/sh</span>

<span class="token builtin class-name">set</span> -e

<span class="token assign-left variable">REGISTRY</span><span class="token operator">=</span><span class="token string">&quot; --- you have to fill this out --- &quot;</span>
<span class="token assign-left variable">REPOSITORY</span><span class="token operator">=</span><span class="token string">&quot; --- you have to fill this out --- &quot;</span>
<span class="token assign-left variable">AAD_ACCESS_TOKEN</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>az account get-access-token --query accessToken -o tsv<span class="token variable">)</span></span>

<span class="token assign-left variable">ACR_REFRESH_TOKEN</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> -s -X POST -H <span class="token string">&quot;Content-Type: application/x-www-form-urlencoded&quot;</span> <span class="token punctuation">\</span>
	-d <span class="token string">&quot;grant_type=access_token&amp;service=<span class="token variable">$REGISTRY</span>&amp;access_token=<span class="token variable">$AAD_ACCESS_TOKEN</span>&quot;</span> <span class="token punctuation">\</span>
	https://$REGISTRY/oauth2/exchange <span class="token punctuation">\</span>
	<span class="token operator">|</span> jq <span class="token string">'.refresh_token'</span> <span class="token punctuation">\</span>
	<span class="token operator">|</span> <span class="token function">sed</span> -e <span class="token string">'s/^&quot;//'</span> -e <span class="token string">'s/&quot;$//'</span><span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;ACR Refresh Token obtained.&quot;</span>


<span class="token comment"># Create the repo level scope</span>
<span class="token assign-left variable">SCOPE</span><span class="token operator">=</span><span class="token string">&quot;repository:<span class="token variable">$REPOSITORY</span>:pull&quot;</span>

<span class="token comment"># to pull multiple repositories passing in multiple scope arguments. </span>
<span class="token comment">#&amp;scope=&quot;repository:repo:pull,push</span><span class="token string">&quot;

ACR_ACCESS_TOKEN=<span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> -s -X POST -H <span class="token string">&quot;Content-Type: application/x-www-form-urlencoded&quot;</span> <span class="token punctuation">\</span>
	-d <span class="token string">&quot;grant_type=refresh_token&amp;service=<span class="token variable">$REGISTRY</span>&amp;scope=<span class="token variable">$SCOPE</span>&amp;refresh_token=<span class="token variable">$ACR_REFRESH_TOKEN</span>&quot;</span> <span class="token punctuation">\</span>
	https://$REGISTRY/oauth2/token <span class="token punctuation">\</span>
	<span class="token operator">|</span> jq <span class="token string">'.access_token'</span> <span class="token punctuation">\</span>
	<span class="token operator">|</span> <span class="token function">sed</span> -e <span class="token string">'s/^&quot;//'</span> -e <span class="token string">'s/&quot;$//'</span><span class="token variable">)</span></span>
echo &quot;</span>ACR Access Token obtained.&quot;

<span class="token comment"># Docker Login using the ACR_ACCESS_TOKEN</span>
<span class="token builtin class-name">echo</span> <span class="token function">docker</span> login into <span class="token variable">$REGISTRY</span>
<span class="token function">docker</span> login -u 00000000-0000-0000-0000-000000000000 -p <span class="token variable">$ACR_ACCESS_TOKEN</span> <span class="token variable">$REGISTRY</span>
<span class="token function">docker</span> pull <span class="token variable">$REGISTRY</span>/<span class="token variable">$REPOSITORY</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h3 id="fetch-helm-index-yaml-with-admin-keys-or-sp-with-basic-auth"><a href="#fetch-helm-index-yaml-with-admin-keys-or-sp-with-basic-auth" class="header-anchor">#</a> Fetch helm index.yaml with Admin Keys or SP with Basic Auth</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">registry</span><span class="token operator">=</span><span class="token string">&quot; --- you have to fill this out --- &quot;</span>
<span class="token assign-left variable">user</span><span class="token operator">=</span><span class="token string">&quot; --- you have to fill this out --- &quot;</span>
<span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token string">&quot; --- you have to fill this out --- &quot;</span>

<span class="token assign-left variable">operation</span><span class="token operator">=</span><span class="token string">&quot;/helm/v1/repo/index.yaml&quot;</span>
 
<span class="token assign-left variable">challenge</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> -vs https://$registry$operation <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;Www-Authenticate:&quot;</span><span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;Challenge&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$challenge</span>
 
<span class="token assign-left variable">scope</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> $challenge <span class="token operator">|</span> <span class="token function">egrep</span> -o <span class="token string">'scope=\&quot;([^\&quot;]*)\&quot;'</span> <span class="token operator">|</span> <span class="token function">egrep</span> -o <span class="token string">'\&quot;([^\&quot;]*)\&quot;'</span> <span class="token operator">|</span> <span class="token function">sed</span> -e <span class="token string">'s/^&quot;//'</span> -e <span class="token string">'s/&quot;$//'</span><span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;Scope&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$scope</span>
 
<span class="token assign-left variable">credentials</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> -n <span class="token string">&quot;<span class="token variable">$user</span>:<span class="token variable">$password</span>&quot;</span> <span class="token operator">|</span> base64 -w <span class="token number">0</span><span class="token variable">)</span></span>
 
<span class="token assign-left variable">acr_access_token</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> -s -H <span class="token string">&quot;Content-Type: application/x-www-form-urlencoded&quot;</span> <span class="token punctuation">\</span>
 -H <span class="token string">&quot;Authorization: Basic <span class="token variable">$credentials</span>&quot;</span> <span class="token string">&quot;https://<span class="token variable">$registry</span>/oauth2/token?service=<span class="token variable">$registry</span>&amp;scope=<span class="token variable">$scope</span>&quot;</span> <span class="token operator">|</span> jq <span class="token string">'.access_token'</span> <span class="token operator">|</span> <span class="token function">sed</span> -e <span class="token string">'s/^&quot;//'</span> -e <span class="token string">'s/&quot;$//'</span><span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;ACR Access Token&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$acr_access_token</span>
 
<span class="token comment">#Retrieve the location header and strip the trailing \r for curl</span>
<span class="token assign-left variable">URL</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> -sD - -H <span class="token string">&quot;Authorization: Bearer <span class="token variable">$acr_access_token</span>&quot;</span> https://$registry$operation  <span class="token operator">|</span> <span class="token function">grep</span> -Fi Location <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $2}'</span> <span class="token operator">|</span> <span class="token function">tr</span> -d <span class="token string">'\r'</span><span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token assign-left variable">Location</span><span class="token operator">=</span><span class="token variable">$URL</span>
<span class="token builtin class-name">echo</span> index.yaml
<span class="token builtin class-name">echo</span> ----------
<span class="token function">curl</span> <span class="token variable">$URL</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/azure/acr/edit/master/docs/AAD-OAuth.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/acr/tasks/agentpool/" class="prev">
        Agent Pools
      </a></span> <span class="next"><a href="/acr/Token-BasicAuth.html">
        Token with Basic Auth
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/acr/assets/js/app.3ca3959d.js" defer></script><script src="/acr/assets/js/2.4abe739f.js" defer></script><script src="/acr/assets/js/13.88956df0.js" defer></script>
  </body>
</html>
