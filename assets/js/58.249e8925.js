(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{462:function(e,a,s){"use strict";s.r(a);var t=s(65),n=Object(t.a)({},(function(){var e=this,a=e.$createElement,s=e._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"comparing-azure-container-registry-project-teleport-with-standard-docker-pull-using-azure-kubernetes-service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#comparing-azure-container-registry-project-teleport-with-standard-docker-pull-using-azure-kubernetes-service"}},[e._v("#")]),e._v(" Comparing Azure Container Registry Project Teleport with standard docker pull, using Azure Kubernetes Service")]),e._v(" "),s("p",[e._v("To compare the performance benefits of Project Teleport two deployments will be made allowing the same image to be deployed to an AKS node with Project Teleport, and another without Project Teleport, allowing node recycling to reset the nodes, clearing any cached images.")]),e._v(" "),s("p",[e._v("Project Teleport is node specific. If an image is pulled to a node, with teleport enabled, the expanded layers are mounted.\nIf a second copy of the same image is pulled to the same node, even if pulled from Project Teleport expanded repository, the node will identify common layers and mount the local layers from the previously pulled image.")]),e._v(" "),s("p",[e._v("To avoid layer sharing, testing the same image with and without Project Teleport enabled, two additional nodepools will be created. The additional nodepools will enable clearing any cached images and layers by scaling the nodepool to zero, then back to one.")]),e._v(" "),s("p",[e._v("When complete, the AKS cluster will have (3) nodepools:")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("nodepool1")]),e._v(" - The system nodepool. No workloads will be scheduled here.")]),e._v(" "),s("li",[s("code",[e._v("teleporter")]),e._v(" - A Project Teleport enabled nodepool, with a single node")]),e._v(" "),s("li",[s("code",[e._v("shuttle")]),e._v(" - The standard method of transport of container images, with a single node.")])]),e._v(" "),s("p",[e._v("This tutorial assumes you've already completed the steps to create a Teleport enabled AKS Cluster, and Teleport enabled ACR Instance. If you haven't already done so, complete the steps in: "),s("RouterLink",{attrs:{to:"/teleport/aks-getting-started.html"}},[e._v("Integrate Azure Container Registry and Project Teleport with Azure Kubernetes Service")])],1),e._v(" "),s("h2",{attrs:{id:"set-environment-variables"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#set-environment-variables"}},[e._v("#")]),e._v(" Set environment variables")]),e._v(" "),s("p",[e._v("Configure variables unique to your environment. Note the ACR and AKS instances must both be in one of the "),s("RouterLink",{attrs:{to:"/teleport/#preview-constraints"}},[e._v("teleport supported regions")]),e._v(".")],1),e._v(" "),s("div",{staticClass:"language-azurecli-interactive line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("AKS=myaks\nAKS_RG=${AKS}-rg\nLOCATION=westus2\nK8S_VERSION=1.19.7\nACR=myacr\nACR_URL=${ACR}.azurecr.io\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br")])]),s("h2",{attrs:{id:"clone-the-teleport-samples-repo"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#clone-the-teleport-samples-repo"}},[e._v("#")]),e._v(" Clone the Teleport samples repo")]),e._v(" "),s("p",[e._v("Sample kubernetes deployment files and a "),s("code",[e._v("check-expansion.sh")]),e._v(" script are provided at: https://github.com/Azure/acr/tree/main/docs/teleport. Only a few files are necessary. You may either "),s("code",[e._v("git clone")]),e._v(" the repo, or copy the individual files referenced below.")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" clone https://github.com/Azure/acr.git\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("h2",{attrs:{id:"import-images-for-teleportation"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#import-images-for-teleportation"}},[e._v("#")]),e._v(" Import images for teleportation")]),e._v(" "),s("p",[e._v("For completeness of this walkthrough, the azure-vote application is used, which includes a 944mb "),s("code",[e._v("azure-vote-front:v1")]),e._v(" image. To expand the layers, import the images into a teleport enabled registry, in the same region as the AKS cluster.")]),e._v(" "),s("div",{staticClass:"language-azurecli-interactive line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("az acr import \\\n  --source mcr.microsoft.com/azuredocs/azure-vote-front:v1 \\\n  --name $ACR \\\n  --image azure-vote-front:v1\n\naz acr import \\\n  --source mcr.microsoft.com/oss/bitnami/redis:6.0.8 \\\n  --name $ACR \\\n  --image redis:6.0.8\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br")])]),s("h2",{attrs:{id:"confirm-import-and-teleport-expansion"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#confirm-import-and-teleport-expansion"}},[e._v("#")]),e._v(" Confirm import and teleport expansion")]),e._v(" "),s("p",[e._v("Confirm the "),s("code",[e._v("azure-vote-front")]),e._v(" repository is set for teleport expansion:")]),e._v(" "),s("div",{staticClass:"language-azurecli line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("az acr repository show \\\n  --repository azure-vote-front \\\n  -o jsonc\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("p",[e._v("Look for "),s("code",[e._v('"teleportEnabled": true,')]),e._v(" in the output")]),e._v(" "),s("div",{staticClass:"language-json line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"changeableAttributes"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"deleteEnabled"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"listEnabled"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"readEnabled"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"teleportEnabled"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"writeEnabled"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br")])]),s("p",[e._v("Although the repository is configured for teleport expansion, each image upload will take time to be expanded on push. The length of time is based on the quantity and size of layers, however the expansion should be completed within seconds.")]),e._v(" "),s("blockquote",[s("p",[s("strong",[e._v("Note:")]),e._v(" ACR webhooks indicate when an artifact is pushed and available. The push event occurs prior to layer expansion. In a future release, a new webhook and EventGrid notification will be added indicating the image has been expanded, and ready for teleportation.")])]),e._v(" "),s("p",[e._v("At this point in the Teleport preview, check expansion using the "),s("a",{attrs:{href:"./check-expansion.sh"}},[e._v("check-expansion.sh")]),e._v(" script. As the script uses a "),s("code",[e._v("/mount")]),e._v(" api, basic auth is required. An "),s("a",{attrs:{href:"https://aka.ms/acr/tokens",target:"_blank",rel:"noopener noreferrer"}},[e._v("ACR Token"),s("OutboundLink")],1),e._v(" is created and saved as environment variables.")]),e._v(" "),s("blockquote",[s("p",[e._v("Note: If "),s("code",[e._v("check-expansion.sh")]),e._v(" fails to execute ("),s("code",[e._v("-bash: ./check-expansion.sh: Permission denied")]),e._v("), assure the file is set to executable: "),s("code",[e._v("sudo chmod +x ./check-expansion.sh")])])]),e._v(" "),s("div",{staticClass:"language-azurecli-interactive line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("export ACR_USER=teleport-token\nexport ACR_PWD=$(az acr token create \\\n  --name teleport-token \\\n  --registry $ACR \\\n  --scope-map _repositories_pull \\\n  --query credentials.passwords[0].value -o tsv)\n\n./check-expansion.sh teleport azure-vote-front v1\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br")])]),s("h2",{attrs:{id:"add-nodes-for-teleporters-and-shuttles"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#add-nodes-for-teleporters-and-shuttles"}},[e._v("#")]),e._v(" Add nodes for teleporters and shuttles")]),e._v(" "),s("p",[e._v("Two nodepools will be added to enable teleportation, and a comparison for standard transport. An "),s("code",[e._v("acr-teleport")]),e._v(" label is added for scheduling onto specific nodes. The system nodepool ("),s("code",[e._v("nodepool1")]),e._v(") is avoided to enable "),s("a",{attrs:{href:"#cleanup"}},[e._v("clearing the image cache")]),e._v(" by scaling the nodepool to zero then back to one.")]),e._v(" "),s("div",{staticClass:"language-azurecli-interactive line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("az aks nodepool add \\\n  --resource-group $AKS_RG \\\n  --cluster-name $AKS \\\n  --name teleporter \\\n  --node-count 1 \\\n  --aks-custom-headers EnableACRTeleport=true \\\n  --labels acr-teleport=enabled\n\naz aks nodepool add \\\n  --resource-group $AKS_RG \\\n  --cluster-name $AKS \\\n  --name shuttle \\\n  --node-count 1 \\\n  --labels acr-teleport=disabled\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br")])]),s("h2",{attrs:{id:"deploy-to-aks"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#deploy-to-aks"}},[e._v("#")]),e._v(" Deploy to AKS")]),e._v(" "),s("p",[e._v("Update the "),s("a",{attrs:{href:"./samples/azure-vote-teleport.yaml"}},[e._v("azure-vote-teleport.yaml")]),e._v(" and "),s("a",{attrs:{href:"./samples/azure-vote-shuttle.yaml"}},[e._v("azure-vote-shuttle.yaml")]),e._v(" files to reference your registry name:")]),e._v(" "),s("div",{staticClass:"language-yml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("...")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" azure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("vote"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("back\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" <registryName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")]),e._v(".azurecr.io/redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("6.0.8\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("...")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" azure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("vote"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("front\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" <registryName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")]),e._v(".azurecr.io/azure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("vote"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("front"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("v1\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br")])]),s("h3",{attrs:{id:"deploy-with-standard-pull-performance"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#deploy-with-standard-pull-performance"}},[e._v("#")]),e._v(" Deploy with standard pull performance")]),e._v(" "),s("p",[e._v("Deploy the "),s("em",[e._v("shuttle")]),e._v(" podspec:")]),e._v(" "),s("div",{staticClass:"language-azurecli-interactive line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("kubectl apply -f azure-vote-shuttle.yaml\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("Get the list of pods to find the azure-vote-front pod. The shorthand version can be used if only one pod is named "),s("code",[e._v("azure-vote-front")]),e._v(". You may need to run the command a few times until the image has been pulled and expanded on the node.")]),e._v(" "),s("div",{staticClass:"language-azurecli-interactive line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("kubectl get pods\nkubectl describe pod azure-vote-front-shuttle\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("p",[e._v("Under the "),s("code",[e._v("events")]),e._v(" list, an entry for "),s("code",[e._v("Successfully pulled image...")]),e._v(" provides the pull time. Note the length before proceeding to the teleport version.")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("Events:\n  Type    Reason     Age   From               Message\n  ----    ------     ----  ----               -------\n  Normal  Scheduled  36s   default-scheduler  Successfully assigned default/azure-vote-front-5c976dbbd9-tckdz to aks-shuttle-10583637-vmss000000\n  Normal  Pulling    35s   kubelet            Pulling image "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"<registryName>.azurecr.io/azure-vote-front:v1"')]),e._v("\n  Normal  Pulled     1s    kubelet            Successfully pulled image "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"<registryName>.azurecr.io/azure-vote-front:v1"')]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("34")]),e._v(".738162s\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br")])]),s("p",[e._v("If "),s("code",[e._v("already present on machine")]),e._v(" is returned, this indicates the image was previously pulled and cached. See "),s("a",{attrs:{href:"#cleanup"}},[e._v("recycle nodepool")]),e._v(" to clear the cache.")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("Events:\n  Type    Reason     Age    From               Message\n  ----    ------     ----   ----               -------\n  Normal  Scheduled  2m12s  default-scheduler  Successfully assigned default/azure-vote-front-5bdfc85f9c-d7z8b to aks-shuttle-10583637-vmss000000\n  Normal  Pulled     2m11s  kubelet            Container image "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"<registryName>.azurecr.io/azure-vote-front:v1"')]),e._v(" already present on machine\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br")])]),s("h3",{attrs:{id:"deploy-with-teleport-performance"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#deploy-with-teleport-performance"}},[e._v("#")]),e._v(" Deploy with Teleport performance")]),e._v(" "),s("p",[e._v("Deploy the "),s("em",[e._v("teleport")]),e._v(" podspec:")]),e._v(" "),s("div",{staticClass:"language-azurecli-interactive line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("kubectl apply -f azure-vote-teleport.yaml\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("Get the list of pods to find the azure-vote-front pod. The shorthand version can be used if only one pod is named "),s("code",[e._v("azure-vote-front")]),e._v(". You may need to run the command a few times until the image has been pulled and expanded on the node.")]),e._v(" "),s("div",{staticClass:"language-azurecli-interactive line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("kubectl describe pod azure-vote-front-teleport\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("Under the "),s("code",[e._v("events")]),e._v(" list, an entry for "),s("code",[e._v("Successfully pulled image...")]),e._v(" provides the pull time. Note the length should be dramatically faster.")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("Events:\n  Type    Reason     Age   From               Message\n  ----    ------     ----  ----               -------\n  Normal  Scheduled  12s   default-scheduler  Successfully assigned default/azure-vote-front-teleport-5bf865d976-lm4bj to aks-teleporter-10583637-vmss000000\n  Normal  Pulling    11s   kubelet            Pulling image "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"<registryName>.azurecr.io/azure-vote-front:v1"')]),e._v("\n  Normal  Pulled     3s    kubelet            Successfully pulled image "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"<registryName>.azurecr.io/azure-vote-front:v1"')]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("8")]),e._v(".011045191s\n  Normal  Created    3s    kubelet            Created container azure-vote-front-teleport\n  Normal  Started    3s    kubelet            Started container azure-vote-front-teleport\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br")])]),s("h3",{attrs:{id:"browse-the-apps"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#browse-the-apps"}},[e._v("#")]),e._v(" Browse the apps")]),e._v(" "),s("p",[e._v("To view the voting apps:")]),e._v(" "),s("div",{staticClass:"language-azurecli-interactive line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("kubectl get services\nNAME                        TYPE           CLUSTER-IP     EXTERNAL-IP     PORT(S)        AGE\nazure-vote-back-shuttle     ClusterIP      10.0.159.177   <none>          6379/TCP       15m\nazure-vote-back-teleport    ClusterIP      10.0.229.255   <none>          6379/TCP       21m\nazure-vote-front-shuttle    LoadBalancer   10.0.155.50    x.x.x.x         80:30276/TCP   15m\nazure-vote-front-teleport   LoadBalancer   10.0.60.1      x.x.x.x         80:30259/TCP   21m\nkubernetes                  ClusterIP      10.0.0.1       <none>          443/TCP        118m\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br")])]),s("p",[e._v("Copy the EXTERNAL-IP, and paste in the browser to view each voting app.")]),e._v(" "),s("h3",{attrs:{id:"cleanup"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cleanup"}},[e._v("#")]),e._v(" Cleanup")]),e._v(" "),s("p",[e._v("To reset the nodes, delete the two deployments:")]),e._v(" "),s("div",{staticClass:"language-azurecli-interactive line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("kubectl delete -f azure-vote-teleport.yaml\nkubectl delete -f azure-vote-shuttle.yaml\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("p",[e._v("Clear the image cache, and any teleport mounts:")]),e._v(" "),s("div",{staticClass:"language-azurecli-interactive line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("az aks scale \\\n  --resource-group $AKS_RG \\\n  --name $AKS \\\n  --nodepool-name teleporter \\\n  --node-count 0\n\naz aks scale \\\n  --resource-group $AKS_RG \\\n  --name $AKS \\\n  --nodepool-name teleporter \\\n  --node-count 1\n\naz aks scale \\\n  --resource-group $AKS_RG \\\n  --name $AKS \\\n  --nodepool-name shuttle \\\n  --node-count 0\n\naz aks scale \\\n  --resource-group $AKS_RG \\\n  --name $AKS \\\n  --nodepool-name shuttle \\\n  --node-count 1\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br"),s("span",{staticClass:"line-number"},[e._v("22")]),s("br"),s("span",{staticClass:"line-number"},[e._v("23")]),s("br")])]),s("h2",{attrs:{id:"performance-profile-of-teleport"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#performance-profile-of-teleport"}},[e._v("#")]),e._v(" Performance profile of teleport")]),e._v(" "),s("p",[e._v("The Voting app has a significant performance delta, comparing a normal pull time of 34.7 seconds, with 8.0 seconds of teleport. While impressive, you may have assumed a larger difference.")]),e._v(" "),s("p",[e._v("Teleport prototype-1 is based on mounting expanded layers. For each layer of an image, the decompression of a layer is traded off for a mount. Therefore, the larger the layer count, the slightly longer the start time.")]),e._v(" "),s("p",[e._v("The "),s("code",[e._v("azure-vote-front")]),e._v(" image has "),s("em",[s("strong",[e._v("29 layers")])]),e._v(", which requires 29 mounts. When pulling the image without teleport, the 944mb of content must be decompressed, but multiple decompression threads can run concurrently.")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("docker")]),e._v(" inspect "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("registryName"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(".azurecr.io/azure-vote-front:v1\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v(".\n"),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"RootFS"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Type"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"layers"')]),e._v(",\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Layers"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sha256:e27a10675c5656bafb7bfa9e4631e871499af0a5ddfda3cebc0ac401dfe19382"')]),e._v(",\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sha256:851f3e348c69d8959d326f0bab975c03f9813eec33aba389aa7c569953510433"')]),e._v(",\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sha256:06f4de5fefeae30802d336e8c234b9c0989542fb80efd4f83be06c41aba26d9f"')]),e._v(",\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sha256:b31411566900643c38169980a21093c23e0a12a12ffea78b1921d07dd40372bd"')]),e._v(",\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sha256:6662dddae6aa455371366ed12400556a29e049373ea27c089a24634e3098cb48"')]),e._v(",\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sha256:4ea12feed6a9386d7bdac8b26073b1209f0f39781a5d157026dfb5a918c95db7"')]),e._v(",\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sha256:e7cee6196d865755606c73b82004784273cd423217cba8faf650b6707d3b5059"')]),e._v(",\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sha256:b15d32f8b6aa975b8be84e825952094d2f20296777a2bb5fad3fb270ca05a776"')]),e._v(",\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sha256:5e8efc7c6f4fee7fecfc685b742293a5300cc3180262a144a2fed54c46597129"')]),e._v(",\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sha256:4f6e0a34a0535f5cd6b76d06aae861c3ced179b3b115d2850af0e2f0bcefeffc"')]),e._v(",\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sha256:5ac43729c58be5ecb0fc13b164fb4f06f0afc13394735e8ac10cdb0f75311195"')]),e._v(",\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sha256:491bd929c5bfcb0639a6c43d07be0aac225dc0da28379e99f617480599825e5f"')]),e._v(",\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sha256:b18e79d2742360b7b0d81493e8a8beced51953c8a8f73fe4b228e47e8aeb292b"')]),e._v(",\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sha256:55ebcfb2ad17cafdada768b6ca43e3f4e51bc589757b22337b94a499354aa052"')]),e._v(",\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sha256:1a350e9420b7eac6b50172334afd6354d89749c62822951596bac9085cb9fb1e"')]),e._v(",\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sha256:7b3929993879466a3abee028d3fb490d83c211ab5723e29765ed17c98db5b4e3"')]),e._v(",\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sha256:ddeb470c209923815a410d35dd45a6710bc285955b5ef30d92a003d38bd68f3b"')]),e._v(",\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sha256:c30da5f5d23cec0997d05337dd1113872ba56b38a59bf96922572f07d65b94a0"')]),e._v(",\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sha256:a7364327f2826e4991e3675271350c9e7b858e33abbe77aacfbbff00a4b59455"')]),e._v(",\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sha256:f8af872e501840a2de13260830960f612560d9ee755ae07a37c30758e8568444"')]),e._v(",\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sha256:57fe04427c69233864b729d60d3c9c7fe8a43e950cb442a650101a357998c8c2"')]),e._v(",\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sha256:cde1a4e95d8bea636972733fde8f223d1dda2c2425ec7de8ca5b078391723c11"')]),e._v(",\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sha256:efa870440d9c6defc6447ad9d3d214312ba3dc0c665c723b793d14d241d811e1"')]),e._v(",\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sha256:a9f64da753644ba8e18846cb23010c8e730de34701b5f519591167722a89784b"')]),e._v(",\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sha256:2131d41261d2d13cae8b024c5a20e65fe8ee8f98d04bfd238124210b94115d69"')]),e._v(",\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sha256:9d93163e41ffdad4659db82f267091b4a478f1235be1b25438407e79e80ed28b"')]),e._v(",\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sha256:d9aeb057eef2070b1260cceeefb0933755f62504cf34efe2bf4f113043bf7493"')]),e._v(",\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sha256:5e85a99d34e4a9aea5bdc845fb30587b172393ebf7d71ddbb1b325e3fa728090"')]),e._v(",\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sha256:ab48c9fa73df063cfafaa0338c06ec44ba3d29a3ce6adde3fedf42d2d0c0ee91"')]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br"),s("span",{staticClass:"line-number"},[e._v("22")]),s("br"),s("span",{staticClass:"line-number"},[e._v("23")]),s("br"),s("span",{staticClass:"line-number"},[e._v("24")]),s("br"),s("span",{staticClass:"line-number"},[e._v("25")]),s("br"),s("span",{staticClass:"line-number"},[e._v("26")]),s("br"),s("span",{staticClass:"line-number"},[e._v("27")]),s("br"),s("span",{staticClass:"line-number"},[e._v("28")]),s("br"),s("span",{staticClass:"line-number"},[e._v("29")]),s("br"),s("span",{staticClass:"line-number"},[e._v("30")]),s("br"),s("span",{staticClass:"line-number"},[e._v("31")]),s("br"),s("span",{staticClass:"line-number"},[e._v("32")]),s("br"),s("span",{staticClass:"line-number"},[e._v("33")]),s("br"),s("span",{staticClass:"line-number"},[e._v("34")]),s("br"),s("span",{staticClass:"line-number"},[e._v("35")]),s("br")])]),s("h3",{attrs:{id:"comparing-fewer-layers"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#comparing-fewer-layers"}},[e._v("#")]),e._v(" Comparing fewer layers")]),e._v(" "),s("p",[e._v("To gauge the difference between layers and size, clone the "),s("a",{attrs:{href:"https://github.com/Azure-Samples/azure-voting-app-redis",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure-Samples/azure-voting-app-redis"),s("OutboundLink")],1),e._v(" repo and build the image with the "),s("code",[e._v("--squash")]),e._v(" flag.")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("docker")]),e._v(" build --force-rm --squash -t "),s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${ACR}")]),e._v(".azurecr.io/azure-vote-front:squashed "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(".")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("docker")]),e._v(" push "),s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${ACR}")]),e._v(".azurecr.io/azure-vote-front:squashed\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("ul",[s("li",[e._v("Change the "),s("code",[e._v(":tag")]),e._v(" references in "),s("code",[e._v("azure-vote-shuttle.yaml")]),e._v(" and "),s("code",[e._v("azure-vote-teleport.yaml")]),e._v(" files to reference the "),s("code",[e._v(":squashed")]),e._v(" tag."),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[e._v("    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" azure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("vote"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("front"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("teleport\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" <registryName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")]),e._v(".azurecr.io/azure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("vote"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("front"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("squashed\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])])]),e._v(" "),s("li",[e._v("Follow the steps above to "),s("a",{attrs:{href:"#cleanup"}},[e._v("recycle")]),e._v(" the nodes, and "),s("a",{attrs:{href:"#deploy-with-standard-pull-performance"}},[e._v("redeploy the two apps")]),e._v(".")])]),e._v(" "),s("p",[e._v("The resulting times should reflect "),s("strong",[e._v("~31.7 seconds")]),e._v(" for the standard docker pull/decompress and "),s("strong",[e._v("~1.9 seconds")]),e._v(" for teleportation of a single layer.")]),e._v(" "),s("table",[s("thead",[s("tr",[s("th",[e._v("Size")]),e._v(" "),s("th",[e._v("Layers")]),e._v(" "),s("th",[e._v("Docker")]),e._v(" "),s("th",[e._v("Teleport")])])]),e._v(" "),s("tbody",[s("tr",[s("td",[e._v("944mb")]),e._v(" "),s("td",[e._v("28")]),e._v(" "),s("td",[e._v("34.7")]),e._v(" "),s("td",[e._v("8")])]),e._v(" "),s("tr",[s("td",[e._v("929mb")]),e._v(" "),s("td",[e._v("1")]),e._v(" "),s("td",[e._v("31.7")]),e._v(" "),s("td",[e._v("1.9")])])])]),e._v(" "),s("p",[e._v("That's a "),s("em",[e._v("further")]),e._v(" reduction from 8.0 seconds for 28 layers to 1.9 seconds for a single layer. This highlights the performance profile of mounting expanded layers, compared to pulling and decompressing layers.")]),e._v(" "),s("h4",{attrs:{id:"shuttle-deployed-single-layer-image"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#shuttle-deployed-single-layer-image"}},[e._v("#")]),e._v(" Shuttle deployed single layer image")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('Events:\n  Type    Reason     Age    From               Message\n  ----    ------     ----   ----               -------\n  Normal  Scheduled  9m55s  default-scheduler  Successfully assigned default/azure-vote-front-6ff785596-4d62g to aks-shuttle-10583637-vmss000000\n  Normal  Pulling    9m54s  kubelet            Pulling image "<registryName>.azurecr.io/azure-vote-front:squashed"\n  Normal  Pulled     9m22s  kubelet            Successfully pulled image "<registryName>.azurecr.io/azure-vote-front:squashed" in 31.711601788s\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br")])]),s("h4",{attrs:{id:"teleported-single-layer-image"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#teleported-single-layer-image"}},[e._v("#")]),e._v(" Teleported single layer image")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('Events:\n  Type    Reason     Age   From               Message\n  ----    ------     ----  ----               -------\n  Normal  Scheduled  37s   default-scheduler  Successfully assigned default/azure-vote-front-teleport-5fbc9b754f-lrtpw to aks-teleporter-10583637-vmss000000\n  Normal  Pulling    36s   kubelet            Pulling image "<registryName>.azurecr.io/azure-vote-front:squashed"\n  Normal  Pulled     34s   kubelet            Successfully pulled image "<registryName>.azurecr.io/azure-vote-front:squashed" in 1.891985507s\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br")])]),s("h3",{attrs:{id:"balancing-layers-and-size"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#balancing-layers-and-size"}},[e._v("#")]),e._v(" Balancing layers and size")]),e._v(" "),s("p",[e._v("While you might consider flattening your images to one layer for fast mounting, you may have contention on a single mount point. The purpose of the Project Teleport preview is to get further metrics on the usage to understand the art and science of image layers. The Project Teleport design does not require an image owner to make changes to use Teleport. Teleport works with your existing container images. However, with each technology, there are always optimizations that may be made based on the deployment target.")]),e._v(" "),s("p",[e._v("One thing is always common about image performance. The smaller you can make your overall container image, the faster it will run.")]),e._v(" "),s("h2",{attrs:{id:"providing-feedback"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#providing-feedback"}},[e._v("#")]),e._v(" Providing feedback")]),e._v(" "),s("p",[e._v("Please contact the Project Teleport technicians, and other fellow Teleport Red-Shirts in the "),s("a",{attrs:{href:"https://aka.ms/acr/teleport/red-shirts",target:"_blank",rel:"noopener noreferrer"}},[e._v("Teleport Red-Shirts teams channel"),s("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=n.exports}}]);