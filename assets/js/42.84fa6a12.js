(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{450:function(e,t,s){"use strict";s.r(t);var r=s(65),o=Object(r.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"troubleshoot-issues-with-connected-registry"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#troubleshoot-issues-with-connected-registry"}},[e._v("#")]),e._v(" Troubleshoot issues with connected registry")]),e._v(" "),s("p",[e._v("This article helps you troubleshoot problems you might encounter when setting up, configuring, and deploying a connected registry.")]),e._v(" "),s("h2",{attrs:{id:"symptoms"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#symptoms"}},[e._v("#")]),e._v(" Symptoms")]),e._v(" "),s("ul",[s("li",[e._v("Unable to push or pull images to or from the connected registry. Client error is "),s("code",[e._v("Error response from daemon: Get https://<connected-registry-login-server-ip-or-dns>/v2/: http: server gave HTTP response to HTTPS client")])])]),e._v(" "),s("h2",{attrs:{id:"causes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#causes"}},[e._v("#")]),e._v(" Causes")]),e._v(" "),s("ul",[s("li",[e._v("The connected registry is configured for HTTP access only - "),s("a",{attrs:{href:"#configure-docker-daemon-to-access-insecure-registry"}},[e._v("solution")])])]),e._v(" "),s("h2",{attrs:{id:"potential-solutions"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#potential-solutions"}},[e._v("#")]),e._v(" Potential solutions")]),e._v(" "),s("h3",{attrs:{id:"configure-docker-daemon-to-access-insecure-registry"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configure-docker-daemon-to-access-insecure-registry"}},[e._v("#")]),e._v(" Configure Docker daemon to access insecure registry")]),e._v(" "),s("p",[e._v("The access the connected registry via HTTP, you must configure the client Docker daemon to allow access to insecure registries. The steps are described in "),s("a",{attrs:{href:"https://docs.docker.com/registry/insecure/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Test an insecure registry"),s("OutboundLink")],1),e._v(" article on Docker's web site.")]),e._v(" "),s("h2",{attrs:{id:"symptoms-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#symptoms-2"}},[e._v("#")]),e._v(" Symptoms")]),e._v(" "),s("ul",[s("li",[e._v("Unable to pull an image from the connected registry. Client error is\n"),s("code",[e._v("Error response from daemon: manifest for <connected-registry-login-server-ip-or-dns>/<repository-name>:<tag> not found: manifest unknown: manifest unknown")])])]),e._v(" "),s("h2",{attrs:{id:"causes-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#causes-2"}},[e._v("#")]),e._v(" Causes")]),e._v(" "),s("ul",[s("li",[e._v("The connected registry is not configured to sync this repository from the Azure Container Registry.")])]),e._v(" "),s("h2",{attrs:{id:"potential-solutions-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#potential-solutions-2"}},[e._v("#")]),e._v(" Potential solutions")]),e._v(" "),s("h3",{attrs:{id:"configure-the-connected-registry-to-sync-the-repository"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configure-the-connected-registry-to-sync-the-repository"}},[e._v("#")]),e._v(" Configure the connected registry to sync the repository")]),e._v(" "),s("p",[e._v("In order to access this image, you must update the connected registry configuration to sync the repository. From the Azure CLI run\n"),s("code",[e._v("az acr connected-registry repo -r <ACR-name> -n <connected-registry-name> --add <repository-name>")])]),e._v(" "),s("p",[e._v("Wait a few minutes for the connected registry to sync the repository and try pulling the image again.")]),e._v(" "),s("h2",{attrs:{id:"symptoms-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#symptoms-3"}},[e._v("#")]),e._v(" Symptoms")]),e._v(" "),s("ul",[s("li",[e._v("Unable to push or pull images to or from the connected registry. Client error is\n"),s("code",[e._v("Error response from daemon: pull access denied for <connected-registry-login-server-ip-or-dns>/<repository-name>, repository does not exist or may require 'docker login': denied: Insufficient scopes to perform the operation")])])]),e._v(" "),s("h2",{attrs:{id:"causes-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#causes-3"}},[e._v("#")]),e._v(" Causes")]),e._v(" "),s("ul",[s("li",[e._v("The repository is synced to the connected registry, but the client token used for "),s("code",[e._v("docker login")]),e._v(" does not have access.")])]),e._v(" "),s("h2",{attrs:{id:"potential-solutions-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#potential-solutions-3"}},[e._v("#")]),e._v(" Potential solutions")]),e._v(" "),s("h3",{attrs:{id:"assign-permissions-to-the-connected-registry-client-token"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#assign-permissions-to-the-connected-registry-client-token"}},[e._v("#")]),e._v(" Assign permissions to the connected registry client token")]),e._v(" "),s("p",[e._v("To update the permissions of the client token, you must update the corresponding scope map. To view the scope map resource ID associated with a token, run the following from the Azure CLI:")]),e._v(" "),s("p",[s("code",[e._v("az acr token show -r <ACR-name> -n <client-token-name> -o tsv --query scopeMapId")])]),e._v(" "),s("h4",{attrs:{id:"pull-permissions"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pull-permissions"}},[e._v("#")]),e._v(" Pull permissions")]),e._v(" "),s("p",[e._v("To give the client token pull permissions to the repository, run the following from the Azure CLI:")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("az acr scope-map update \\\n  --name <scope-map-name> \\\n  --registry <ACR-name> \\\n  --add-repository <repository-name> content/read\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br")])]),s("h4",{attrs:{id:"push-permissions"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#push-permissions"}},[e._v("#")]),e._v(" Push permissions")]),e._v(" "),s("p",[e._v("If the connected registry is in Registry mode, the client may need push access. To give the client token push permissions to the repository, run the following from the Azure CLI:")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("az acr scope-map update \\\n  --name <scope-map-name> \\\n  --registry <ACR-name> \\\n  --add-repository <repository-name> content/read content/write\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br")])]),s("p",[e._v("Wait a few minutes for the updated client token permissions to sync to the connected registry.")]),e._v(" "),s("blockquote",[s("p",[e._v("[!TIP]\nAfter updating the permissions of the client token, you may want to generate new passwords. Run "),s("code",[e._v("az acr token credential generate")]),e._v(" from the Azure CLI to refresh your client token passwords. Allow a few minutes for the credentials to sync to the connected registry. Login using your new credentials with "),s("code",[e._v("docker login")]),e._v(".")])]),e._v(" "),s("p",[e._v("For more information on ACR token management please reference "),s("a",{attrs:{href:"https://docs.microsoft.com/en-us/azure/container-registry/container-registry-repository-scoped-permissions%5D",target:"_blank",rel:"noopener noreferrer"}},[e._v("Create a token with repository-scoped permissions"),s("OutboundLink")],1),e._v(".")]),e._v(" "),s("h2",{attrs:{id:"symptoms-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#symptoms-4"}},[e._v("#")]),e._v(" Symptoms")]),e._v(" "),s("ul",[s("li",[e._v("Unable to push an image to the connected registry. Client error is\n"),s("code",[e._v("denied: This operation is not allowed on this registry.")])])]),e._v(" "),s("h2",{attrs:{id:"causes-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#causes-4"}},[e._v("#")]),e._v(" Causes")]),e._v(" "),s("ul",[s("li",[e._v("Images can only be pushed to a connected registry in "),s("code",[e._v("Registry")]),e._v(" mode. If the connected registry is in "),s("code",[e._v("Mirror")]),e._v(" mode then only readonly operations are allowed, such as "),s("code",[e._v("docker pull")]),e._v(".")])]),e._v(" "),s("h2",{attrs:{id:"potential-solutions-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#potential-solutions-4"}},[e._v("#")]),e._v(" Potential solutions")]),e._v(" "),s("h3",{attrs:{id:"create-a-new-connected-registry-in-registry-mode"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#create-a-new-connected-registry-in-registry-mode"}},[e._v("#")]),e._v(" Create a new connected registry in Registry mode")]),e._v(" "),s("p",[e._v("Once a connected registry is created, the mode cannot be changed. If you would like to push images to your connected registry, create a new resource in Registry mode. Ensure the client token linked to the new connected registry has push permissions to the synced repositories.")]),e._v(" "),s("p",[e._v("From the Azure CLI run")]),e._v(" "),s("p",[s("code",[e._v("az acr connected-registry create --registry <ACR-name> --name <connected-registry-name> --repository app/hello-world service/mycomponent --client-tokens <client-token-name>")])]),e._v(" "),s("p",[e._v("Deploy the connected registry. For an example on how to deploy a connected registry on IoT Edge, please reference "),s("RouterLink",{attrs:{to:"/preview/connected-registry/quickstart-deploy-connected-registry-iot-edge-cli.html"}},[e._v("Quickstart - Deploy a connected registry to an IoT Edge device")]),e._v(". Once deployed, you can use the client token to login and push images to the connected registry. These images will be synced from the connected registry to the ACR.")],1)])}),[],!1,null,null,null);t.default=o.exports}}]);