(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{443:function(e,t,s){"use strict";s.r(t);var r=s(65),n=Object(r.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"quickstart-view-repositories-and-tags-in-a-deployed-connected-registry"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#quickstart-view-repositories-and-tags-in-a-deployed-connected-registry"}},[e._v("#")]),e._v(" Quickstart: View repositories and tags in a deployed connected registry")]),e._v(" "),s("p",[e._v("In this quickstart, you use "),s("a",{attrs:{href:"https://docs.microsoft.com/azure/container-registry/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure Container Registry"),s("OutboundLink")],1),e._v(" and "),s("a",{attrs:{href:"https://curl.se/",target:"_blank",rel:"noopener noreferrer"}},[e._v("curl"),s("OutboundLink")],1),e._v(" commands to view available repositories and tags in a deployed connected registry. You can review the "),s("RouterLink",{attrs:{to:"/preview/connected-registry/intro-connected-registry.html"}},[e._v("ACR connected registry introduction")]),e._v(" for details about the connected registry feature of Azure Container Registry.")],1),e._v(" "),s("h2",{attrs:{id:"prerequisites"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites"}},[e._v("#")]),e._v(" Prerequisites")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("Use "),s("a",{attrs:{href:"https://docs.microsoft.com/en-us/azure/cloud-shell/quickstart",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure Cloud Shell"),s("OutboundLink")],1),e._v(" using the bash environment.")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://shell.azure.com/",target:"_blank",rel:"noopener noreferrer"}},[s("img",{attrs:{src:"https://docs.microsoft.com/en-us/azure/includes/media/cloud-shell-try-it/hdi-launch-cloud-shell.png",alt:"https://docs.microsoft.com/en-us/azure/includes/media/cloud-shell-try-it/hdi-launch-cloud-shell.png"}}),s("OutboundLink")],1)])]),e._v(" "),s("li",[s("p",[e._v("If you prefer, "),s("a",{attrs:{href:"https://docs.microsoft.com/en-us/cli/azure/install-azure-cli",target:"_blank",rel:"noopener noreferrer"}},[e._v("install"),s("OutboundLink")],1),e._v(" the Azure CLI to run CLI reference commands.")]),e._v(" "),s("ul",[s("li",[e._v("If you're using a local install, sign in with Azure CLI by using the "),s("a",{attrs:{href:"https://docs.microsoft.com/en-us/cli/azure/reference-index#az_login",target:"_blank",rel:"noopener noreferrer"}},[e._v("az login"),s("OutboundLink")],1),e._v(" command. To finish the authentication process, follow the steps displayed in your terminal. See "),s("a",{attrs:{href:"https://docs.microsoft.com/en-us/cli/azure/authenticate-azure-cli",target:"_blank",rel:"noopener noreferrer"}},[e._v("Sign in with Azure CLI"),s("OutboundLink")],1),e._v(" for additional sign-in options.")]),e._v(" "),s("li",[e._v("When you're prompted, install Azure CLI extensions on first use. For more information about extensions, see "),s("a",{attrs:{href:"https://docs.microsoft.com/en-us/cli/azure/azure-cli-extensions-overview",target:"_blank",rel:"noopener noreferrer"}},[e._v("Use extensions with Azure CLI"),s("OutboundLink")],1),e._v(".")]),e._v(" "),s("li",[e._v("Run "),s("a",{attrs:{href:"https://docs.microsoft.com/en-us/cli/azure/reference-index?#az_version",target:"_blank",rel:"noopener noreferrer"}},[e._v("az version"),s("OutboundLink")],1),e._v(" to find the version and dependent libraries that are installed. To upgrade to the latest version, run "),s("a",{attrs:{href:"https://docs.microsoft.com/en-us/cli/azure/reference-index?#az_upgrade",target:"_blank",rel:"noopener noreferrer"}},[e._v("az upgrade"),s("OutboundLink")],1),e._v(".")])])]),e._v(" "),s("li",[s("p",[e._v("The Azure CLI commands in this article are formatted for the Bash shell. If you're using a different shell like PowerShell or Command Prompt, you may need to adjust line continuation characters or variable assignment lines accordingly. This article uses variables to minimize the amount of command editing required.")])])]),e._v(" "),s("h2",{attrs:{id:"before-you-begin"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#before-you-begin"}},[e._v("#")]),e._v(" Before you begin")]),e._v(" "),s("p",[e._v("Make sure that you have created the connected registry resource in Azure as described in the "),s("RouterLink",{attrs:{to:"/preview/connected-registry/quickstart-connected-registry-cli.html"}},[e._v("Create connected registry using the CLI")]),e._v(" quickstart guide and have a connected registry deployed on your premises as described in "),s("RouterLink",{attrs:{to:"/preview/connected-registry/quickstart-deploy-connected-registry-iot-edge-cli.html"}},[e._v("Quickstart: Deploy a connected registry to an IoT Edge device")]),e._v(" or "),s("RouterLink",{attrs:{to:"/preview/connected-registry/quickstart-deploy-connected-registry-kubernetes.html"}},[e._v("Quickstart: Deploy a connected registry to Kubernetes cluster")]),e._v(".")],1),e._v(" "),s("p",[e._v("In this tutorial, we configure a "),s("em",[e._v("client token")]),e._v(" to list available repositories and tags. Reference "),s("RouterLink",{attrs:{to:"/preview/connected-registry/overview-connected-registry-access.html"}},[e._v("Understand access to a connected registry")]),e._v(" for more information on how client tokens are used for authentication with a connected registry.")],1),e._v(" "),s("h2",{attrs:{id:"create-a-client-token"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#create-a-client-token"}},[e._v("#")]),e._v(" Create a client token")]),e._v(" "),s("p",[e._v("Use the following CLI command to create a token with read access to your synced repositories. We need both "),s("code",[e._v("content/read")]),e._v(" and "),s("code",[e._v("metadata/read")]),e._v(' permissions to list the repositories and tags in the connected registry. The below command creates a token with read access to the "hello-world" and "testing" repositories.')]),e._v(" "),s("div",{staticClass:"language-azurecli line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("az acr token create \\\n  --name myconnectedregistry-client-token \\\n  --registry mycontainerregistry001 \\\n  --repository hello-world content/read metadata/read \\\n  --repository testing content/read metadata/read\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br")])]),s("p",[e._v("The command will return details about the newly generated token including passwords.")]),e._v(" "),s("blockquote",[s("p",[e._v("[!IMPORTANT]\nMake sure that you save the generated passwords. Those are one-time passwords and cannot be retrieved. You can generate new passwords using the [az acr token credential generate][az-acr-token-credential-generate] command.")])]),e._v(" "),s("h2",{attrs:{id:"update-the-connected-registry-with-the-client-token"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#update-the-connected-registry-with-the-client-token"}},[e._v("#")]),e._v(" Update the connected registry with the client token")]),e._v(" "),s("p",[e._v("Use the following CLI command to update the connected registry with the newly created client token:")]),e._v(" "),s("div",{staticClass:"language-azurecli line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("az acr connected-registry update \\\n  --name myconnectedregistry \\\n  --registry mycontainerregistry001 \\\n  --add-client-token myconnectedregistry-client-token\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br")])]),s("h2",{attrs:{id:"configure-your-machine"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configure-your-machine"}},[e._v("#")]),e._v(" Configure your machine")]),e._v(" "),s("p",[e._v("From a machine with access to the deployed connected registry, install the following tools:")]),e._v(" "),s("ol",[s("li",[e._v("Install "),s("a",{attrs:{href:"https://curl.se/",target:"_blank",rel:"noopener noreferrer"}},[e._v("curl"),s("OutboundLink")],1),e._v(", a command-line data transfer tool. "),s("code",[e._v("curl")]),e._v(" is used to issue requests to the connected registry server. Enter the following command to install curl:")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("sudo apt -y install curl\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("ol",{attrs:{start:"2"}},[s("li",[e._v("Install "),s("a",{attrs:{href:"https://stedolan.github.io/jq/",target:"_blank",rel:"noopener noreferrer"}},[e._v("jq"),s("OutboundLink")],1),e._v(", a command-line JSON processor. This utility is used to parse JSON, and is useful in parsing the response when listing repositories and tags of a connected registry. Enter following command to install jq:")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("sudo apt -y install jq\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("ol",{attrs:{start:"3"}},[s("li",[e._v("Install "),s("code",[e._v("base64")]),e._v(", a command-line tool that is used to base64 encode client token credentials when viewing repositories and tags of a connected registry. Enter following command to install base64:")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("sudo apt -y install coreutils\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("h2",{attrs:{id:"view-the-repositories-in-a-deployed-connected-registry"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#view-the-repositories-in-a-deployed-connected-registry"}},[e._v("#")]),e._v(" View the repositories in a deployed connected registry")]),e._v(" "),s("p",[e._v("Run the following commands from a machine with access to the deployed connected registry.")]),e._v(" "),s("ol",[s("li",[e._v("Base64 encode your client token credentials and store this value in a variable.")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("ENCODED_CREDENTIALS=$(echo -n 'myconnectedregistry-client-token:<insert client token password>' | base64)\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("ol",{attrs:{start:"2"}},[s("li",[e._v("The following command can be referenced to acquire a token to list repositories.")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("curl --location  \\\n      --request GET 'https://<IP_address_or_FQDN_of_connected_registry>:<port>/acr/oauth2/token?service=<IP_address_or_FQDN_of_connected_registry>:<port>&scope=registry:catalog:*'  \\\n      --header 'Authorization: Basic <base64 encode(client token username:password)>'\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("p",[e._v("In this example, the connected registry endpoint is accessible over HTTP on localhost:8080. The following command fetches the access token from the connected registry and stores it in a variable.")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("ACCESS_TOKEN=$(curl --location  \\\n  --request GET 'http://localhost:8080/acr/oauth2/token?service=localhost:8080&scope=registry:catalog:*'  \\\n  --header 'Authorization: Basic '$ENCODED_CREDENTIALS | jq -r '.access_token')\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("ol",{attrs:{start:"3"}},[s("li",[e._v("Using the above token, run the following command to list the repositories available on the connected registry.")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("curl --location \\\n --request GET 'http://localhost:8080/v2/_catalog' \\\n --header 'Authorization: Bearer '$ACCESS_TOKEN | jq '.'\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("p",[e._v("You will see an output similar to:")]),e._v(" "),s("div",{staticClass:"language-json line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"repositories"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"hello-world"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"testing"')]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br")])]),s("blockquote",[s("p",[e._v("[!IMPORTANT]\nOnly those repositories that the client token has access to will be listed if they are available on the connected registry. To give the client token read access to additional repositories, use the "),s("a",{attrs:{href:"https://docs.microsoft.com/cli/azure/acr/token?view=azure-cli-latest#az_acr_token_update",target:"_blank",rel:"noopener noreferrer"}},[e._v("az acr token update"),s("OutboundLink")],1),e._v(" command.")])]),e._v(" "),s("h2",{attrs:{id:"view-the-tags-for-a-repository-in-a-deployed-connected-registry"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#view-the-tags-for-a-repository-in-a-deployed-connected-registry"}},[e._v("#")]),e._v(" View the tags for a repository in a deployed connected registry")]),e._v(" "),s("p",[e._v("Run the following commands from a machine with access to the deployed connected registry.")]),e._v(" "),s("ol",[s("li",[e._v("Base64 encode your client token credentials and store this value in a variable.")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("ENCODED_CREDENTIALS=$(echo -n 'myconnectedregistry-client-token:<insert client token password>' | base64)\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("ol",{attrs:{start:"2"}},[s("li",[e._v("The following command can be referenced to acquire a token to view tags for a repository.")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v(" curl --location  \\\n      --request GET 'https://<IP_address_or_FQDN_of_connected_registry>:<port>/acr/oauth2/token?service=<IP_address_or_FQDN_of_connected_registry>:<port>&scope=repository:<repository name>:pull'  \\\n      --header 'Authorization: Basic <base64 encode(client token username:password)>'\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("p",[e._v('In this example, we will fetch tags for the "hello-world" repository. The connected registry endpoint is accessible over HTTP on localhost:8080. The following command fetches the access token from the connected registry and stores it in a variable.')]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("ACCESS_TOKEN=$(curl --location  \\\n      --request GET 'http://localhost:8080/acr/oauth2/token?service=localhost:8080&scope=repository:hello-world:pull'  \\\n      --header 'Authorization: Basic '$ENCODED_CREDENTIALS | jq -r '.access_token')\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("ol",{attrs:{start:"3"}},[s("li",[e._v("Using the above token, run the following command to list the tags in the hello-world repository on the connected registry.")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("curl --location \\\n   --request GET 'http://localhost:8080/v2/hello-world/tags/list' \\\n   --header 'Authorization: Bearer '$ACCESS_TOKEN | jq '.'\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("p",[e._v("You will see an output similar to:")]),e._v(" "),s("div",{staticClass:"language-json line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"hello-world"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"tags"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0.1.0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0.2.0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0.3.0"')]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br")])])])}),[],!1,null,null,null);t.default=n.exports}}]);