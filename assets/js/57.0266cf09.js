(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{497:function(e,t,a){"use strict";a.r(t);var r=a(65),s=Object(r.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"integrate-azure-container-registry-and-project-teleport-with-azure-kubernetes-service-preview"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#integrate-azure-container-registry-and-project-teleport-with-azure-kubernetes-service-preview"}},[e._v("#")]),e._v(" Integrate Azure Container Registry and Project Teleport with Azure Kubernetes Service (preview)")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/azurecr/teleport",target:"_blank",rel:"noopener noreferrer"}},[e._v("Project Teleport"),a("OutboundLink")],1),e._v(" allows container hosts to access pre-expanded layers within an "),a("a",{attrs:{href:"https://aka.ms/acr",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure Container Registry (ACR)"),a("OutboundLink")],1),e._v(" that is in the same region as the container host. Using pre-expanded layers removes the time for compute and memory to decompress layers that are already available within the Azure network. Removing this decompression also reduces the time to create the instance of the running container.")]),e._v(" "),a("p",[e._v("Using Project Teleport with ACR and AKS is in private preview. See "),a("a",{attrs:{href:"#enable-project-teleport-on-an-acr"}},[e._v("Enable Project Teleport on an ACR")]),e._v(" for access.")]),e._v(" "),a("blockquote",[a("p",[e._v('AKS preview features are available on a self-service, opt-in basis. Previews are provided "as is" and "as available," and they\'re excluded from the service-level agreements and limited warranty. AKS previews are partially covered by customer support on a best-effort basis. As such, these features aren\'t meant for production use. AKS preview features aren\'t available in Azure Government or Azure China 21Vianet clouds. For more information, see the following support articles:')]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://docs.microsoft.com/azure/aks/support-policies",target:"_blank",rel:"noopener noreferrer"}},[e._v("AKS support policies"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://docs.microsoft.com/en-us/azure/aks/faq",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure support FAQ"),a("OutboundLink")],1)])]),e._v(" "),a("p",[e._v('ACR Preview features are available on a self-service, opt-in basis. Previews are provided "as is" and "as available," and they\'re excluded from the service-level agreements and limited warranty. ACR previews are partially covered by customer support on a best-effort basis. As such, these features aren\'t meant for production use. ACR preview features aren\'t available in Azure Government or Azure China 21Vianet clouds.')]),e._v(" "),a("ul",[a("li",[e._v("Project Teleport Support is provided through a "),a("a",{attrs:{href:"https://aka.ms/acr/teleport/red-shirts",target:"_blank",rel:"noopener noreferrer"}},[e._v("Microsoft Teams channel"),a("OutboundLink")],1),e._v(". "),a("a",{attrs:{href:"https://aka.ms/acr/teleport/signup",target:"_blank",rel:"noopener noreferrer"}},[e._v("Requesting access to Project Teleport"),a("OutboundLink")],1)])])]),e._v(" "),a("h2",{attrs:{id:"prerequisites"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites"}},[e._v("#")]),e._v(" Prerequisites")]),e._v(" "),a("ul",[a("li",[e._v("Ensure you have the Azure CLI, version 2.13.0 or greater installed.")]),e._v(" "),a("li",[e._v("Ensure you have the "),a("code",[e._v("aks-preview")]),e._v(" CLI extension 0.4.73 or greater installed.")]),e._v(" "),a("li",[e._v("Ensure you have Project Teleport enabled on your ACR.")]),e._v(" "),a("li",[e._v("Ensure you have the AKS "),a("code",[e._v("EnableACRTeleport")]),e._v(" feature flag under "),a("code",[e._v("Microsoft.ContainerService")]),e._v(" enabled.")])]),e._v(" "),a("h2",{attrs:{id:"preview-limitations"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#preview-limitations"}},[e._v("#")]),e._v(" Preview Limitations")]),e._v(" "),a("ul",[a("li",[e._v("AKS node pools must use Kubernetes 1.19.7 or greater.")]),e._v(" "),a("li",[e._v("AKS node pools must use "),a("code",[e._v("containerd")]),e._v(" as the container runtime. AKS clusters with node pools using Kubernetes before 1.19.0 use Moby as the container runtime.")]),e._v(" "),a("li",[e._v("Each ACR used must have Project Teleport enabled.")]),e._v(" "),a("li",[e._v("Each ACR must use the "),a("a",{attrs:{href:"https://aka.ms/acr/tiers",target:"_blank",rel:"noopener noreferrer"}},[a("em",[e._v("Premium")]),e._v(" Tier"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("li",[e._v("ACR and AKS must be in the same region. See "),a("RouterLink",{attrs:{to:"/teleport/#preview-constraints"}},[e._v("Project Teleport supported regions")]),e._v("."),a("br"),e._v("\nThis is less of a limitation, rather a design constraint. It's always a best practice to have the content required for deployment to be within the same region. Project Teleport depends on this best practice to mount layers within an Azure network regional boundary.")],1),e._v(" "),a("li",[e._v("Linux containers on AKS clusters are supported. Windows support is not yet available.")]),e._v(" "),a("li",[e._v("Enabling Project Teleport on an existing registry will not convert images already in the registry. To expand existing content, pull and push the image to trigger expansion."),a("br"),e._v(" "),a("em",[e._v("In a future release, enabling Project Teleport on a repository will convert the images. This work is not yet complete.")])]),e._v(" "),a("li",[e._v("ACR Geo-replicated registries are not currently supported on Project Teleport enabled registries.")]),e._v(" "),a("li",[a("a",{attrs:{href:"https://aka.ms/acr/privatelink",target:"_blank",rel:"noopener noreferrer"}},[e._v("Private Links"),a("OutboundLink")],1),e._v(" are not currently supported on Project Teleport enabled registries.")])]),e._v(" "),a("h3",{attrs:{id:"enable-project-teleport-on-an-acr"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#enable-project-teleport-on-an-acr"}},[e._v("#")]),e._v(" Enable Project Teleport on an ACR")]),e._v(" "),a("p",[e._v("Create a "),a("a",{attrs:{href:"https://aka.ms/acr/tiers",target:"_blank",rel:"noopener noreferrer"}},[e._v("premium instance"),a("OutboundLink")],1),e._v(" of Azure Container Registry in one of the "),a("RouterLink",{attrs:{to:"/teleport/#preview-constraints"}},[e._v("Project Teleport supported regions")]),e._v(".")],1),e._v(" "),a("p",[e._v("Sign up for ACR Project Teleport using "),a("a",{attrs:{href:"https://aka.ms/acr/teleport/signup",target:"_blank",rel:"noopener noreferrer"}},[e._v("the signup form"),a("OutboundLink")],1),e._v(", providing the resource ID of a "),a("strong",[e._v("Premium Tier")]),e._v(" ACR instance. Once Project Teleport is enabled, you'll receive an confirmation email.")]),e._v(" "),a("h4",{attrs:{id:"set-environment-variables"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#set-environment-variables"}},[e._v("#")]),e._v(" Set environment variables")]),e._v(" "),a("p",[e._v("Configure variables unique to your environment.")]),e._v(" "),a("div",{staticClass:"language-azurecli-interactive line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("AKS=myaks\nAKS_RG=${AKS}-rg\nACR=myacr\nLOCATION=westus2\nK8S_VERSION=1.19.7\nACR_URL=${ACR}.azurecr.io\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br")])]),a("h4",{attrs:{id:"confirming-an-acr-repository-is-set-to-expand"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#confirming-an-acr-repository-is-set-to-expand"}},[e._v("#")]),e._v(" Confirming an ACR repository is set to expand")]),e._v(" "),a("p",[e._v("Once you receive a confirmation email, push an image to a new repository. You may also use "),a("code",[e._v("az acr import")]),e._v(" to copy an image from another registry.")]),e._v(" "),a("p",[e._v("To confirm an ACR repository has been configured for teleport expansion, use the following command, replacing "),a("code",[e._v("$ACR")]),e._v(" and "),a("code",[e._v("<namespace/image>")]),e._v(" with your acr and image name.")]),e._v(" "),a("div",{staticClass:"language-azurecli line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("az acr import \\\n  --source mcr.microsoft.com/azuredocs/azure-vote-front:v1 \\\n  --name $ACR \\\n  --image azure-vote-front:v1\n\naz acr import \\\n  --source mcr.microsoft.com/oss/bitnami/redis:6.0.8 \\\n  --name $ACR \\\n  --image redis:6.0.8\n\naz acr repository show -n ${ACR} -o jsonc \\\n  --repository azure-vote-front\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br")])]),a("p",[e._v("The following example output shows "),a("em",[e._v('"teleportEnabled": true')]),e._v(", verifying Project Teleport is enabled on your ACR.")]),e._v(" "),a("div",{staticClass:"language-console line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('{\n  "changeableAttributes": {\n    "deleteEnabled": true,\n    "listEnabled": true,\n    "readEnabled": true,\n    "teleportEnabled": true,\n    "writeEnabled": true\n  },\n  ...\n}\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br")])]),a("h4",{attrs:{id:"confirming-an-image-has-been-expanded"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#confirming-an-image-has-been-expanded"}},[e._v("#")]),e._v(" Confirming an image has been expanded")]),e._v(" "),a("p",[e._v("At this point in the Teleport preview, check image expansion using the "),a("a",{attrs:{href:"./check-expansion.sh"}},[e._v("check-expansion.sh")]),e._v(" script. As the script uses a "),a("code",[e._v("/mount")]),e._v(" api, basic auth is required. An "),a("a",{attrs:{href:"https://aka.ms/acr/tokens",target:"_blank",rel:"noopener noreferrer"}},[e._v("ACR Token"),a("OutboundLink")],1),e._v(" is created and saved as environment variable.")]),e._v(" "),a("blockquote",[a("p",[e._v("Note: Assure "),a("a",{attrs:{href:"./check-expansion.sh"}},[e._v("check-expansion.sh")]),e._v(" is set to execute: "),a("code",[e._v("sudo chmod +x check-expansion.sh")])])]),e._v(" "),a("div",{staticClass:"language-azurecli-interactive line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("export ACR_USER=teleport-token\nexport ACR_PWD=$(az acr token create \\\n  --name teleport-token \\\n  --registry $ACR \\\n  --scope-map _repositories_pull \\\n  --query credentials.passwords[0].value -o tsv)\n\n./check-expansion.sh ${ACR} <namespace/repo> <tag>\n# example: ./check-expansion.sh myacr azure-vote-front v1\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br")])]),a("h3",{attrs:{id:"install-aks-preview-cli-extension"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#install-aks-preview-cli-extension"}},[e._v("#")]),e._v(" Install aks-preview CLI extension")]),e._v(" "),a("p",[e._v("To use Project Teleport with ACR and AKS, you need version 0.4.73, or greater, of the "),a("em",[e._v("aks-preview")]),e._v(" CLI extension. Install the "),a("em",[e._v("aks-preview")]),e._v(" Azure CLI extension using the "),a("a",{attrs:{href:"/cli/azure/extension#az-extension-add"}},[e._v("az extension add")]),e._v(" command, or install any available updates using the "),a("a",{attrs:{href:"/cli/azure/extension#az-extension-update"}},[e._v("az extension update")]),e._v(" command:")]),e._v(" "),a("div",{staticClass:"language-azurecli-interactive line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# Check the current Azure CLI version\naz version\n\n# Check the current aks-preview extension version\naz extension list\n\n# Install the aks-preview extension\naz extension add --name aks-preview\n\n# Update the extension to make sure you have the latest version installed\naz extension update --name aks-preview\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br")])]),a("h3",{attrs:{id:"register-the-aks-enableacrteleport-preview-feature"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#register-the-aks-enableacrteleport-preview-feature"}},[e._v("#")]),e._v(" Register the AKS "),a("code",[e._v("EnableACRTeleport")]),e._v(" preview feature")]),e._v(" "),a("p",[e._v("To use Teleport with ACR and AKS, you must enable the "),a("code",[e._v("EnableACRTeleport")]),e._v(" feature flag on your subscription. This feature flag provisions the teleportd client to AKS nodes.")]),e._v(" "),a("p",[e._v("Register the AKS "),a("code",[e._v("EnableACRTeleport")]),e._v(" feature flag using the "),a("a",{attrs:{href:"/cli/azure/feature#az-feature-register"}},[e._v("az feature register")]),e._v(" command as shown in the following example:")]),e._v(" "),a("div",{staticClass:"language-azurecli-interactive line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('az feature register \\\n  --namespace "Microsoft.ContainerService" \\\n  --name "EnableACRTeleport"\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("p",[e._v("It may take 15 minutes or more to complete registration. You can check on the registration status using the "),a("a",{attrs:{href:"/cli/azure/feature#az-feature-list"}},[e._v("az feature list")]),e._v(" command:")]),e._v(" "),a("div",{staticClass:"language-azurecli-interactive line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("az feature list \\\n  --query \"[?contains(name, 'Microsoft.ContainerService/EnableACRTeleport')].{Name:name,State:properties.state}\" \\\n  -o table\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("p",[e._v("When ready, refresh the registration of the "),a("em",[e._v("Microsoft.ContainerService")]),e._v(" resource provider using the "),a("a",{attrs:{href:"/cli/azure/provider#az-provider-register"}},[e._v("az provider register")]),e._v(" command:")]),e._v(" "),a("div",{staticClass:"language-azurecli-interactive line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("az provider register --namespace Microsoft.ContainerService\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h2",{attrs:{id:"create-a-new-aks-cluster-with-teleport-enabled"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#create-a-new-aks-cluster-with-teleport-enabled"}},[e._v("#")]),e._v(" Create a new AKS cluster with Teleport enabled")]),e._v(" "),a("p",[e._v("To use Teleport with ACR and AKS on a new cluster, create a new AKS cluster and specify your ACR with Project Teleport enabled as well as the "),a("code",[e._v("EnableACRTeleport=true")]),e._v(" custom header.")]),e._v(" "),a("div",{staticClass:"language-azurecli-interactive line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("\n# Create the AKS Cluster, attached to ACR, with Project Teleport Enabled\naz aks create \\\n    --generate-ssh-keys \\\n    -g ${AKS_RG} \\\n    -n ${AKS} \\\n    --attach-acr $ACR \\\n    --kubernetes-version ${K8S_VERSION} \\\n    -l $LOCATION \\\n    --aks-custom-headers EnableACRTeleport=true\n\naz aks get-credentials \\\n    -g ${AKS_RG} \\\n    -n ${AKS}\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br")])]),a("h2",{attrs:{id:"add-a-project-teleport-enabled-node-pool-to-an-existing-aks-cluster"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#add-a-project-teleport-enabled-node-pool-to-an-existing-aks-cluster"}},[e._v("#")]),e._v(" Add a Project Teleport enabled node pool to an "),a("em",[e._v("existing")]),e._v(" AKS cluster")]),e._v(" "),a("p",[e._v("To use Project Teleport on an existing AKS cluster, add a node pool to your cluster and set the "),a("code",[e._v("EnableACRTeleport=true")]),e._v(" custom header.")]),e._v(" "),a("div",{staticClass:"language-azurecli line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("az aks nodepool add \\\n  --name teleportpool \\\n  --cluster-name ${AKS} \\\n  --resource-group ${AKS_RG} \\\n  --kubernetes-version ${K8S_VERSION} \\\n  --aks-custom-headers EnableACRTeleport=true\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br")])]),a("p",[e._v("If your AKS cluster doesn't have access to your Project Teleport enabled ACR, attach it.")]),e._v(" "),a("div",{staticClass:"language-azurecli line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("az aks update \\\n  -n ${AKS} \\\n  -g ${AKS_RG} \\\n  --attach-acr ${ACR}\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br")])]),a("h2",{attrs:{id:"verify-your-cluster-has-project-teleport-enabled"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#verify-your-cluster-has-project-teleport-enabled"}},[e._v("#")]),e._v(" Verify your cluster has Project Teleport enabled")]),e._v(" "),a("p",[e._v("When your cluster has a node pool with Project Teleport enabled, any nodes in that node pool have the "),a("code",[e._v("kubernetes.azure.com/enable-acr-teleport-plugin:true")]),e._v(" label. You can target this label with a node selector when running pods on your cluster to have specific applications take advantage of Project Teleport.")]),e._v(" "),a("p",[e._v("To show the labels on your nodes, get the credentials for your cluster and use "),a("code",[e._v("kubectl")]),e._v(" to show your nodes.")]),e._v(" "),a("div",{staticClass:"language-azurecli line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("az aks get-credentials -g ${AKS_RG} -n ${AKS}\nkubectl get nodes\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("Use "),a("code",[e._v("kubectl")]),e._v(" to get the details of a specific node. Confirm the "),a("code",[e._v("kubernetes.azure.com/enable-acr-teleport-plugin:true")]),e._v(" label appears in the node details. Note: the full name of the nodepool is not required. Only enough of the name to be unique is required.")]),e._v(" "),a("div",{staticClass:"language-azurecli line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("kubectl describe node aks-nodepool1\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("The following example output shows the "),a("code",[e._v("kubernetes.azure.com/enable-acr-teleport-plugin:true")]),e._v(" label in the node details.")]),e._v(" "),a("div",{staticClass:"language-console line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ kubectl describe node aks-nodepool1-00000000-vmss000000\n...\nName:               aks-nodepool1-00000000-vmss000000\nRoles:              agent\nLabels:             agentpool=nodepool1\n                    ...\n                    kubernetes.azure.com/enable-acr-teleport-plugin=true\n                    ...\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br")])]),a("h2",{attrs:{id:"next-steps"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#next-steps"}},[e._v("#")]),e._v(" Next steps")]),e._v(" "),a("ul",[a("li",[a("RouterLink",{attrs:{to:"/teleport/aks-teleport-comparison.html"}},[e._v("Deploy two nodes, one with Project Teleport, one without to see the start time differences.")])],1)]),e._v(" "),a("p",[e._v("For more information about pushing an image into your ACR, see "),a("a",{attrs:{href:"https://docs.microsoft.com/en-us/azure/container-registry/container-registry-get-started-docker-cli",target:"_blank",rel:"noopener noreferrer"}},[e._v("Push your first image to a private container registry using the Docker CLI"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("p",[e._v("For more information about importing images into your ACR, see "),a("a",{attrs:{href:"https://aka.ms/acr/import",target:"_blank",rel:"noopener noreferrer"}},[e._v("Import container images to a container registry"),a("OutboundLink")],1),e._v(".")])])}),[],!1,null,null,null);t.default=s.exports}}]);