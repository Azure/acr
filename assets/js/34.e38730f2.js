(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{477:function(e,r,t){"use strict";t.r(r);var n=t(65),a=Object(n.a)({},(function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"quickstart-create-a-connected-registry-using-azure-container-registry-cli-commands"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#quickstart-create-a-connected-registry-using-azure-container-registry-cli-commands"}},[e._v("#")]),e._v(" Quickstart: Create a connected registry using Azure Container Registry CLI commands")]),e._v(" "),t("p",[e._v("In this quickstart, you use "),t("a",{attrs:{href:"https://docs.microsoft.com/azure/container-registry/container-registry-intro",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure Container Registry"),t("OutboundLink")],1),e._v(" (ACR) commands to create a connected registry resource in Azure. The connected registry feature of ACR allows you to deploy a registry on your premises and synchronize images between the ACR and your premises. It brings the container images and OCI artifacts closer to your container workloads on premises and increases their acquisition performance. You can review the "),t("RouterLink",{attrs:{to:"/preview/connected-registry/intro-connected-registry.html"}},[e._v("ACR connected registry introduction")]),e._v(" for details about the connected registry feature of Azure Container Registry.")],1),e._v(" "),t("p",[e._v("In this quick start guide, you will create two connected registry resources - one that allows artifact pull and push functionality and one that allows only artifact pull functionality.")]),e._v(" "),t("h2",{attrs:{id:"prerequisites"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites"}},[e._v("#")]),e._v(" Prerequisites")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("Use "),t("a",{attrs:{href:"https://docs.microsoft.com/en-us/azure/cloud-shell/quickstart",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure Cloud Shell"),t("OutboundLink")],1),e._v(" using the bash environment.")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://shell.azure.com/",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://docs.microsoft.com/en-us/azure/includes/media/cloud-shell-try-it/hdi-launch-cloud-shell.png",alt:"https://docs.microsoft.com/en-us/azure/includes/media/cloud-shell-try-it/hdi-launch-cloud-shell.png"}}),t("OutboundLink")],1)])]),e._v(" "),t("li",[t("p",[e._v("If you prefer, "),t("a",{attrs:{href:"https://docs.microsoft.com/en-us/cli/azure/install-azure-cli",target:"_blank",rel:"noopener noreferrer"}},[e._v("install"),t("OutboundLink")],1),e._v(" the Azure CLI to run CLI reference commands.")]),e._v(" "),t("ul",[t("li",[e._v("If you're using a local install, sign in with Azure CLI by using the "),t("a",{attrs:{href:"https://docs.microsoft.com/en-us/cli/azure/reference-index#az_login",target:"_blank",rel:"noopener noreferrer"}},[e._v("az login"),t("OutboundLink")],1),e._v(" command. To finish the authentication process, follow the steps displayed in your terminal. See "),t("a",{attrs:{href:"https://docs.microsoft.com/en-us/cli/azure/authenticate-azure-cli",target:"_blank",rel:"noopener noreferrer"}},[e._v("Sign in with Azure CLI"),t("OutboundLink")],1),e._v(" for additional sign-in options.")]),e._v(" "),t("li",[e._v("When you're prompted, install Azure CLI extensions on first use. For more information about extensions, see "),t("a",{attrs:{href:"https://docs.microsoft.com/en-us/cli/azure/azure-cli-extensions-overview",target:"_blank",rel:"noopener noreferrer"}},[e._v("Use extensions with Azure CLI"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("li",[e._v("Run "),t("a",{attrs:{href:"https://docs.microsoft.com/en-us/cli/azure/reference-index?#az_version",target:"_blank",rel:"noopener noreferrer"}},[e._v("az version"),t("OutboundLink")],1),e._v(" to find the version and dependent libraries that are installed. To upgrade to the latest version, run "),t("a",{attrs:{href:"https://docs.microsoft.com/en-us/cli/azure/reference-index?#az_upgrade",target:"_blank",rel:"noopener noreferrer"}},[e._v("az upgrade"),t("OutboundLink")],1),e._v(".")])])]),e._v(" "),t("li",[t("p",[e._v("The Azure CLI commands in this article are formatted for the Bash shell. If you're using a different shell like PowerShell or Command Prompt, you may need to adjust line continuation characters or variable assignment lines accordingly. This article uses variables to minimize the amount of command editing required.")])])]),e._v(" "),t("h2",{attrs:{id:"create-a-resource-group"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#create-a-resource-group"}},[e._v("#")]),e._v(" Create a resource group")]),e._v(" "),t("p",[e._v("If you don't already have a container registry, first create a resource group with the "),t("a",{attrs:{href:"https://docs.microsoft.com/cli/azure/group?view=azure-cli-latest#az_group_create",target:"_blank",rel:"noopener noreferrer"}},[e._v("az group create"),t("OutboundLink")],1),e._v(" command. An Azure resource group is a logical container into which Azure resources are deployed and managed.")]),e._v(" "),t("p",[e._v("The following example creates a resource group named "),t("em",[e._v("myResourceGroup")]),e._v(" in the "),t("em",[e._v("eastus")]),e._v(" location.")]),e._v(" "),t("div",{staticClass:"language-azurecli line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("az group create --name myResourceGroup --location eastus\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h2",{attrs:{id:"create-a-container-registry"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#create-a-container-registry"}},[e._v("#")]),e._v(" Create a container registry")]),e._v(" "),t("p",[e._v("Create a container registry using the "),t("a",{attrs:{href:"https://docs.microsoft.com/cli/azure/acr?view=azure-cli-latest#az_acr_create",target:"_blank",rel:"noopener noreferrer"}},[e._v("az acr create"),t("OutboundLink")],1),e._v(" command. The registry name must be unique within Azure, and contain 5-50 alphanumeric characters. In the following example, "),t("em",[e._v("mycontainerregistry001")]),e._v(" is used. Update this to a unique value.")]),e._v(" "),t("div",{staticClass:"language-azurecli line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("az acr create --resource-group myResourceGroup \\\n  --name mycontainerregistry001 \\\n  --sku Premium\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br")])]),t("p",[e._v("This example creates a "),t("em",[e._v("Premium")]),e._v(" registry. Connected registries are supported only in the "),t("em",[e._v("Premium")]),e._v(" tier of Azure container registry. For details on available service tiers, see "),t("a",{attrs:{href:"https://docs.microsoft.com/azure/container-registry/container-registry-skus",target:"_blank",rel:"noopener noreferrer"}},[e._v("Container registry service tiers"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("h2",{attrs:{id:"enable-the-dedicated-data-endpoint-for-the-cloud-registry"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#enable-the-dedicated-data-endpoint-for-the-cloud-registry"}},[e._v("#")]),e._v(" Enable the dedicated data endpoint for the cloud registry")]),e._v(" "),t("p",[e._v("For the connected registries to communicate with the cloud registry, the dedicated data endpoint for the Azure Container Registry in the cloud should be enabled by using the "),t("a",{attrs:{href:"https://docs.microsoft.com/cli/azure/acr?view=azure-cli-latest#az_acr_update",target:"_blank",rel:"noopener noreferrer"}},[e._v("az acr update"),t("OutboundLink")],1),e._v(" command as follows:")]),e._v(" "),t("div",{staticClass:"language-azurecli line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("az acr update -n mycontainerregistry001 \\\n  --data-endpoint-enabled\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("h2",{attrs:{id:"import-images-into-the-container-registry"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#import-images-into-the-container-registry"}},[e._v("#")]),e._v(" Import images into the container registry")]),e._v(" "),t("p",[e._v("This and subsequent quickstart guides use two repositories:")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("acr/connected-registry")]),e._v(" is the repository that contains the images used to deploy the connected registry on your premises. This repository will also be synchronized to the connected registry in case you want to implement nested registries scenario.")]),e._v(" "),t("li",[t("code",[e._v("hello-world")]),e._v(" is the repository that will be synchronized to the connected registry and pulled by the connected registry clients.")])]),e._v(" "),t("p",[e._v("The easiest way to populate those repositories is to use the "),t("code",[e._v("az acr import")]),e._v(" command as follows:")]),e._v(" "),t("div",{staticClass:"language-azurecli line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("az acr import -n mycontainerregistry001 --source mcr.microsoft.com/acr/connected-registry:0.3.0\naz acr import -n mycontainerregistry001 --source mcr.microsoft.com/azureiotedge-agent:1.2\naz acr import -n mycontainerregistry001 --source mcr.microsoft.com/azureiotedge-hub:1.2\naz acr import -n mycontainerregistry001 --source mcr.microsoft.com/azureiotedge-api-proxy:latest\naz acr import -n mycontainerregistry001 --source mcr.microsoft.com/hello-world:latest\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br")])]),t("h2",{attrs:{id:"create-a-connected-registry-resource-for-pull-push-functionality"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#create-a-connected-registry-resource-for-pull-push-functionality"}},[e._v("#")]),e._v(" Create a connected registry resource for pull/push functionality")]),e._v(" "),t("p",[e._v("Create a connected registry using the "),t("a",{attrs:{href:"https://docs.microsoft.com/cli/azure/acr/connected-registry?view=azure-cli-latest#az_acr_connected_registry_create",target:"_blank",rel:"noopener noreferrer"}},[e._v("az acr connected-registry create"),t("OutboundLink")],1),e._v(" command. Name must start with a letter and contain only alphanumeric characters. It must be 5 to 40 characters long and unique in the hierarchy for this Azure Container Registry.")]),e._v(" "),t("div",{staticClass:"language-azurecli line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('az acr connected-registry create --registry mycontainerregistry001 \\\n  --name myconnectedregistry \\\n  --repository "hello-world" "acr/connected-registry" "azureiotedge-agent" "azureiotedge-hub" "azureiotedge-api-proxy"\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br")])]),t("p",[e._v("The above command will create a connected registry resource in Azure and link it to the "),t("em",[e._v("mycontainerregistry001")]),e._v(" cloud ACR. The "),t("em",[e._v("hello-world")]),e._v(" and "),t("em",[e._v("acr/connected-registry")]),e._v(" repositories will be synchronized between the cloud ACR and the registry on premises. Because no "),t("code",[e._v("--mode")]),e._v(" option is specified for the connected registry, it will allow "),t("em",[e._v("pull")]),e._v(" and "),t("em",[e._v("push")]),e._v(" functionality by default. Because there is no synchronization schedule defined for this connected registry, both repositories will be synchronized between the cloud registry and the connected registry without interruptions.")]),e._v(" "),t("blockquote",[t("p",[e._v("[!IMPORTANT]\nTo support nested scenarios where lower layers have no Internet access, you must always allow synchronization of the "),t("code",[e._v("acr/connected-registry")]),e._v(" repository. This repository contains the image for the connected registry runtime.")])]),e._v(" "),t("h2",{attrs:{id:"create-a-connected-registry-resource-for-pull-only-functionality"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#create-a-connected-registry-resource-for-pull-only-functionality"}},[e._v("#")]),e._v(" Create a connected registry resource for pull-only functionality")]),e._v(" "),t("p",[e._v("You can use the connected registry "),t("a",{attrs:{href:"https://docs.microsoft.com/cli/azure/acr/connected-registry?view=azure-cli-latest#az_acr_connected_registry_create",target:"_blank",rel:"noopener noreferrer"}},[e._v("az acr connected-registry create"),t("OutboundLink")],1),e._v(" command to create a connected registry with "),t("em",[e._v("pull")]),e._v("-only functionality.")]),e._v(" "),t("div",{staticClass:"language-azurecli line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('az acr connected-registry create --registry mycontainerregistry001 \\\n  --parent myconnectedregistry \\\n  --name myconnectedmirror \\\n  --repository "hello-world" "acr/connected-registry" "azureiotedge-agent" "azureiotedge-hub" "azureiotedge-api-proxy" \\\n  --mode mirror\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br")])]),t("p",[e._v("The above command will create a connected registry resource in Azure and link it to the "),t("em",[e._v("mycontainerregistry001")]),e._v(" cloud ACR. The "),t("em",[e._v("hello-world")]),e._v(" repository will be synchronized between the cloud ACR and the registry on premises. This resource will be enabled for "),t("em",[e._v("pull")]),e._v("-only functionality once deployed. Because there is no synchronization schedule defined for this connected registry, both repositories will be synchronized between the cloud registry and the connected registry without interruptions.")]),e._v(" "),t("h2",{attrs:{id:"verify-that-the-resources-are-created"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#verify-that-the-resources-are-created"}},[e._v("#")]),e._v(" Verify that the resources are created")]),e._v(" "),t("p",[e._v("You can use the connected registry "),t("a",{attrs:{href:"https://docs.microsoft.com/cli/azure/acr/connected-registry?view=azure-cli-latest#az_acr_connected_registry_list",target:"_blank",rel:"noopener noreferrer"}},[e._v("az acr connected-registry list"),t("OutboundLink")],1),e._v(" command to verify that the resources are created.")]),e._v(" "),t("div",{staticClass:"language-azurecli line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("az acr connected-registry list \\\n  --registry mycontainerregistry001 \\\n  --output table\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br")])]),t("p",[e._v("You should see a response as follows:")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("NAME                 MODE      STATUS    PARENT    LOGIN SERVER    LAST SYNC\n-------------------  --------  --------  --------  --------------  -----------\nmyconnectedregistry  registry\nmyconnectedmirror    mirror\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br")])]),t("h2",{attrs:{id:"next-steps"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#next-steps"}},[e._v("#")]),e._v(" Next steps")]),e._v(" "),t("p",[e._v("In this quickstart, you used Azure CLI to create a connected registry resources in Azure. Those new connected registry resources are tied to your Azure Container Registry and allow synchronization of artifact between the cloud registry and the on-premises registry. Continue to the connected registry deployment guides to learn how to deploy the connected registry on your on-premises infrastructure.")]),e._v(" "),t("blockquote",[t("p",[t("RouterLink",{attrs:{to:"/preview/connected-registry/quickstart-deploy-connected-registry-iot-edge-cli.html"}},[e._v("Quickstart: Deploy connected registry on IoT Edge")])],1)])])}),[],!1,null,null,null);r.default=a.exports}}]);