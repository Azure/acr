<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Quarantine Pattern | Azure Container Registry</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/acr/assets/css/0.styles.1adce09e.css" as="style"><link rel="preload" href="/acr/assets/js/app.3ca3959d.js" as="script"><link rel="preload" href="/acr/assets/js/2.4abe739f.js" as="script"><link rel="preload" href="/acr/assets/js/43.428cb1ec.js" as="script"><link rel="prefetch" href="/acr/assets/js/10.080d8072.js"><link rel="prefetch" href="/acr/assets/js/11.a8cae62e.js"><link rel="prefetch" href="/acr/assets/js/12.e62ede07.js"><link rel="prefetch" href="/acr/assets/js/13.88956df0.js"><link rel="prefetch" href="/acr/assets/js/14.da996b77.js"><link rel="prefetch" href="/acr/assets/js/15.128615bf.js"><link rel="prefetch" href="/acr/assets/js/16.28bd344b.js"><link rel="prefetch" href="/acr/assets/js/17.3154ce14.js"><link rel="prefetch" href="/acr/assets/js/18.1a01df13.js"><link rel="prefetch" href="/acr/assets/js/19.d6cd2dad.js"><link rel="prefetch" href="/acr/assets/js/20.3cb003a6.js"><link rel="prefetch" href="/acr/assets/js/21.b60fd558.js"><link rel="prefetch" href="/acr/assets/js/22.7d86dba4.js"><link rel="prefetch" href="/acr/assets/js/23.dd656471.js"><link rel="prefetch" href="/acr/assets/js/24.e228cfdd.js"><link rel="prefetch" href="/acr/assets/js/25.197c3531.js"><link rel="prefetch" href="/acr/assets/js/26.29caa7ed.js"><link rel="prefetch" href="/acr/assets/js/27.fb8da073.js"><link rel="prefetch" href="/acr/assets/js/28.6e4543d4.js"><link rel="prefetch" href="/acr/assets/js/29.a76509db.js"><link rel="prefetch" href="/acr/assets/js/3.f910cf4c.js"><link rel="prefetch" href="/acr/assets/js/30.994ccbbb.js"><link rel="prefetch" href="/acr/assets/js/31.f2c11b52.js"><link rel="prefetch" href="/acr/assets/js/32.840e79d8.js"><link rel="prefetch" href="/acr/assets/js/33.2df67567.js"><link rel="prefetch" href="/acr/assets/js/34.e38730f2.js"><link rel="prefetch" href="/acr/assets/js/35.46229160.js"><link rel="prefetch" href="/acr/assets/js/36.9f898214.js"><link rel="prefetch" href="/acr/assets/js/37.9c3a93a2.js"><link rel="prefetch" href="/acr/assets/js/38.2cbce8d9.js"><link rel="prefetch" href="/acr/assets/js/39.f4bfa261.js"><link rel="prefetch" href="/acr/assets/js/4.1d1d93b6.js"><link rel="prefetch" href="/acr/assets/js/40.bc1f46d1.js"><link rel="prefetch" href="/acr/assets/js/41.2dbb6a30.js"><link rel="prefetch" href="/acr/assets/js/42.84fa6a12.js"><link rel="prefetch" href="/acr/assets/js/44.3b6b967d.js"><link rel="prefetch" href="/acr/assets/js/45.fd0d1d9e.js"><link rel="prefetch" href="/acr/assets/js/46.19cb06fd.js"><link rel="prefetch" href="/acr/assets/js/47.8c0d7628.js"><link rel="prefetch" href="/acr/assets/js/48.619e29e6.js"><link rel="prefetch" href="/acr/assets/js/49.3ba8bd2c.js"><link rel="prefetch" href="/acr/assets/js/5.943fad70.js"><link rel="prefetch" href="/acr/assets/js/50.0c02f626.js"><link rel="prefetch" href="/acr/assets/js/51.b822281a.js"><link rel="prefetch" href="/acr/assets/js/52.9a8a029d.js"><link rel="prefetch" href="/acr/assets/js/53.57ca9884.js"><link rel="prefetch" href="/acr/assets/js/54.86e09cf3.js"><link rel="prefetch" href="/acr/assets/js/55.21039511.js"><link rel="prefetch" href="/acr/assets/js/56.b6f67eae.js"><link rel="prefetch" href="/acr/assets/js/57.0266cf09.js"><link rel="prefetch" href="/acr/assets/js/58.249e8925.js"><link rel="prefetch" href="/acr/assets/js/59.a2f8607d.js"><link rel="prefetch" href="/acr/assets/js/6.c89b0c48.js"><link rel="prefetch" href="/acr/assets/js/60.f13d2f1c.js"><link rel="prefetch" href="/acr/assets/js/7.cf63200c.js"><link rel="prefetch" href="/acr/assets/js/8.9e525704.js"><link rel="prefetch" href="/acr/assets/js/9.b9ebe781.js">
    <link rel="stylesheet" href="/acr/assets/css/0.styles.1adce09e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/acr/" class="home-link router-link-active"><img src="/acr/files/acr.svg" alt="Azure Container Registry" class="logo"> <span class="site-name can-hide">Azure Container Registry</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/azure/acr" target="_blank" rel="noopener noreferrer" class="repo-link">
    Star this Repo
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/azure/acr" target="_blank" rel="noopener noreferrer" class="repo-link">
    Star this Repo
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/acr/" aria-current="page" class="sidebar-link">Overview</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acr/#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/acr/#blog-posts" class="sidebar-link">Blog posts</a></li><li class="sidebar-sub-header"><a href="/acr/#links" class="sidebar-link">Links</a></li></ul></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Teleport</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Tasks</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Authentication</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Integration</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="quarantine-pattern"><a href="#quarantine-pattern" class="header-anchor">#</a> Quarantine Pattern</h1> <p>To assure a registry only contains images that have been vulnerability scanned, ACR introduces the Quarantine pattern.
When a registries policy is set to Quarantine Enabled, all images pushed to that registry are put in quarantine by default. Only after the image has been verifed, and the quarantine flag removed may a subsequent pull be completed.</p> <blockquote><p>Note: This is an early preview of this workflow. Additional capabilities will be added, including CLI and Portal support.</p></blockquote> <h1 id="current-workflow"><a href="#current-workflow" class="header-anchor">#</a> Current Workflow</h1> <h2 id="quarantined-webhook-notification"><a href="#quarantined-webhook-notification" class="header-anchor">#</a> Quarantined Webhook Notification</h2> <p>No matter if you have quarantine flow enabled or not, scanner can always subscribe to the &quot;quarantine&quot; webhook. when an image is pushed, we will try to notify the matching &quot;quarantine&quot; webhook, with payload as below:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0d799b14-404b-4859-b2f6-50c5ee2a2c3a&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2018-02-28T00:42:54.4509516Z&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;action&quot;</span><span class="token operator">:</span> <span class="token string">&quot;quarantine&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;target&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">1791</span><span class="token punctuation">,</span>
    <span class="token property">&quot;digest&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sha256:91ef6&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;length&quot;</span><span class="token operator">:</span> <span class="token number">1791</span><span class="token punctuation">,</span>
    <span class="token property">&quot;repository&quot;</span><span class="token operator">:</span> <span class="token string">&quot;helloworld&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;tag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;request&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;978fc988-zzz-yyyy-xxxx-4f6e331d1591&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;host&quot;</span><span class="token operator">:</span> <span class="token string">&quot;[registry].azurecr.io&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;method&quot;</span><span class="token operator">:</span> <span class="token string">&quot;PUT&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>You can use our <a href="https://docs.microsoft.com/en-us/rest/api/containerregistry/webhooks/create" target="_blank" rel="noopener noreferrer">management Webhook API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to create and subscribe for the &quot;quarantine&quot; webhook (the actions field need to use the &quot;quarantine&quot; action).</p> <blockquote><blockquote><p>In order to call the above management API, you need to get an access token which is be used as the Authorization header . Here is an <a href="https://blogs.technet.microsoft.com/stefan_stranger/2016/10/21/using-the-azure-arm-rest-apin-get-access-token/" target="_blank" rel="noopener noreferrer">example<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> on how to get access token for a Service Principal:</p></blockquote></blockquote> <blockquote><blockquote></blockquote></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>curl --request POST &quot;https://login.windows.net/{TenantId}/oauth2/token&quot; --data-urlencode &quot;resource=https://management.core.windows.net&quot; --data-urlencode &quot;client_id={appId}&quot; --data-urlencode &quot;grant_type=client_credentials&quot; --data-urlencode &quot;client_secret={app secret}&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Before Quarantine is configured on the registry, both &quot;quarantine&quot; and &quot;push&quot; webhook will be raised for each image push. The scanner can subscribe to &quot;quarantine&quot; webhook and conduct security scan for the newly pushed image; while normal user can subscribe to the normal &quot;push&quot; webhook and pull the image successfully.</p> <h2 id="configure-quarantine-on-a-registry"><a href="#configure-quarantine-on-a-registry" class="header-anchor">#</a> Configure Quarantine on a registry</h2> <p>Once a user decides to enable Quarantine on a registry, he can use our <a href="https://docs.microsoft.com/en-us/rest/api/containerregistry/registries/update#policies" target="_blank" rel="noopener noreferrer">management Policy API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>Once Quarantine is enabled on a registry, for newly pushed image, it will enter quarantine state automatically and only a user with quarantine reader permissions can see the image. Meanwhile, the same &quot;quarantine&quot; webhook will be raised, but no &quot;push&quot; notification anymore. This gives the scanner a chance to scan the image first before making it available to other users.</p> <p>Once scanner finishes scanning the image, it can mark the image as good, which will make this image available to all other users. Meanwhile a &quot;push&quot; notification is generated so that other users are notified.</p> <blockquote><p>Please note, once the Quarantine is enabled, any images without being marked as good will be blocked for pull. This may impact user's ongoing workflow. We would recommend that before enable Qurantine mode on the registry, the scanner should finish scanning all the existing images (this can be done by using catalog API and manifest list API). User can then look at the failed images and decide if he should enable the Quarantine mode.</p></blockquote> <p>The detailed flow is described below.</p> <h2 id="name-your-registry"><a href="#name-your-registry" class="header-anchor">#</a> name your registry</h2> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">ACR_NAME</span><span class="token operator">=</span>quarantine
<span class="token builtin class-name">export</span> <span class="token assign-left variable">REGISTRY_NAME</span><span class="token operator">=</span><span class="token variable">$ACR_NAME</span>.azurecr.io
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="login-to-the-dogfood-registry"><a href="#login-to-the-dogfood-registry" class="header-anchor">#</a> Login to the dogfood registry</h2> <p><code>docker login $REGISTRY_NAME</code></p> <h2 id="push-an-image"><a href="#push-an-image" class="header-anchor">#</a> Push an image</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker push  ${REGISTRY_NAME}helloworld:1
 96c922e98de8: Pushed
 digest: sha256:80f0d5cxxxxXxxXxxxxece0db56d11cdc624ad20da9fe62d7d size: 524
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>The image is now quarantined</p> <h2 id="attempt-to-pull-the-quarantined-image"><a href="#attempt-to-pull-the-quarantined-image" class="header-anchor">#</a> Attempt to pull the quarantined image</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker pull  ${REGISTRY_NAME}helloworld:1
Error response from daemon: manifest for quarantinetest1.azurecr.io/helloworld:1 not found
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="attempt-to-pull-the-image-by-its-digest"><a href="#attempt-to-pull-the-image-by-its-digest" class="header-anchor">#</a> Attempt to pull the image by its digest</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker pull ${REGISTRY_NAME}helloworld@sha256:80f0d5cxxxxXxxXxxxxece0db56d11cdc624ad20da9fe62d7d
		Error response from daemon: unknown: The operation is disallowed.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="quarantined-webhook-notification-2"><a href="#quarantined-webhook-notification-2" class="header-anchor">#</a> Quarantined Webhook Notification</h2> <p>Once the image is pushed, you will receive a notification through webhooks.</p> <h2 id="pull-the-quarantined-image"><a href="#pull-the-quarantined-image" class="header-anchor">#</a> Pull the quarantined image</h2> <p>Once the image is quarantined, you will need user with the <strong>AcrQuarantineReader</strong> role. The presumption here is the Vulnerability Scanning solution is configured to use this account.</p> <p><code>docker login ${REGISTRY_NAME} -u</code> <strong>[quarantinedServicePrincpalUsr]</strong><code>-p</code><strong>[quarantinedServicePrincpalPwd]</strong></p> <p>Now the user can pull the quarantined image by digest</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker pull [registry].azurecr.io/helloworld@sha256:sha256:80f0d5cxxxxXxxXxxxxece0db56d11cdc624ad20da9fe62d7d
  Pulling from helloworld
	Digest: sha256:80f0d5cxxxxXxxXxxxxece0db56d11cdc624ad20da9fe62d7d
	Status: Image is up to date for [registry].azurecr.io/helloworld@sha256:80f0d5cxxxxXxxXxxxxece0db56d11cdc624ad20da9fe62d7d
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="query-attributes-of-an-image-manifest"><a href="#query-attributes-of-an-image-manifest" class="header-anchor">#</a> Query Attributes of an Image (manifest)</h2> <p>Querying ACR metadata via the REST API requires an OAuth Token.</p> <p>To query attributes via REST, use the following workflow:</p> <ol><li>encode the username/password with the required permissions</li> <li>get an access token</li> <li>query acr metadata for the attributes of a given digest</li></ol> <h3 id="get-an-acr-access-token-for-the-user"><a href="#get-an-acr-access-token-for-the-user" class="header-anchor">#</a> Get an ACR access token for the user</h3> <p>Please refer to <a href="https://github.com/Azure/acr/tree/master/docs/Token-BasicAuth.md" target="_blank" rel="noopener noreferrer">this document<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> on how to get an access token.</p> <div class="language- extra-class"><pre><code>example: 
```
GET https://quarantinetest1.azurecr.io/oauth2/token?service=quarantinetest1.azurecr.io&amp;scope=repository:helloworld:pull
```
</code></pre></div><h3 id="query-the-metadata-api"><a href="#query-the-metadata-api" class="header-anchor">#</a> Query the metadata API</h3> <ul><li><p>With an OAuth token, we can now query ACR metadata:</p> <p>REST format: <code>https://</code><strong>[login-url]</strong><code>/acr/v1/</code><strong>[image]</strong><code>/_manifests/</code><strong>[digest]</strong></p></li> <li><p>Set the header for Authorization, setting the OAuth token</p> <table><thead><tr><th>Header</th> <th>Value</th></tr></thead> <tbody><tr><td>Authorization</td> <td>Bearer [token]</td></tr> <tr><td>Host</td> <td>[login-url]</td></tr></tbody></table> <p>example:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>GET https://quarantinetest1.azurecr.io/acr/v1/mytest/_manifests/sha256:80f0d5cxxxxXxxXxxxxece0db56d11cdc624ad20da9fe62d7d
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <h2 id="remove-the-quarantine-flag"><a href="#remove-the-quarantine-flag" class="header-anchor">#</a> Remove the Quarantine Flag</h2> <p>Once a scan completes, a user with the <strong>AcrQuarantineWriter</strong> role can update the manifest attribute to removed the quarantined flag.</p> <h3 id="get-an-acr-push-access-token-for-the-user"><a href="#get-an-acr-push-access-token-for-the-user" class="header-anchor">#</a> Get an ACR Push access token for the user</h3> <p>Please refer to <a href="https://github.com/Azure/acr/tree/master/docs/Token-BasicAuth.md" target="_blank" rel="noopener noreferrer">this document<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> on how to get an access token.</p> <div class="language- extra-class"><pre><code>example: 
```
GET https://quarantinetest1.azurecr.io/oauth2/token?service=quarantinetest1.azurecr-test.io&amp;scope=repository:helloworld:pull,push
```
</code></pre></div><h3 id="remove-the-quarantine-flag-2"><a href="#remove-the-quarantine-flag-2" class="header-anchor">#</a> Remove the Quarantine Flag</h3> <ul><li><p>Update manifest attributes using the access token.<br>
REST format: <code>PATCH https://</code><strong>[login-url]</strong>/<code>acr/v1/</code><strong>[image]</strong><code>/_manifests/</code><strong>[digest]</strong></p> <p>Payload:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>    <span class="token punctuation">{</span>
        <span class="token property">&quot;quarantineState&quot;</span><span class="token operator">:</span> <span class="token string">&quot;[Passed|Failed]&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;quarantineDetails&quot;</span><span class="token operator">:</span> <span class="token string">&quot;[json string of detailed results]&quot;</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>Note: the quarantineDetails schema is defined at <a href="https://github.com/Azure/acr/tree/master/docs/preview/quarantine/quarantine-details/schema.json" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <table><thead><tr><th>Header</th> <th>Value</th></tr></thead> <tbody><tr><td>Authorization</td> <td>Bearer [token]</td></tr> <tr><td>Host</td> <td>[login-url]</td></tr></tbody></table> <p>example:</p> <p>PATCH https://quarantinetest1.azurecr.io/acr/v1/mytest/_manifests/sha256:80f0d5c8786bb9e621a45ece0db56d11cdc624ad20da9fe62e9d25490f331d7d HTTP/1.1</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>    <span class="token punctuation">{</span>
        <span class="token property">&quot;quarantineState&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Passed&quot;</span><span class="token punctuation">,</span> 
        <span class="token property">&quot;quarantineDetails&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{\&quot;state\&quot;:\&quot;scan passed\&quot;,\&quot;link\&quot;:\&quot;http://test.io/test\&quot;}&quot;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ul> <h2 id="image-pushed-webhook-notification"><a href="#image-pushed-webhook-notification" class="header-anchor">#</a> Image Pushed Webhook Notification</h2> <p>Based on the registry policy, once the image has been set to <strong>Passed</strong>, a Image Pushed webhook will triggered</p> <h2 id="image-pull"><a href="#image-pull" class="header-anchor">#</a> Image Pull</h2> <p>With the quarantine removed, a user with standard <strong>reader</strong> role can pull the image, using the tag</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker login ${REGISTRY_NAME}
docker pull ${REGISTRY_NAME}helloworld:1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/azure/acr/edit/master/docs/preview/quarantine/readme.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/acr/assets/js/app.3ca3959d.js" defer></script><script src="/acr/assets/js/2.4abe739f.js" defer></script><script src="/acr/assets/js/43.428cb1ec.js" defer></script>
  </body>
</html>
