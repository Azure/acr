<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Quickstart - Deploy a connected registry to a nested IoT Edge device | Azure Container Registry</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Use Azure Container Registry CLI commands and Azure portal to deploy a connected registry to a nested Azure IoT Edge device.">
    
    <link rel="preload" href="/acr/assets/css/0.styles.1adce09e.css" as="style"><link rel="preload" href="/acr/assets/js/app.3ca3959d.js" as="script"><link rel="preload" href="/acr/assets/js/2.4abe739f.js" as="script"><link rel="preload" href="/acr/assets/js/37.9c3a93a2.js" as="script"><link rel="prefetch" href="/acr/assets/js/10.080d8072.js"><link rel="prefetch" href="/acr/assets/js/11.a8cae62e.js"><link rel="prefetch" href="/acr/assets/js/12.e62ede07.js"><link rel="prefetch" href="/acr/assets/js/13.88956df0.js"><link rel="prefetch" href="/acr/assets/js/14.da996b77.js"><link rel="prefetch" href="/acr/assets/js/15.128615bf.js"><link rel="prefetch" href="/acr/assets/js/16.28bd344b.js"><link rel="prefetch" href="/acr/assets/js/17.3154ce14.js"><link rel="prefetch" href="/acr/assets/js/18.1a01df13.js"><link rel="prefetch" href="/acr/assets/js/19.d6cd2dad.js"><link rel="prefetch" href="/acr/assets/js/20.3cb003a6.js"><link rel="prefetch" href="/acr/assets/js/21.b60fd558.js"><link rel="prefetch" href="/acr/assets/js/22.7d86dba4.js"><link rel="prefetch" href="/acr/assets/js/23.dd656471.js"><link rel="prefetch" href="/acr/assets/js/24.e228cfdd.js"><link rel="prefetch" href="/acr/assets/js/25.197c3531.js"><link rel="prefetch" href="/acr/assets/js/26.29caa7ed.js"><link rel="prefetch" href="/acr/assets/js/27.fb8da073.js"><link rel="prefetch" href="/acr/assets/js/28.6e4543d4.js"><link rel="prefetch" href="/acr/assets/js/29.a76509db.js"><link rel="prefetch" href="/acr/assets/js/3.f910cf4c.js"><link rel="prefetch" href="/acr/assets/js/30.994ccbbb.js"><link rel="prefetch" href="/acr/assets/js/31.f2c11b52.js"><link rel="prefetch" href="/acr/assets/js/32.840e79d8.js"><link rel="prefetch" href="/acr/assets/js/33.2df67567.js"><link rel="prefetch" href="/acr/assets/js/34.e38730f2.js"><link rel="prefetch" href="/acr/assets/js/35.46229160.js"><link rel="prefetch" href="/acr/assets/js/36.9f898214.js"><link rel="prefetch" href="/acr/assets/js/38.2cbce8d9.js"><link rel="prefetch" href="/acr/assets/js/39.f4bfa261.js"><link rel="prefetch" href="/acr/assets/js/4.1d1d93b6.js"><link rel="prefetch" href="/acr/assets/js/40.bc1f46d1.js"><link rel="prefetch" href="/acr/assets/js/41.2dbb6a30.js"><link rel="prefetch" href="/acr/assets/js/42.84fa6a12.js"><link rel="prefetch" href="/acr/assets/js/43.428cb1ec.js"><link rel="prefetch" href="/acr/assets/js/44.3b6b967d.js"><link rel="prefetch" href="/acr/assets/js/45.fd0d1d9e.js"><link rel="prefetch" href="/acr/assets/js/46.19cb06fd.js"><link rel="prefetch" href="/acr/assets/js/47.8c0d7628.js"><link rel="prefetch" href="/acr/assets/js/48.619e29e6.js"><link rel="prefetch" href="/acr/assets/js/49.3ba8bd2c.js"><link rel="prefetch" href="/acr/assets/js/5.943fad70.js"><link rel="prefetch" href="/acr/assets/js/50.0c02f626.js"><link rel="prefetch" href="/acr/assets/js/51.b822281a.js"><link rel="prefetch" href="/acr/assets/js/52.9a8a029d.js"><link rel="prefetch" href="/acr/assets/js/53.57ca9884.js"><link rel="prefetch" href="/acr/assets/js/54.86e09cf3.js"><link rel="prefetch" href="/acr/assets/js/55.21039511.js"><link rel="prefetch" href="/acr/assets/js/56.b6f67eae.js"><link rel="prefetch" href="/acr/assets/js/57.0266cf09.js"><link rel="prefetch" href="/acr/assets/js/58.249e8925.js"><link rel="prefetch" href="/acr/assets/js/59.a2f8607d.js"><link rel="prefetch" href="/acr/assets/js/6.c89b0c48.js"><link rel="prefetch" href="/acr/assets/js/60.f13d2f1c.js"><link rel="prefetch" href="/acr/assets/js/7.cf63200c.js"><link rel="prefetch" href="/acr/assets/js/8.9e525704.js"><link rel="prefetch" href="/acr/assets/js/9.b9ebe781.js">
    <link rel="stylesheet" href="/acr/assets/css/0.styles.1adce09e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/acr/" class="home-link router-link-active"><img src="/acr/files/acr.svg" alt="Azure Container Registry" class="logo"> <span class="site-name can-hide">Azure Container Registry</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/azure/acr" target="_blank" rel="noopener noreferrer" class="repo-link">
    Star this Repo
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/azure/acr" target="_blank" rel="noopener noreferrer" class="repo-link">
    Star this Repo
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/acr/" aria-current="page" class="sidebar-link">Overview</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acr/#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/acr/#blog-posts" class="sidebar-link">Blog posts</a></li><li class="sidebar-sub-header"><a href="/acr/#links" class="sidebar-link">Links</a></li></ul></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Teleport</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Tasks</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Authentication</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Integration</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="quickstart-deploy-a-connected-registry-to-a-nested-iot-edge-device"><a href="#quickstart-deploy-a-connected-registry-to-a-nested-iot-edge-device" class="header-anchor">#</a> Quickstart: Deploy a connected registry to a nested IoT Edge device</h1> <p>In this quickstart, you use <a href="/acr/preview/connected-registry/container-registry-intro.html">Azure Container Registry</a> commands to deploy a connected registry to a nested Azure IoT Edge device. You can review the <a href="/acr/preview/connected-registry/intro-connected-registry.html">ACR connected registry introduction</a> for details about the connected registry feature of Azure Container Registry.</p> <p>[!INCLUDE <a href="https://docs.microsoft.com/en-us/azure/iot-edge/quickstart-linux?view=iotedge-2018-06" target="_blank" rel="noopener noreferrer">quickstarts<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>]</p> <p>[!INCLUDE <a href="https://github.com/MicrosoftDocs/azure-docs/blob/master/includes/azure-cli-prepare-your-environment.md" target="_blank" rel="noopener noreferrer">azure-cli-prepare-your-environment.md<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>]</p> <h2 id="before-you-begin"><a href="#before-you-begin" class="header-anchor">#</a> Before you begin</h2> <p>This tutorial also requires that you have the knowledge about set up a connected registry on a IoT Edge device by following the <a href="/acr/preview/connected-registry/quickstart-deploy-connected-registry-iot-edge-cli.html">Quickstart: Deploy a connected registry to an IoT Edge device</a>.</p> <p>Also, make sure that you have created the connected registry resource in Azure as described in the <a href="/acr/preview/connected-registry/quickstart-connected-registry-cli.html">Create connected registry using the CLI</a> quickstart guide. Only <code>mirror</code> mode will work for this scenario.</p> <h2 id="retrieve-connected-registry-configuration-information"><a href="#retrieve-connected-registry-configuration-information" class="header-anchor">#</a> Retrieve connected registry configuration information</h2> <p>Before deploying the connected registry to the nested IoT Edge device, you will need to retrieve the configuration from the connected registry resource in Azure. Use the <a href="/cli/azure/acr#az-acr-connected-registry-install">az acr connected-registry install</a> command to retrieve the configuration.</p> <div class="language-azurecli line-numbers-mode"><pre class="language-text"><code>az acr connected-registry install renew-credentials \
  --registry mycontainerregistry001 \
  --name myconnectedmirror \
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>This will return the connection string for the connected registry including the newly generated passwords.</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;ACR_REGISTRY_CONNECTION_STRING&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ConnectedRegistryName=myconnectedmirror;SyncTokenName=myconnectedmirror-sync-token;SyncTokenPassword=s0meCoMPL3xP4$$W0rd001!@#;ParentGatewayEndpoint=&lt;parent gateway endpoint&gt;;ParentEndpointProtocol=&lt;http or https&gt;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;ACR_REGISTRY_LOGIN_SERVER&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&lt;Optional: connected registry login server. More info at https://aka.ms/acr/connected-registry&gt;&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>The JSON above lists the environment variables that need to be passed to the connected registry container at run time. The following environment variables are optional:</p> <ul><li><code>ACR_REGISTRY_LOGIN_SERVER</code> - this is the hostname or FQDN of the IoT Edge device that hosts the connected registry.</li></ul> <p>You will need the information for the IoT Edge manifest below.</p> <blockquote><p>[!IMPORTANT]
Make sure that you save the generated connection string. The connection string contains one-time password that cannot be retrieved. If you issue the command again, new passwords will be generated. You can generate new passwords using the <a href="/cli/azure/acr/credential#az-acr-token-credential-generate">az acr token credential generate</a> command.</p></blockquote> <h2 id="configure-a-deployment-manifest-for-the-nested-iot-edge"><a href="#configure-a-deployment-manifest-for-the-nested-iot-edge" class="header-anchor">#</a> Configure a deployment manifest for the nested IoT Edge</h2> <p>A deployment manifest is a JSON document that describes which modules to deploy to the IoT Edge device. For more information about how deployment manifests work and how to create them, see <a href="https://docs.microsoft.com/en-us/azure/iot-edge/module-composition?view=iotedge-2020-11#:~:text=The%20IoT%20Edge%20agent%20module,should%20be%20created%20and%20managed." target="_blank" rel="noopener noreferrer">Understand how IoT Edge modules can be used, configured, and reused<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>To deploy the connected registry module using the Azure CLI, save the following deployment manifest locally as a <code>.json</code> file.</p> <p>[!IMPORTANT] In the following deployment manifest, $upstream will be used as the IP or FQDN of the device hosting parent connected registry. However $upstream is not supported in env variable. The connected registry need read env variable ACR_PARENT_GATEWAY_ENDPOINT to get the parent gateway endpoint. Instead of using $upstream, connected registry supports dynamically resolving the IP or FQDN from another env variable. On the nested IoT, there's env variable $IOTEDGE_PARENTHOSTNAME on lower level that is equal to IP or FQDN of the parent device. We can pass this env variable as the value of ACR_PARENT_GATEWAY_ENDPOINT to avoid hardcode the parent IP or FQDN.</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;modulesContent&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;$edgeAgent&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;properties.desired&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;modules&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">&quot;connected-registry&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token property">&quot;settings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                            <span class="token property">&quot;image&quot;</span><span class="token operator">:</span> <span class="token string">&quot;$upstream/acr/connected-registry:0.3.0&quot;</span><span class="token punctuation">,</span>
                            <span class="token property">&quot;createOptions&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{\&quot;HostConfig\&quot;:{\&quot;Binds\&quot;:[\&quot;/home/azureuser/connected-registry:/var/acr/data\&quot;,\&quot;/usr/local/share/ca-certificates:/usr/local/share/ca-certificates\&quot;,\&quot;/etc/ssl/certs:/etc/ssl/certs\&quot;,\&quot;LogConfig\&quot;:{ \&quot;Type\&quot;: \&quot;json-file\&quot;, \&quot;Config\&quot;: {\&quot;max-size\&quot;: \&quot;10m\&quot;,\&quot;max-file\&quot;: \&quot;3\&quot;}}]}}&quot;</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;docker&quot;</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;env&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                            <span class="token property">&quot;ACR_REGISTRY_CONNECTION_STRING&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ConnectedRegistryName=myconnectedmirror;SyncTokenName=myconnectedmirror-sync-token;SyncTokenPassword=s0meCoMPL3xP4$$W0rd001!@#;ParentGatewayEndpoint=$IOTEDGE_PARENTHOSTNAME;ParentEndpointProtocol=https&quot;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;status&quot;</span><span class="token operator">:</span> <span class="token string">&quot;running&quot;</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;restartPolicy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;always&quot;</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0&quot;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;IoTEdgeApiProxy&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token property">&quot;settings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                            <span class="token property">&quot;image&quot;</span><span class="token operator">:</span> <span class="token string">&quot;$upstream/azureiotedge-api-proxy:9.9.9-dev&quot;</span><span class="token punctuation">,</span>
                            <span class="token property">&quot;createOptions&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{\&quot;HostConfig\&quot;: {\&quot;PortBindings\&quot;: {\&quot;443/tcp\&quot;: [{\&quot;HostPort\&quot;: \&quot;443\&quot;}]}}}&quot;</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;docker&quot;</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0&quot;</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;env&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                            <span class="token property">&quot;NGINX_DEFAULT_PORT&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;443&quot;</span>
                            <span class="token punctuation">}</span><span class="token punctuation">,</span>
                            <span class="token property">&quot;CONNECTED_ACR_ROUTE_ADDRESS&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;connectedRegistry:8080&quot;</span>
                            <span class="token punctuation">}</span><span class="token punctuation">,</span>
                            <span class="token property">&quot;NGINX_CONFIG_ENV_VAR_LIST&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                    <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;NGINX_DEFAULT_PORT,BLOB_UPLOAD_ROUTE_ADDRESS,CONNECTED_ACR_ROUTE_ADDRESS,IOTEDGE_PARENTHOSTNAME,DOCKER_REQUEST_ROUTE_ADDRESS&quot;</span>
                            <span class="token punctuation">}</span><span class="token punctuation">,</span>
                            <span class="token property">&quot;BLOB_UPLOAD_ROUTE_ADDRESS&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;AzureBlobStorageonIoTEdge:11002&quot;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;status&quot;</span><span class="token operator">:</span> <span class="token string">&quot;running&quot;</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;restartPolicy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;always&quot;</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;startupOrder&quot;</span><span class="token operator">:</span> <span class="token number">3</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token property">&quot;runtime&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">&quot;settings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token property">&quot;minDockerVersion&quot;</span><span class="token operator">:</span> <span class="token string">&quot;v1.25&quot;</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;registryCredentials&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                            <span class="token property">&quot;tsmregistry&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;$upstream&quot;</span><span class="token punctuation">,</span>
                                <span class="token property">&quot;password&quot;</span><span class="token operator">:</span> <span class="token string">&quot;$$$0meCoMPL3xP4$$W0rd001!@#$$&quot;</span><span class="token punctuation">,</span>
                                <span class="token property">&quot;username&quot;</span><span class="token operator">:</span> <span class="token string">&quot;myconnectedmirror-sync-token&quot;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;docker&quot;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token property">&quot;schemaVersion&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.1&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;systemModules&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">&quot;edgeAgent&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token property">&quot;settings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                            <span class="token property">&quot;image&quot;</span><span class="token operator">:</span> <span class="token string">&quot;$upstream/azureiotedge-agent:20210609.5&quot;</span><span class="token punctuation">,</span>
                            <span class="token property">&quot;createOptions&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;docker&quot;</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;env&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                            <span class="token property">&quot;SendRuntimeQualityTelemetry&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;false&quot;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;edgeHub&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token property">&quot;settings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                            <span class="token property">&quot;image&quot;</span><span class="token operator">:</span> <span class="token string">&quot;$upstream/azureiotedge-hub:20210609.5&quot;</span><span class="token punctuation">,</span>
                            <span class="token property">&quot;createOptions&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{\&quot;HostConfig\&quot;:{\&quot;PortBindings\&quot;:{\&quot;443/tcp\&quot;:[{\&quot;HostPort\&quot;:\&quot;443\&quot;}],\&quot;5671/tcp\&quot;:[{\&quot;HostPort\&quot;:\&quot;5671\&quot;}],\&quot;8883/tcp\&quot;:[{\&quot;HostPort\&quot;:\&quot;8883\&quot;}]}}}&quot;</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;docker&quot;</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;status&quot;</span><span class="token operator">:</span> <span class="token string">&quot;running&quot;</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;restartPolicy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;always&quot;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;$edgeHub&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;properties.desired&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;routes&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">&quot;route&quot;</span><span class="token operator">:</span> <span class="token string">&quot;FROM /messages/* INTO $upstream&quot;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token property">&quot;schemaVersion&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.1&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;storeAndForwardConfiguration&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">&quot;timeToLiveSecs&quot;</span><span class="token operator">:</span> <span class="token number">7200</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br></div></div><p>Use the information from the previous sections to update the relevant JSON values:</p> <ul><li>The environment variable <code>ACR_REGISTRY_CONNECTION_STRING</code> needs to be updated with the output from the <code>az acr connected-registry install renew-credentials</code> command above. You will need to manually replace the <code>ParentGatewayEndpoint</code> with the $IOTEDGE_PARENTHOSTNAME. You will also need to select the proper protocol in <code>ParentEndpointProtocol</code>.</li> <li>For each module in the manifest, you should update the registry endpoint to the $upstream.</li></ul> <p>You will use the file path in the next section when you run the command to apply the configuration to your device.</p> <h2 id="setup-and-deploy-the-connected-registry-module-on-nested-iot-edge"><a href="#setup-and-deploy-the-connected-registry-module-on-nested-iot-edge" class="header-anchor">#</a> Setup and deploy the connected registry module on nested IoT Edge</h2> <p>This tutorial requires a nested Azure IoT Edge device to be set up upfront. You can use the <a href="https://docs.microsoft.com/en-us/azure/iot-edge/quickstart-linux?view=iotedge-2020-11" target="_blank" rel="noopener noreferrer">Deploy your first IoT Edge module to a virtual Linux device<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> quickstart guide to learn how to deploy a virtual IoT Edge device. To create a nested IoT Edge devices, follow the instructions <a href="https://docs.microsoft.com/en-us/azure/iot-edge/tutorial-nested-iot-edge?view=iotedge-2020-11" target="_blank" rel="noopener noreferrer">Tutorial: Create a hierarchy of IoT Edge devices<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to learn how to configure hierarchical IoT edge devices. The connected registry is deployed as a module on the nested IoT Edge device.</p> <p>Based on the tutorial, it overall includes the following steps:</p> <ol><li><p>Create top level and lower level vms from existing template. The template will also install the iot agent on it. You can use the <a href="https://docs.microsoft.com/en-us/azure/iot-edge/how-to-install-iot-edge?view=iotedge-2020-11" target="_blank" rel="noopener noreferrer">Tutorial: Install or uninstall Azure IoT Edge for Linux<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to learn how to manually set up the machine if you need deploy from your own devices.</p></li> <li><p>Use the iotedge-config tool to create and configure your hierarchy, follow the steps below in the Azure CLI:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>mkdir nestedIotEdgeTutorial
cd ~/nestedIotEdgeTutorial
wget -O iotedge_config.tar <span class="token string">&quot;https://github.com/Azure-Samples/iotedge_config_cli/releases/download/latest/iotedge_config_cli.tar.gz&quot;</span>
tar -xvf iotedge_config.tar
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>This will create the iotedge_config_cli_release folder in your tutorial directory. The template file used to create your device hierarchy is the iotedge_config.yaml file found in ~/nestedIotEdgeTutorial/iotedge_config_cli_release/templates/tutorial. In the same directory, there're two deployment manifests for top and lower level deploymentTopLayer.json and deploymentLowerLayer.json files. Refer the #4 below on how to prepare them.</p></li> <li><p>Edit iotedge_config.yaml with your information. This include the iothub_hostname, iot_name, deployment template file for both top layer and child as well as the credentials used to pull the image from upstream. Please refer <a href="/acr/preview/connected-registry/quickstart-deploy-connected-registry-iot-edge-cli.html">Quickstart: Deploy a connected registry to an IoT Edge device</a> if you are not familar how to create a client token. And you also make sure the client token get the permissions to pull all the required images. Below is a sample config.</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>config_version<span class="token operator">:</span> <span class="token string">&quot;1.0&quot;</span>

iothub<span class="token operator">:</span>
iothub_hostname<span class="token operator">:</span> myiothub.azure-devices.net
iothub_name<span class="token operator">:</span> myiothub
## Authentication method used by IoT Edge devices<span class="token operator">:</span> symmetric_key or x509_certificate
authentication_method<span class="token operator">:</span> symmetric_key 

## Root certificate used to generate device CA certificates. Optional. If not provided a self-signed CA will be generated
# certificates<span class="token operator">:</span>
#   root_ca_cert_path<span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
#   root_ca_cert_key_path<span class="token operator">:</span> <span class="token string">&quot;&quot;</span>

## IoT Edge configuration template to use
configuration<span class="token operator">:</span>
template_config_path<span class="token operator">:</span> <span class="token string">&quot;./templates/tutorial/device_config.toml&quot;</span>
default_edge_agent<span class="token operator">:</span> <span class="token string">&quot;$upstream:8000/azureiotedge-agent:20210609.5&quot;</span>

## Hierarchy of IoT Edge devices to create
edgedevices<span class="token operator">:</span>
device_id<span class="token operator">:</span> top-layerx
edge_agent<span class="token operator">:</span> <span class="token string">&quot;mycontainerregistry001.azurecr.io/azureiotedge-agent:20210609.5&quot;</span> ## Optional. If not provided<span class="token punctuation">,</span> default_edge_agent will be used
deployment<span class="token operator">:</span> <span class="token string">&quot;./templates/tutorial/deploymentTopLayer.json&quot;</span> ## Optional. If provided<span class="token punctuation">,</span> the given deployment file will be applied to the newly created device
# hostname<span class="token operator">:</span> <span class="token string">&quot;FQDN or IP&quot;</span> ## Optional. If provided<span class="token punctuation">,</span> install.sh will not prompt user for this value nor the parent_hostname value
container_auth<span class="token operator">:</span> <span class="token comment">// The token used to pull the image from cloud registry</span>
    serveraddress<span class="token operator">:</span> <span class="token string">&quot;mycontainerregistry001.azurecr.io&quot;</span>
    username<span class="token operator">:</span> <span class="token string">&quot;crimagepulltokentop&quot;</span>
    password<span class="token operator">:</span> <span class="token string">&quot;HwBU+ZhB+X9AOmeAq6ZG2G/y2QD=8sfT&quot;</span>
child<span class="token operator">:</span>
    - device_id<span class="token operator">:</span> lower-layerx
    deployment<span class="token operator">:</span> <span class="token string">&quot;./templates/tutorial/deploymentLowerLayer.json&quot;</span> ## Optional. If provided<span class="token punctuation">,</span> the given deployment file will be applied to the newly created device
    # hostname<span class="token operator">:</span> <span class="token string">&quot;FQDN or IP&quot;</span> ## Optional. If provided<span class="token punctuation">,</span> install.sh will not prompt user for this value nor the parent_hostname value
    container_auth<span class="token operator">:</span> <span class="token comment">//The token used to pull the image from parent connected registry</span>
        serveraddress<span class="token operator">:</span> <span class="token string">&quot;$upstream:8000&quot;</span>
        username<span class="token operator">:</span> <span class="token string">&quot;crimagepulltokenlower&quot;</span>
        password<span class="token operator">:</span> <span class="token string">&quot;$$$0meCoMPL3xP4$$W0rd001!@#$$&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div></li> <li><p>Prepare the top level and lower level deployment files (deploymentTopLayer.json and deploymentLowerLayer.json).</p> <p>The top level deployment file is the same as the one you used to set up a connected registry on a IoT Edge device. Refer <a href="/acr/preview/connected-registry/quickstart-deploy-connected-registry-iot-edge-cli.html">Quickstart: Deploy a connected registry to an IoT Edge device</a>. Make sure you do have API proxy module deployed on top layer and open the port <code>8000</code>, <code>5671</code>, <code>8883</code>.</p> <p>For the lower level deployment file, please refer the above section 'Configure a deployment manifest for the nested IoT Edge' about the difference to the top level deployment file. Overall, the lowever level deployment file is similar as the top level deployment file. The differences are:</p> <ul><li>It need pull all the images required from top level connected registry instead of from cloud registry or MCR.
When you set up the top level connected registry, you need make sure it will sync up all the IoT agent, hub and connected registry images locally (azureiotedge-agent, azureiotedge-hub, connected-registry). The lower level IoT device need pull these images from the top level connected registry.</li> <li>It need configure the parent gateway endpoint with the top level connected registry IP or FQDN instead of cloud registry.</li></ul></li> <li><p>Install in the top and lower level devices.
Navigate to your iotedge_config_cli_releae directory and run the tool to create your hierarchy of IoT Edge devices.</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>cd ~/nestedIotEdgeTutorial/iotedge_config_cli_release
./iotedge_config --config ~/nestedIotEdgeTutorial/iotedge_config_cli_release/templates/tutorial/iotedge_config.yaml --output ~/nestedIotEdgeTutorial/iotedge_config_cli_release/outputs -f
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>With the --output flag, the toos creates the device certificates, certificate bundles, and a log file in a directory of your choice. With the -f flag set, the tool will automatically look for existing IoT Edge devices in your IoT Hub and remove them, to avoid errors and keep your hub clean.</p> <p>Copy the generated top-layer.zip and lower-layer.zip in above steps to the corresponding top and lower vms using scp。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>scp &lt;PATH_TO_CONFIGURATION_BUNDLE&gt;   &lt;USER&gt;@&lt;VM_IP_OR_FQDN&gt;<span class="token operator">:</span>~
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Go to each device, unzip the configuration bundle. You'll need to install zip first.</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>sudo apt install zip
unzip ~/&lt;PATH_TO_CONFIGURATION_BUNDLE&gt;/&lt;CONFIGURATION_BUNDLE&gt;.zip (unzip top-layer.zip)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Unzip the installation files and run ./install.sh, input the ip and host name. All are done for top layer device deployment. Run iotedge list to double check if all modules are running well.</p> <p>Repeat the same steps in lower level device. Unzip files and run ./install.sh. Input the ip, host name and parent hostname.
All are done for lower layer deployment. Run iotedge list to double check if all modules are running well.</p> <p>If there're any problems e.g. invalid deployment manifest. You need manually redeploy the modules. Refer the next session on how to make a deployment manually on top or lower device.</p></li></ol> <h2 id="manully-deploy-the-connected-registry-module-on-iot-edge"><a href="#manully-deploy-the-connected-registry-module-on-iot-edge" class="header-anchor">#</a> Manully Deploy the connected registry module on IoT Edge</h2> <p>The following step might be covered during nested iot setup after you run install.sh on top and lower level devices. However, it is also possible the previous deployment doesn't success and you can use the following way to redeploy it.</p> <p>Use the following command to deploy the connected registry module on the IoT Edge device:</p> <div class="language-azurecli line-numbers-mode"><pre class="language-text"><code>az iot edge set-modules \
  --device-id [device id] \
  --hub-name [hub name] \
  --content [file path]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>For more details you can refer to the <a href="https://docs.microsoft.com/en-us/azure/iot-edge/how-to-deploy-modules-cli?view=iotedge-2020-11" target="_blank" rel="noopener noreferrer">Deploy Azure IoT Edge modules with Azure CLI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> article.</p> <p>To check the status of the connected registry, use the following CLI command:</p> <div class="language-azurecli line-numbers-mode"><pre class="language-text"><code>az acr connected-registry show \
  --registry mycontainerregistry001 \
  --name myconnectedmirror \
  --output table
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>You may need to a wait few minutes until the deployment of the connected registry completes.</p> <p>Successful response from the command will include the following:</p> <div class="language-azurecli line-numbers-mode"><pre class="language-text"><code>connectionState: Online
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="next-steps"><a href="#next-steps" class="header-anchor">#</a> Next steps</h2> <p>In this quickstart, you learned how to deploy a connected registry to an IoT Edge device. Continue to the next guide to learn how to pull images from the newly deployed connected registry.</p> <blockquote><p><a href="/acr/preview/connected-registry/quickstart-pull-images-from-connected-registry.html">Quickstart: Pull images from a connected registry</a></p></blockquote></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/azure/acr/edit/master/docs/preview/connected-registry/quickstart-deploy-connected-registry-nested-iot-edge-cli.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/acr/assets/js/app.3ca3959d.js" defer></script><script src="/acr/assets/js/2.4abe739f.js" defer></script><script src="/acr/assets/js/37.9c3a93a2.js" defer></script>
  </body>
</html>
