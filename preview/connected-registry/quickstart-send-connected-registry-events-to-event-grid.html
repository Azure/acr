<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Quickstart - Send connected registry  events to Azure Event Grid | Azure Container Registry</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Send connected registry events to Azure Event Grid.">
    
    <link rel="preload" href="/acr/assets/css/0.styles.1adce09e.css" as="style"><link rel="preload" href="/acr/assets/js/app.3ca3959d.js" as="script"><link rel="preload" href="/acr/assets/js/2.4abe739f.js" as="script"><link rel="preload" href="/acr/assets/js/39.f4bfa261.js" as="script"><link rel="prefetch" href="/acr/assets/js/10.080d8072.js"><link rel="prefetch" href="/acr/assets/js/11.a8cae62e.js"><link rel="prefetch" href="/acr/assets/js/12.e62ede07.js"><link rel="prefetch" href="/acr/assets/js/13.88956df0.js"><link rel="prefetch" href="/acr/assets/js/14.da996b77.js"><link rel="prefetch" href="/acr/assets/js/15.128615bf.js"><link rel="prefetch" href="/acr/assets/js/16.28bd344b.js"><link rel="prefetch" href="/acr/assets/js/17.3154ce14.js"><link rel="prefetch" href="/acr/assets/js/18.1a01df13.js"><link rel="prefetch" href="/acr/assets/js/19.d6cd2dad.js"><link rel="prefetch" href="/acr/assets/js/20.3cb003a6.js"><link rel="prefetch" href="/acr/assets/js/21.b60fd558.js"><link rel="prefetch" href="/acr/assets/js/22.7d86dba4.js"><link rel="prefetch" href="/acr/assets/js/23.dd656471.js"><link rel="prefetch" href="/acr/assets/js/24.e228cfdd.js"><link rel="prefetch" href="/acr/assets/js/25.197c3531.js"><link rel="prefetch" href="/acr/assets/js/26.29caa7ed.js"><link rel="prefetch" href="/acr/assets/js/27.fb8da073.js"><link rel="prefetch" href="/acr/assets/js/28.6e4543d4.js"><link rel="prefetch" href="/acr/assets/js/29.a76509db.js"><link rel="prefetch" href="/acr/assets/js/3.f910cf4c.js"><link rel="prefetch" href="/acr/assets/js/30.994ccbbb.js"><link rel="prefetch" href="/acr/assets/js/31.f2c11b52.js"><link rel="prefetch" href="/acr/assets/js/32.840e79d8.js"><link rel="prefetch" href="/acr/assets/js/33.2df67567.js"><link rel="prefetch" href="/acr/assets/js/34.e38730f2.js"><link rel="prefetch" href="/acr/assets/js/35.46229160.js"><link rel="prefetch" href="/acr/assets/js/36.9f898214.js"><link rel="prefetch" href="/acr/assets/js/37.9c3a93a2.js"><link rel="prefetch" href="/acr/assets/js/38.2cbce8d9.js"><link rel="prefetch" href="/acr/assets/js/4.1d1d93b6.js"><link rel="prefetch" href="/acr/assets/js/40.bc1f46d1.js"><link rel="prefetch" href="/acr/assets/js/41.2dbb6a30.js"><link rel="prefetch" href="/acr/assets/js/42.84fa6a12.js"><link rel="prefetch" href="/acr/assets/js/43.428cb1ec.js"><link rel="prefetch" href="/acr/assets/js/44.3b6b967d.js"><link rel="prefetch" href="/acr/assets/js/45.fd0d1d9e.js"><link rel="prefetch" href="/acr/assets/js/46.19cb06fd.js"><link rel="prefetch" href="/acr/assets/js/47.8c0d7628.js"><link rel="prefetch" href="/acr/assets/js/48.619e29e6.js"><link rel="prefetch" href="/acr/assets/js/49.3ba8bd2c.js"><link rel="prefetch" href="/acr/assets/js/5.943fad70.js"><link rel="prefetch" href="/acr/assets/js/50.0c02f626.js"><link rel="prefetch" href="/acr/assets/js/51.b822281a.js"><link rel="prefetch" href="/acr/assets/js/52.9a8a029d.js"><link rel="prefetch" href="/acr/assets/js/53.57ca9884.js"><link rel="prefetch" href="/acr/assets/js/54.86e09cf3.js"><link rel="prefetch" href="/acr/assets/js/55.21039511.js"><link rel="prefetch" href="/acr/assets/js/56.b6f67eae.js"><link rel="prefetch" href="/acr/assets/js/57.0266cf09.js"><link rel="prefetch" href="/acr/assets/js/58.249e8925.js"><link rel="prefetch" href="/acr/assets/js/59.a2f8607d.js"><link rel="prefetch" href="/acr/assets/js/6.c89b0c48.js"><link rel="prefetch" href="/acr/assets/js/60.f13d2f1c.js"><link rel="prefetch" href="/acr/assets/js/7.cf63200c.js"><link rel="prefetch" href="/acr/assets/js/8.9e525704.js"><link rel="prefetch" href="/acr/assets/js/9.b9ebe781.js">
    <link rel="stylesheet" href="/acr/assets/css/0.styles.1adce09e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/acr/" class="home-link router-link-active"><img src="/acr/files/acr.svg" alt="Azure Container Registry" class="logo"> <span class="site-name can-hide">Azure Container Registry</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/azure/acr" target="_blank" rel="noopener noreferrer" class="repo-link">
    Star this Repo
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/azure/acr" target="_blank" rel="noopener noreferrer" class="repo-link">
    Star this Repo
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/acr/" aria-current="page" class="sidebar-link">Overview</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acr/#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/acr/#blog-posts" class="sidebar-link">Blog posts</a></li><li class="sidebar-sub-header"><a href="/acr/#links" class="sidebar-link">Links</a></li></ul></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Teleport</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Tasks</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Authentication</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Integration</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="quickstart-send-connected-registry-artifact-events-to-event-grid"><a href="#quickstart-send-connected-registry-artifact-events-to-event-grid" class="header-anchor">#</a> Quickstart: Send connected registry artifact events to Event Grid</h1> <p>In this quickstart, you will learn how to configure Connected registry <a href="https://docs.microsoft.com/azure/container-registry/" target="_blank" rel="noopener noreferrer">Azure Container Registry<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to send artifact push and delete events to <a href="(https://docs.microsoft.com/en-us/azure/event-grid/overview)">Azure Event Grid</a> for processing and notification. You can review the <a href="/acr/preview/connected-registry/intro-connected-registry.html">ACR connected registry introduction</a> for details about the connected registry feature of Azure Container Registry.</p> <h2 id="scenario-overview"><a href="#scenario-overview" class="header-anchor">#</a> Scenario overview</h2> <p>As described in the <a href="https://docs.microsoft.com/azure/container-registry/" target="_blank" rel="noopener noreferrer">introduction<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, the connected registry synchronizes artifacts from the parent and also allows local push and delete of the artifacts. We can configure the connected registry to notify via <a href="(https://docs.microsoft.com/en-us/azure/event-grid/overview)">Azure Event Grid</a> whenever there is an update to the artifact. This will allow us to perform other actions based on the availability of the artifact on the connected registry.</p> <h2 id="prerequisites"><a href="#prerequisites" class="header-anchor">#</a> Prerequisites</h2> <ul><li><p>Use <a href="https://docs.microsoft.com/en-us/azure/cloud-shell/quickstart" target="_blank" rel="noopener noreferrer">Azure Cloud Shell<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> using the bash environment.</p> <p><a href="https://shell.azure.com/" target="_blank" rel="noopener noreferrer"><img src="https://docs.microsoft.com/en-us/azure/includes/media/cloud-shell-try-it/hdi-launch-cloud-shell.png" alt="https://docs.microsoft.com/en-us/azure/includes/media/cloud-shell-try-it/hdi-launch-cloud-shell.png"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>If you prefer, <a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli" target="_blank" rel="noopener noreferrer">install<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> the Azure CLI to run CLI reference commands.</p> <ul><li>If you're using a local install, sign in with Azure CLI by using the <a href="https://docs.microsoft.com/en-us/cli/azure/reference-index#az_login" target="_blank" rel="noopener noreferrer">az login<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> command. To finish the authentication process, follow the steps displayed in your terminal. See <a href="https://docs.microsoft.com/en-us/cli/azure/authenticate-azure-cli" target="_blank" rel="noopener noreferrer">Sign in with Azure CLI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for additional sign-in options.</li> <li>When you're prompted, install Azure CLI extensions on first use. For more information about extensions, see <a href="https://docs.microsoft.com/en-us/cli/azure/azure-cli-extensions-overview" target="_blank" rel="noopener noreferrer">Use extensions with Azure CLI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</li> <li>Run <a href="https://docs.microsoft.com/en-us/cli/azure/reference-index?#az_version" target="_blank" rel="noopener noreferrer">az version<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to find the version and dependent libraries that are installed. To upgrade to the latest version, run <a href="https://docs.microsoft.com/en-us/cli/azure/reference-index?#az_upgrade" target="_blank" rel="noopener noreferrer">az upgrade<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</li></ul></li> <li><p>The Azure CLI commands in this article are formatted for the Bash shell. If you're using a different shell like PowerShell or Command Prompt, you may need to adjust line continuation characters or variable assignment lines accordingly. This article uses variables to minimize the amount of command editing required.</p></li></ul> <h2 id="before-you-begin"><a href="#before-you-begin" class="header-anchor">#</a> Before you begin</h2> <p>Make sure that you have created the connected registry resource in Azure as described in the <a href="/acr/preview/connected-registry/quickstart-connected-registry-cli.html">Create connected registry using the CLI</a> quickstart guide and have a connected registry deployed on your premises as described in <a href="/acr/preview/connected-registry/quickstart-deploy-connected-registry-iot-edge-cli.html">Quickstart: Deploy a connected registry to an IoT Edge device</a> or <a href="/acr/preview/connected-registry/quickstart-deploy-connected-registry-kubernetes.html">Quickstart: Deploy a connected registry to Kubernetes cluster</a>. The connected registry image that is deployed should be of version atleast 0.6.0</p> <p>Also, make sure you understand <a href="https://docs.microsoft.com/en-us/azure/event-grid/" target="_blank" rel="noopener noreferrer">Azure Event Grid<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and have registered to use it. You should also have an event end point ready where you would like to send your events. You can check the quickstart to configure Azure Event Grid for Azure Container Registry events as shown in <a href="https://docs.microsoft.com/en-us/azure/container-registry/container-registry-event-grid-quickstart?toc=/azure/event-grid/toc.json" target="_blank" rel="noopener noreferrer">QuickStart: Container registry events on Event Grid<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>Before proceeding, set the event end point and other Azure Container Registry information.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>APP_ENDPOINT=&lt;your-app-endpoint&gt;
ACR_NAME=mycontainerregistry001
ACR_CONNECTED_REGISTRY_NAME=myconnectedregistry
ACR_REGISTRY_ID=$(az acr show --name $ACR_NAME --query id --output tsv)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>In this tutorial, we configure the connected registry to send artifact events like push and delete to Azure Event Grid in a two step process.</p> <ol><li>Configure connected registry to generate events on patterns of interest.</li> <li>Configure Azure Event Grid to subscribe and filter for events generated by connected registry.</li></ol> <h2 id="notification-events-generation-on-a-connected-registry"><a href="#notification-events-generation-on-a-connected-registry" class="header-anchor">#</a> Notification Events Generation on a connected registry</h2> <p>Use the following CLI command to configure the connected registry to generate notifications for push and delete events on all artifacts</p> <div class="language-azurecli line-numbers-mode"><pre class="language-text"><code>az acr connected-registry update -r $ACR_NAME
  --name $ACR_CONNECTED_REGISTRY_NAME \
  --add-notifications *:*
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>If you are interested in generating events only for specific artifact patterns or specific actions, you can specify the patterns in the form shown below</p> <div class="language-azurecli line-numbers-mode"><pre class="language-text"><code>az acr connected-registry update -r $ACR_NAME \
  --name $ACR_CONNECTED_REGISTRY_NAME \
  --add-notifications hello-world:* hello-world:1.0:delete \
  hello-world@sha256:92c7f9c92844bbbb5d0a101b22f7c2a7949e40f8ea90c8b3bc396879d95e899a:push 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>The pattern is of the format</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>artifact &quot;:&quot; action
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>where <code>artifact</code> and <code>action</code> are further defined as</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">artifact</span><span class="token punctuation">:</span> name <span class="token punctuation">[</span> &quot;<span class="token punctuation">:</span>&quot; tag <span class="token punctuation">]</span> <span class="token punctuation">[</span> &quot;@&quot; digest <span class="token punctuation">]</span>
<span class="token key atrule">action</span><span class="token punctuation">:</span> &quot;push&quot; or &quot;delete&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>The wildcard <code>*</code> should be used to cover all values on a section.</p> <p>For example,</p> <ol><li>*ðŸ˜— - Notify all actions on all tags and digests on all artifacts on the connected registry</li> <li>*ðŸ˜—ðŸ˜—- Notify all actions on all tags on all artifacts on the connected registry</li> <li>*@*ðŸ˜—- Notify all actions on all digests on all artifacts on the connected registry</li> <li>path/to/repo:* - Notify all actions on all artifacts on repository '/path/to/repo' on the connected registry</li> <li>path/to/repo:myTag:* - Notify all actions on tag 'myTag' on repository '/path/to/repo' on the connected registry</li> <li>path/to/repo@myDigest:delete - Notify only 'delete' action on digest 'myDigest' on repository '/path/to/repo' on the connected registry</li> <li>path/to/repo/*:push - Notify only 'push' action on all artifacts on all repositories that match '/path/to/repo/*' on the connected registry</li></ol> <h2 id="event-grid-subscription-and-filtering-connected-registry-events-on-event-grid"><a href="#event-grid-subscription-and-filtering-connected-registry-events-on-event-grid" class="header-anchor">#</a> Event Grid Subscription and filtering Connected Registry Events on Event Grid</h2> <p>In this step, you will configure eventgrid to subscribe for events from connected registry. You can use the <code>--advanced-filter</code> on event grid to filter out connected registry specific events. The connected registry events will align to the existing Azure Container Registry event types <code>Microsoft.ContainerRegistry.ImagePushed</code> and <code>Microsoft.ContainerRegistry.ImageDeleted</code>.</p> <ol><li>To filter events from all connected registries</li></ol> <div class="language-azurecli line-numbers-mode"><pre class="language-text"><code>az eventgrid event-subscription create \
  --name event-sub-acr \
  --source-resource-id $ACR_REGISTRY_ID \
  --endpoint $APP_ENDPOINT \
  --advanced-filter data.connectedregistry IsNotNull 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="2"><li>To filter connected registry events based on connected registry name</li></ol> <div class="language-azurecli line-numbers-mode"><pre class="language-text"><code>az eventgrid event-subscription create \
  --name event-sub-acr \
  --source-resource-id $ACR_REGISTRY_ID \
  --endpoint $APP_ENDPOINT \
  --advanced-filter data.connectedregistry IsNotNull \
  --advanced-filter data.connectedregistry.name StringIn $ACR_CONNECTED_REGISTRY_NAME
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Whenever there is a push or delete on any artifact on the connected registry, you will see the events as shown below. The events might take multiples of sync interval time to appear on endpoint based on the depth of the connected registry heirarchy.</p> <ul><li><code>Microsoft.ContainerRegistry.ImagePushed</code> event</li></ul> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span><span class="token punctuation">{</span>
  <span class="token key atrule">&quot;id&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;831e1650-001e-001b-66ab-eeb76e069631&quot;</span><span class="token punctuation">,</span>
  <span class="token key atrule">&quot;topic&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;/subscriptions/&lt;subscription-id&gt;/resourceGroups/&lt;resource-group-name&gt;/providers/Microsoft.ContainerRegistry/registries/&lt;registry-name&gt;/connectedRegistries/&lt;connected-registry-name&gt;&quot;</span><span class="token punctuation">,</span>
  <span class="token key atrule">&quot;subject&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;aci-helloworld:v1&quot;</span><span class="token punctuation">,</span>
  <span class="token key atrule">&quot;eventType&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Microsoft.ContainerRegistry.ImagePushed&quot;</span><span class="token punctuation">,</span>
  <span class="token key atrule">&quot;eventTime&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;2018-04-25T21:39:47.6549614Z&quot;</span><span class="token punctuation">,</span>
  <span class="token key atrule">&quot;data&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token key atrule">&quot;id&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;31c51664-e5bd-416a-a5df-e5206bc47ed0&quot;</span><span class="token punctuation">,</span>
    <span class="token key atrule">&quot;timestamp&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;2018-04-25T21:39:47.276585742Z&quot;</span><span class="token punctuation">,</span>
    <span class="token key atrule">&quot;action&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;push&quot;</span><span class="token punctuation">,</span>
    <span class="token key atrule">&quot;target&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token key atrule">&quot;mediaType&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;application/vnd.docker.distribution.manifest.v2+json&quot;</span><span class="token punctuation">,</span>
      <span class="token key atrule">&quot;size&quot;</span><span class="token punctuation">:</span> <span class="token number">3023</span><span class="token punctuation">,</span>
      <span class="token key atrule">&quot;digest&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;sha256:213bbc182920ab41e18edc2001e06abcca6735d87782d9cef68abd83941cf0e5&quot;</span><span class="token punctuation">,</span>
      <span class="token key atrule">&quot;repository&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;aci-helloworld&quot;</span><span class="token punctuation">,</span>
      <span class="token key atrule">&quot;tag&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;v1&quot;</span><span class="token punctuation">,</span>
      <span class="token key atrule">&quot;length&quot;</span><span class="token punctuation">:</span> <span class="token number">3023</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token key atrule">&quot;connectedregistry&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token key atrule">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&lt;connected-registry-name&gt;&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token key atrule">&quot;dataVersion&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
  <span class="token key atrule">&quot;metadataVersion&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;1&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><ul><li><p><code>Microsoft.ContainerRegistry.ImageDeleted</code> event</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span><span class="token punctuation">{</span>
 <span class="token key atrule">&quot;id&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;831e1650-001e-001b-66ab-eeb76e069631&quot;</span><span class="token punctuation">,</span>
 <span class="token key atrule">&quot;topic&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;/subscriptions/&lt;subscription-id&gt;/resourceGroups/&lt;resource-group- name&gt;/providers/Microsoft.ContainerRegistry/registries/&lt;registry-name&gt;/connectedRegistries/&lt;connected-registry-name&gt;&quot;</span><span class="token punctuation">,</span>
 <span class="token key atrule">&quot;subject&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;aci-helloworld&quot;</span><span class="token punctuation">,</span>
 <span class="token key atrule">&quot;eventType&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Microsoft.ContainerRegistry.ImageDeleted&quot;</span><span class="token punctuation">,</span>
 <span class="token key atrule">&quot;eventTime&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;2018-04-25T21:39:47.6549614Z&quot;</span><span class="token punctuation">,</span>
 <span class="token key atrule">&quot;data&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
   <span class="token key atrule">&quot;id&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;31c51664-e5bd-416a-a5df-e5206bc47ed0&quot;</span><span class="token punctuation">,</span>
   <span class="token key atrule">&quot;timestamp&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;2018-04-25T21:39:47.276585742Z&quot;</span><span class="token punctuation">,</span>
   <span class="token key atrule">&quot;action&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;delete&quot;</span><span class="token punctuation">,</span>
   <span class="token key atrule">&quot;target&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
     <span class="token key atrule">&quot;mediaType&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;application/vnd.docker.distribution.manifest.v2+json&quot;</span><span class="token punctuation">,</span>
     <span class="token key atrule">&quot;digest&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;sha256:213bbc182920ab41e18edc2001e06abcca6735d87782d9cef68abd83941cf0e5&quot;</span><span class="token punctuation">,</span>
     <span class="token key atrule">&quot;repository&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;aci-helloworld&quot;</span><span class="token punctuation">,</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token key atrule">&quot;connectedregistry&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
     <span class="token key atrule">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&lt;connected-registry-name&gt;&quot;</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>  
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token key atrule">&quot;dataVersion&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
 <span class="token key atrule">&quot;metadataVersion&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;1&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div></li></ul> <p>Please note that, if you already have event subscriptions on event grid for the concerned Azure Container Registry and you later configure generation of events on connected registry using CLI, you will immediately start to see the new connected registry events on those existing event grid subscriptions.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/azure/acr/edit/master/docs/preview/connected-registry/quickstart-send-connected-registry-events-to-event-grid.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/acr/assets/js/app.3ca3959d.js" defer></script><script src="/acr/assets/js/2.4abe739f.js" defer></script><script src="/acr/assets/js/39.f4bfa261.js" defer></script>
  </body>
</html>
