<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Quickstart - Deploy a connected registry to Kubernetes cluster | Azure Container Registry</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Use Azure Container Registry CLI and Helm 3 commands to deploy a connected registry to a Kubernetes cluster.">
    
    <link rel="preload" href="/acr/assets/css/0.styles.1adce09e.css" as="style"><link rel="preload" href="/acr/assets/js/app.3ca3959d.js" as="script"><link rel="preload" href="/acr/assets/js/2.4abe739f.js" as="script"><link rel="preload" href="/acr/assets/js/36.9f898214.js" as="script"><link rel="prefetch" href="/acr/assets/js/10.080d8072.js"><link rel="prefetch" href="/acr/assets/js/11.a8cae62e.js"><link rel="prefetch" href="/acr/assets/js/12.e62ede07.js"><link rel="prefetch" href="/acr/assets/js/13.88956df0.js"><link rel="prefetch" href="/acr/assets/js/14.da996b77.js"><link rel="prefetch" href="/acr/assets/js/15.128615bf.js"><link rel="prefetch" href="/acr/assets/js/16.28bd344b.js"><link rel="prefetch" href="/acr/assets/js/17.3154ce14.js"><link rel="prefetch" href="/acr/assets/js/18.1a01df13.js"><link rel="prefetch" href="/acr/assets/js/19.d6cd2dad.js"><link rel="prefetch" href="/acr/assets/js/20.3cb003a6.js"><link rel="prefetch" href="/acr/assets/js/21.b60fd558.js"><link rel="prefetch" href="/acr/assets/js/22.7d86dba4.js"><link rel="prefetch" href="/acr/assets/js/23.dd656471.js"><link rel="prefetch" href="/acr/assets/js/24.e228cfdd.js"><link rel="prefetch" href="/acr/assets/js/25.197c3531.js"><link rel="prefetch" href="/acr/assets/js/26.29caa7ed.js"><link rel="prefetch" href="/acr/assets/js/27.fb8da073.js"><link rel="prefetch" href="/acr/assets/js/28.6e4543d4.js"><link rel="prefetch" href="/acr/assets/js/29.a76509db.js"><link rel="prefetch" href="/acr/assets/js/3.f910cf4c.js"><link rel="prefetch" href="/acr/assets/js/30.994ccbbb.js"><link rel="prefetch" href="/acr/assets/js/31.f2c11b52.js"><link rel="prefetch" href="/acr/assets/js/32.840e79d8.js"><link rel="prefetch" href="/acr/assets/js/33.2df67567.js"><link rel="prefetch" href="/acr/assets/js/34.e38730f2.js"><link rel="prefetch" href="/acr/assets/js/35.46229160.js"><link rel="prefetch" href="/acr/assets/js/37.9c3a93a2.js"><link rel="prefetch" href="/acr/assets/js/38.2cbce8d9.js"><link rel="prefetch" href="/acr/assets/js/39.f4bfa261.js"><link rel="prefetch" href="/acr/assets/js/4.1d1d93b6.js"><link rel="prefetch" href="/acr/assets/js/40.bc1f46d1.js"><link rel="prefetch" href="/acr/assets/js/41.2dbb6a30.js"><link rel="prefetch" href="/acr/assets/js/42.84fa6a12.js"><link rel="prefetch" href="/acr/assets/js/43.428cb1ec.js"><link rel="prefetch" href="/acr/assets/js/44.3b6b967d.js"><link rel="prefetch" href="/acr/assets/js/45.fd0d1d9e.js"><link rel="prefetch" href="/acr/assets/js/46.19cb06fd.js"><link rel="prefetch" href="/acr/assets/js/47.8c0d7628.js"><link rel="prefetch" href="/acr/assets/js/48.619e29e6.js"><link rel="prefetch" href="/acr/assets/js/49.3ba8bd2c.js"><link rel="prefetch" href="/acr/assets/js/5.943fad70.js"><link rel="prefetch" href="/acr/assets/js/50.0c02f626.js"><link rel="prefetch" href="/acr/assets/js/51.b822281a.js"><link rel="prefetch" href="/acr/assets/js/52.9a8a029d.js"><link rel="prefetch" href="/acr/assets/js/53.57ca9884.js"><link rel="prefetch" href="/acr/assets/js/54.86e09cf3.js"><link rel="prefetch" href="/acr/assets/js/55.21039511.js"><link rel="prefetch" href="/acr/assets/js/56.b6f67eae.js"><link rel="prefetch" href="/acr/assets/js/57.0266cf09.js"><link rel="prefetch" href="/acr/assets/js/58.249e8925.js"><link rel="prefetch" href="/acr/assets/js/59.a2f8607d.js"><link rel="prefetch" href="/acr/assets/js/6.c89b0c48.js"><link rel="prefetch" href="/acr/assets/js/60.f13d2f1c.js"><link rel="prefetch" href="/acr/assets/js/7.cf63200c.js"><link rel="prefetch" href="/acr/assets/js/8.9e525704.js"><link rel="prefetch" href="/acr/assets/js/9.b9ebe781.js">
    <link rel="stylesheet" href="/acr/assets/css/0.styles.1adce09e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/acr/" class="home-link router-link-active"><img src="/acr/files/acr.svg" alt="Azure Container Registry" class="logo"> <span class="site-name can-hide">Azure Container Registry</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/azure/acr" target="_blank" rel="noopener noreferrer" class="repo-link">
    Star this Repo
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/azure/acr" target="_blank" rel="noopener noreferrer" class="repo-link">
    Star this Repo
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/acr/" aria-current="page" class="sidebar-link">Overview</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acr/#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/acr/#blog-posts" class="sidebar-link">Blog posts</a></li><li class="sidebar-sub-header"><a href="/acr/#links" class="sidebar-link">Links</a></li></ul></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Teleport</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Tasks</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Authentication</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Integration</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="quickstart-deploy-a-connected-registry-to-kubernetes-cluster"><a href="#quickstart-deploy-a-connected-registry-to-kubernetes-cluster" class="header-anchor">#</a> Quickstart:  Deploy a connected registry to Kubernetes cluster</h1> <p>In this quickstart, you use <a href="https://docs.microsoft.com/en-us/azure/container-registry/container-registry-intro" target="_blank" rel="noopener noreferrer">Azure Container Registry<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and <a href="https://helm.sh/docs/intro/quickstart/" target="_blank" rel="noopener noreferrer">Helm 3<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> commands to deploy a connected registry Helm chart to a Kubernetes cluster. You can review the <a href="https://docs.microsoft.com/en-us/azure/container-registry/intro-connected-registry" target="_blank" rel="noopener noreferrer">ACR connected registry introduction<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for details about the connected registry feature of Azure Container Registry. For more details on Helm charts, see <a href="https://helm.sh/docs/topics/charts/" target="_blank" rel="noopener noreferrer">Helm documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="supported-kubernetes-distributions"><a href="#supported-kubernetes-distributions" class="header-anchor">#</a> Supported Kubernetes distributions</h2> <h2 id="prerequisites"><a href="#prerequisites" class="header-anchor">#</a> Prerequisites</h2> <ul><li><a href="https://docs.microsoft.com/cli/azure/install-azure-cli" target="_blank" rel="noopener noreferrer">Install or upgrade Azure CLI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to version &gt;= 2.30.0
<ul><li>If you're using a local install, sign in with Azure CLI by using the <a href="https://docs.microsoft.com/en-us/cli/azure/reference-index#az_login" target="_blank" rel="noopener noreferrer">az login<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> command. To finish the authentication process, follow the steps displayed in your terminal. See <a href="https://docs.microsoft.com/en-us/cli/azure/authenticate-azure-cli" target="_blank" rel="noopener noreferrer">Sign in with Azure CLI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for additional sign-in options.</li></ul></li> <li>The Azure CLI commands in this article are formatted for the Bash shell. If you're using a different shell like PowerShell or Command Prompt, you may need to adjust line continuation characters or variable assignment lines accordingly. This article uses variables to minimize the amount of command editing required.</li> <li>A connected registry resource in Azure as described in the <a href="https://docs.microsoft.com/en-us/azure/container-registry/quickstart-connected-registry-cli" target="_blank" rel="noopener noreferrer">Create connected registry using the CLI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> quickstart guide. Both, <code>ReadWrite</code> and <code>ReadOnly</code> modes will work for this scenario.</li> <li>An up-and-running Kubernetes cluster. If you don't have one, you can create a cluster using one of these options:
<ul><li><a href="https://kind.sigs.k8s.io/" target="_blank" rel="noopener noreferrer">Kubernetes in Docker<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://rancher.com/docs/k3s/latest/quick-start/" target="_blank" rel="noopener noreferrer">K3s: Lightweight Kubernetes<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> cluster.</li> <li>Self-managed Kubernetes cluster using <a href="https://cluster-api.sigs.k8s.io/user/quick-start.html" target="_blank" rel="noopener noreferrer">Cluster API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>An <a href="https://docs.microsoft.com/azure/aks/kubernetes-walkthrough" target="_blank" rel="noopener noreferrer">Azure Kubernetes Service<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> cluster</li></ul></li> <li><a href="https://helm.sh/docs/intro/install/" target="_blank" rel="noopener noreferrer">Helm 3<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> installed.</li> <li><a href="https://kubernetes.io/docs/tasks/tools/#kubectl" target="_blank" rel="noopener noreferrer">Kubectl<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> installed.</li> <li>A <code>kubeconfig</code> file and context pointing to your cluster.</li></ul> <h2 id="node-setup-requirements"><a href="#node-setup-requirements" class="header-anchor">#</a> Node Setup Requirements</h2> <p>The helm chart installs Kubernetes resources used to run a connected registry on your Kubernetes cluster. The connected registry runs as a singleton pod on one node of the cluster. The user is responsible for configuring each node of the cluster that will pull from this connected registry. To pull from the connected registry over HTTPS, the user is responsible for configuring SSL certs on each node. To pull from the connected registry of HTTP, the user must update their container runtime settings to recognize the connected registry as &quot;insecure&quot;. See more information below.</p> <blockquote><p>[!WARNING]
Pulling from and pushing to the connected registry over HTTP is not secure. It is recommended to setup TLS certificates.</p></blockquote> <h2 id="fetch-the-connected-registry-helm-chart"><a href="#fetch-the-connected-registry-helm-chart" class="header-anchor">#</a> Fetch the Connected Registry Helm Chart</h2> <p>From a cluster node, run the following commands to install the connected registry helm chart.</p> <ol><li>Set environment variable to enable OCI artifact support in the Helm 3 client.</li></ol> <p><code>export HELM_EXPERIMENTAL_OCI=1</code></p> <ol start="2"><li>Pull the connected registry helm chart from MCR</li></ol> <p><code>helm chart pull mcr.microsoft.com/acr/connected-registry/chart:0.1.0</code></p> <ol start="3"><li>Export the helm chart</li></ol> <p><code>helm chart export mcr.microsoft.com/acr/connected-registry/chart:0.1.0</code></p> <ol start="4"><li>View the helm chart</li></ol> <p><code>helm show chart connected-registry</code></p> <ol start="5"><li>Get the connection string for your connected registry. This command generates <code>password1</code> of the corresponding sync token resource.</li></ol> <div class="language-cli line-numbers-mode"><pre class="language-text"><code>az acr connected-registry get-settings \
  --registry $REGISTRY_NAME \
  --name $CONNECTED_REGISTRY_RW \
  --generate-password 1 \
  --parent-protocol https
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Command output includes the registry connection string and related settings. The following example output shows the connection string for the connected registry named <em>myconnectedregistry</em> with parent registry <em>contosoregistry</em>.</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;ACR_REGISTRY_CONNECTION_STRING&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ConnectedRegistryName=myconnectedregistry;SyncTokenName=myconnectedregistry-sync-token;SyncTokenPassword=xxxxxxxxxxxxxxxx;ParentGatewayEndpoint=contosoregistry.eastus.data.azurecr.io;ParentEndpointProtocol=https&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="helm-chart-components"><a href="#helm-chart-components" class="header-anchor">#</a> Helm Chart Components</h2> <h3 id="storage-class"><a href="#storage-class" class="header-anchor">#</a> Storage Class</h3> <p>Decide what storage class resource is appropriate for your Kubernetes distribution. The user is required to provide an existing storage class resource name when deploying the connected registry. You can research your distribution to learn more on predefined storage classes or how to create your own. For instance, see predefined storage resources on AKS at <a href="https://docs.microsoft.com/en-us/azure/aks/concepts-storage#storage-classes" target="_blank" rel="noopener noreferrer">Concepts - Storage in Azure Kubernetes Services (AKS)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. To view storage class resources on your cluster, run</p> <p><code>kubectl get sc</code></p> <h2 id="https-communication-with-the-connected-registry"><a href="#https-communication-with-the-connected-registry" class="header-anchor">#</a> HTTPS communication with the connected registry</h2> <h3 id="pki-certificate-requirements"><a href="#pki-certificate-requirements" class="header-anchor">#</a> PKI Certificate Requirements</h3> <p>To establish a secure HTTPS communication with the connected registry, we use PKI certificates during deployment of the connected registry chart. Here are the general requirements for these PKI certs</p> <ol><li><p>The certificates and keys must be <a href="https://en.wikipedia.org/wiki/X.509" target="_blank" rel="noopener noreferrer">X.509<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> certificates and <a href="https://en.wikipedia.org/wiki/Privacy-Enhanced_Mail" target="_blank" rel="noopener noreferrer">Privacy-Enhanced Mail<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> encoded.</p></li> <li><p>To configure the connected registry (server) certificate during installation, you must provide</p></li></ol> <ul><li>A public certificate</li> <li>A private key</li></ul> <blockquote><p>[!IMPORTANT]
For early proof-of-concept stages, self-signed certificates might be an option but in general, proper PKI certificates signed by a Certificate Authority (CA) should be procured and used.</p></blockquote> <h3 id="create-the-pki-certificate"><a href="#create-the-pki-certificate" class="header-anchor">#</a> Create the PKI certificate</h3> <ol><li>Choose a service cluster IP that you will use to deploy the connected registry. The connected registry will be deployed behind a service that is accessible through this IP. Selecting the IP beforehand allows you to create the SSL cert with the IP as the subject alternate name (SAN).</li></ol> <p>Kubernetes uses a set IP range when deploying services. The IP address that you choose must be in the SERVICE_CLUSTER_IP_RANGE CIDR range that is configured for your cluster. You can view the available service cluster ip range in the kube-controller pod by running</p> <p><code>kubectl get pod kube-controller-manager-&lt;node&gt; -n kube-system -o jsonpath='{.spec.containers[0].command}'</code></p> <p>and viewing the --service-cluster-ip-range setting.</p> <p>If the selected service IP is invalid, you will see a <code>422 Unprocessable Entity</code> HTTP error response from Kubernetes at deployment time.</p> <ol start="2"><li>Create self-signed SSL cert with connected-registry service IP as the SAN
a. <code>mkdir /certs</code>
b. Run
<code>openssl req -newkey rsa:4096 -nodes -sha256 -keyout /certs/mycert.key -x509 -days 365 -out /certs/mycert.crt -addext &quot;subjectAltName = IP:&lt;service IP&gt;&quot;</code></li></ol> <blockquote><p>[!IMPORTANT]
For early proof-of-concept stages, self-signed certificates might be an option but in general, proper PKI certificates signed by a Certificate Authority (CA) should be procured and used.</p></blockquote> <ol start="3"><li>Get base64 encoded strings of the certificate and key files</li></ol> <p><code>export TLS_CRT=$(cat mycert.crt | base64 -w0)</code> <code>export TLS_KEY=$(sudo cat mycert.key | base64 -w0)</code></p> <h3 id="deploy-the-connected-registry"><a href="#deploy-the-connected-registry" class="header-anchor">#</a> Deploy the Connected Registry</h3> <ol><li>Deploy the connected registry, provide your connected registry connection string and existing Kubernetes storage class name. The below command deploys the release &quot;connected-registry&quot;. Provide the base64-encoded strings of the public certificate and private key in the  <code>tls.crt</code> and <code>tls.key</code> values, respectively.</li></ol> <p><code>helm upgrade --namespace connected-registry --create-namespace --install --set connectionString=&quot;&lt;insert connection string&gt;&quot; --set pvc.storageClassName=&quot;&lt;insert storage class name&gt;&quot; --set image=&quot;mcr.microsoft.com/acr/connected-registry:0.6.0&quot; --set tls.crt=$TLS_CRT --set tls.key=$TLS_KEY connected-registry ./connected-registry</code></p> <ol start="2"><li>To view the deployed connected registry resources, run</li></ol> <p><code>kubectl get services,deployments,pods,secrets -n connected-registry</code></p> <p>Note: you will see the connected registry service resource running under the cluster IP you selected.</p> <h3 id="configure-each-node"><a href="#configure-each-node" class="header-anchor">#</a> Configure Each Node</h3> <p>The following steps assume <code>containerd</code> is the container runtime of the Kubernetes cluster.</p> <ol><li><p>Create <code>/etc/containerd/certs.d/&lt;service IP&gt;:443</code> directory on each node or server that will access this connected registry. Service IP is that of the connected-registry service.</p></li> <li><p>Copy the CA cert corresponding to the SSL cert to this directory.</p></li></ol> <p>Note: If using a self-signed cert, copy <code>mycert.crt</code> to <code>ca.crt</code> and place <code>ca.crt</code> in this directory.</p> <div class="language- extra-class"><pre><code>You should have the following file structure on the node:
</code></pre></div><div class="language- line-numbers-mode"><pre class="language-text"><code>$ tree /etc/containerd/certs.d
/etc/containerd/certs.d
└── &lt;service IP&gt;:443
  └── ca.crt
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="3"><li>Update <code>/etc/containerd/config.toml</code> so that containerd can find the directory with the trusted CA cert. Containerd will look in this directory first during runtime operations to the connected registry.</li></ol> <p>Paste the following section into the file.</p> <div class="language-toml line-numbers-mode"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry</span><span class="token punctuation">]</span>
  <span class="token key property">config_path</span> <span class="token punctuation">=</span> <span class="token string">&quot;/etc/containerd/certs.d&quot;</span>     
  <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.configs.&quot;&lt;service IP&gt;:443&quot;.tls</span><span class="token punctuation">]</span>
    <span class="token key property">ca_file</span>   <span class="token punctuation">=</span> <span class="token string">&quot;/etc/containerd/certs.d/&lt;service IP&gt;:443/ca.crt&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="4"><li>Restart your container runtime. For containerd, use the following command</li></ol> <p><code>systemctl restart containerd</code></p> <h3 id="pull-from-the-connected-registry"><a href="#pull-from-the-connected-registry" class="header-anchor">#</a> Pull from the Connected Registry</h3> <p>For more information, reference <a href="https://docs.microsoft.com/en-us/azure/container-registry/pull-images-from-connected-registry" target="_blank" rel="noopener noreferrer">Pull images from a connected registry<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <ol><li>Get credentials corresponding to a client token linked to the connected registry. For more information, see <a href="https://docs.microsoft.com/en-us/azure/container-registry/overview-connected-registry-access#manage-client-tokens" target="_blank" rel="noopener noreferrer">Manage client tokens<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. The following example generates <code>password1</code> for token <em>pulluser</em> and registry <em>contosoregistry</em>.</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>TOKEN_PWD=$(az acr token credential generate \
  --name pulluser --registry contosoregistry --expiration-in-days 30 \
  --password1 --query 'passwords[0].value' --output tsv)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="2"><li>Create a secret with client token credentials. This client token must be linked to your connected registry. For more information, see <a href="https://docs.microsoft.com/en-us/azure/container-registry/overview-connected-registry-access#manage-client-tokens" target="_blank" rel="noopener noreferrer">Manage client tokens<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</li></ol> <p><code>kubectl create secret docker-registry regcred --docker-server=&lt;service IP&gt;:443 --docker-username=jeburkeclient --docker-password=&lt;insert TOKEN_PWD&gt; --docker-email=someemail</code></p> <ol start="3"><li>Create a deployment that pulls from the connected registry over HTTPS.</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>	cat &lt;&lt;EOF | kubectl apply -f -
	apiVersion: apps/v1
	kind: Deployment
	metadata:
	  name: hello-world-deployment
	  namespace: default
	  labels:
	    app.kubernetes.io/name: &quot;connected-registry&quot;
	spec:
	  replicas: 3
	  selector:
	    matchLabels:
	      app.kubernetes.io/name: &quot;connected-registry&quot;
	  template:
	    metadata:
	      labels:
	        app.kubernetes.io/name: &quot;connected-registry&quot;
	    spec:
	      containers:
	       - name: hello-world
	         image: &lt;service IP&gt;:443/hello-world:v1
	      imagePullSecrets:
	       - name: regcred
EOF
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h2 id="http-not-secure-communication-with-the-connected-registry"><a href="#http-not-secure-communication-with-the-connected-registry" class="header-anchor">#</a> HTTP (not secure) communication with the connected registry</h2> <blockquote><p>[!WARNING]
Pulling from and pushing to the connected registry over HTTP is not secure. It is recommended to setup SSL certificates. You should use this option only during early stages of development.</p></blockquote> <h3 id="deploy-the-connected-registry-2"><a href="#deploy-the-connected-registry-2" class="header-anchor">#</a> Deploy the Connected Registry</h3> <ol><li>Deploy the connected registry, provide your connected registry connection string and existing Kubernetes storage class name. The below command deploys the release &quot;connected-registry&quot;.</li></ol> <p><code>helm upgrade --namespace connected-registry --create-namespace --install --set connectionString=&quot;&lt;insert connection string&gt;&quot; --set httpEnabled=true --set pvc.storageClassName=&quot;&lt;insert storage class name&gt;&quot; --set image=&quot;mcr.microsoft.com/acr/connected-registry:0.6.0&quot; connected-registry ./connected-registry</code></p> <ol start="2"><li>View the deployed connected registry resources</li></ol> <p><code>kubectl get services,deployments,pods,secrets -n connected-registry</code></p> <h3 id="configure-each-node-2"><a href="#configure-each-node-2" class="header-anchor">#</a> Configure Each Node</h3> <ol><li>Get the cluster IP of the deployed connected registry service. This is the endpoint we will use to pull from the connected registry.</li></ol> <p><code>export SERVICE_IP=$(kubectl get svc {connected registry name} -n connected-registry -o jsonpath='{.spec.clusterIP}')</code></p> <ol start="2"><li>Add the connected registry endpoint &quot;$(SERVICE_IP):80&quot; as &quot;insecure&quot; per your container runtime settings on <strong>each node</strong> of your cluster that will access this connected registry. For containerd, go to /etc/containerd/config.toml and add the following settings</li></ol> <div class="language-toml line-numbers-mode"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry</span><span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors</span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors.&quot;&lt;service IP&gt;:80&quot;</span><span class="token punctuation">]</span>
      <span class="token key property">endpoint</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;http://&lt;service IP&gt;:80&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.configs</span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.configs.&quot;&lt;service IP&gt;:80&quot;.tls</span><span class="token punctuation">]</span>
      <span class="token key property">insecure_skip_verify</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="3"><li>Restart your container runtime. For containerd, use the following command</li></ol> <p><code>systemctl restart containerd</code></p> <h3 id="pull-from-the-connected-registry-2"><a href="#pull-from-the-connected-registry-2" class="header-anchor">#</a> Pull from the Connected Registry</h3> <p>For more information, reference <a href="https://docs.microsoft.com/en-us/azure/container-registry/pull-images-from-connected-registry" target="_blank" rel="noopener noreferrer">Pull images from a connected registry<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <ol><li>Get credentials corresponding to a client token linked to the connected registry. For more information, see <a href="https://docs.microsoft.com/en-us/azure/container-registry/overview-connected-registry-access#manage-client-tokens" target="_blank" rel="noopener noreferrer">Manage client tokens<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. The following example generates <code>password1</code> for token <em>pulluser</em> and registry <em>contosoregistry</em>.</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>TOKEN_PWD=$(az acr token credential generate \
  --name pulluser --registry contosoregistry --expiration-in-days 30 \
  --password1 --query 'passwords[0].value' --output tsv)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="2"><li>Create a secret with client token credentials. This client token must be linked to your connected registry. For more information, see <a href="https://docs.microsoft.com/en-us/azure/container-registry/overview-connected-registry-access#manage-client-tokens" target="_blank" rel="noopener noreferrer">Manage client tokens<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</li></ol> <p><code>kubectl create secret docker-registry regcred --docker-server=&lt;service IP&gt;:80 --docker-username=jeburkeclient --docker-password=&lt;insert TOKEN_PWD&gt; --docker-email=someemail</code></p> <ol start="3"><li>Create a deployment that pulls from the connected registry over HTTP.</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>	cat &lt;&lt;EOF | kubectl apply -f -
	apiVersion: apps/v1
	kind: Deployment
	metadata:
	  name: hello-world-deployment
	  namespace: default
	  labels:
	    app.kubernetes.io/name: &quot;connected-registry&quot;
	spec:
	  replicas: 3
	  selector:
	    matchLabels:
	      app.kubernetes.io/name: &quot;connected-registry&quot;
	  template:
	    metadata:
	      labels:
	        app.kubernetes.io/name: &quot;connected-registry&quot;
	    spec:
	      containers:
	       - name: hello-world
	         image: &lt;service IP&gt;:80/hello-world:v1
	      imagePullSecrets:
	       - name: regcred
EOF
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><ol start="4"><li>Run <code>kubectl get pods</code> and see your hello-world image was pulled from the connected registry.</li></ol> <h2 id="uninstall-connected-registry"><a href="#uninstall-connected-registry" class="header-anchor">#</a> Uninstall Connected Registry</h2> <ol><li>To simulate delete of all resources deployed in the helm release with name &quot;connected-registry&quot;, run</li></ol> <p><code>helm uninstall connected-registry --dry-run</code></p> <ol start="2"><li>To delete all resources deployed in the helm release with name &quot;connected-registry&quot;, run</li></ol> <p><code>helm uninstall connected-registry</code></p> <ol start="3"><li>Deactivate your connected registry resource before deploying it again.</li></ol> <p><code>az acr connected-registry deactivate -r contosoregistry -n myconnectedregistry</code></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/azure/acr/edit/master/docs/preview/connected-registry/quickstart-deploy-connected-registry-kubernetes.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/acr/assets/js/app.3ca3959d.js" defer></script><script src="/acr/assets/js/2.4abe739f.js" defer></script><script src="/acr/assets/js/36.9f898214.js" defer></script>
  </body>
</html>
