<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Token with Basic Auth | Azure Container Registry</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/acr/assets/css/0.styles.1adce09e.css" as="style"><link rel="preload" href="/acr/assets/js/app.3ca3959d.js" as="script"><link rel="preload" href="/acr/assets/js/2.4abe739f.js" as="script"><link rel="preload" href="/acr/assets/js/16.28bd344b.js" as="script"><link rel="prefetch" href="/acr/assets/js/10.080d8072.js"><link rel="prefetch" href="/acr/assets/js/11.a8cae62e.js"><link rel="prefetch" href="/acr/assets/js/12.e62ede07.js"><link rel="prefetch" href="/acr/assets/js/13.88956df0.js"><link rel="prefetch" href="/acr/assets/js/14.da996b77.js"><link rel="prefetch" href="/acr/assets/js/15.128615bf.js"><link rel="prefetch" href="/acr/assets/js/17.3154ce14.js"><link rel="prefetch" href="/acr/assets/js/18.1a01df13.js"><link rel="prefetch" href="/acr/assets/js/19.d6cd2dad.js"><link rel="prefetch" href="/acr/assets/js/20.3cb003a6.js"><link rel="prefetch" href="/acr/assets/js/21.b60fd558.js"><link rel="prefetch" href="/acr/assets/js/22.7d86dba4.js"><link rel="prefetch" href="/acr/assets/js/23.dd656471.js"><link rel="prefetch" href="/acr/assets/js/24.e228cfdd.js"><link rel="prefetch" href="/acr/assets/js/25.197c3531.js"><link rel="prefetch" href="/acr/assets/js/26.29caa7ed.js"><link rel="prefetch" href="/acr/assets/js/27.fb8da073.js"><link rel="prefetch" href="/acr/assets/js/28.6e4543d4.js"><link rel="prefetch" href="/acr/assets/js/29.a76509db.js"><link rel="prefetch" href="/acr/assets/js/3.f910cf4c.js"><link rel="prefetch" href="/acr/assets/js/30.994ccbbb.js"><link rel="prefetch" href="/acr/assets/js/31.f2c11b52.js"><link rel="prefetch" href="/acr/assets/js/32.840e79d8.js"><link rel="prefetch" href="/acr/assets/js/33.2df67567.js"><link rel="prefetch" href="/acr/assets/js/34.e38730f2.js"><link rel="prefetch" href="/acr/assets/js/35.46229160.js"><link rel="prefetch" href="/acr/assets/js/36.9f898214.js"><link rel="prefetch" href="/acr/assets/js/37.9c3a93a2.js"><link rel="prefetch" href="/acr/assets/js/38.2cbce8d9.js"><link rel="prefetch" href="/acr/assets/js/39.f4bfa261.js"><link rel="prefetch" href="/acr/assets/js/4.1d1d93b6.js"><link rel="prefetch" href="/acr/assets/js/40.bc1f46d1.js"><link rel="prefetch" href="/acr/assets/js/41.2dbb6a30.js"><link rel="prefetch" href="/acr/assets/js/42.84fa6a12.js"><link rel="prefetch" href="/acr/assets/js/43.428cb1ec.js"><link rel="prefetch" href="/acr/assets/js/44.3b6b967d.js"><link rel="prefetch" href="/acr/assets/js/45.fd0d1d9e.js"><link rel="prefetch" href="/acr/assets/js/46.19cb06fd.js"><link rel="prefetch" href="/acr/assets/js/47.8c0d7628.js"><link rel="prefetch" href="/acr/assets/js/48.619e29e6.js"><link rel="prefetch" href="/acr/assets/js/49.3ba8bd2c.js"><link rel="prefetch" href="/acr/assets/js/5.943fad70.js"><link rel="prefetch" href="/acr/assets/js/50.0c02f626.js"><link rel="prefetch" href="/acr/assets/js/51.b822281a.js"><link rel="prefetch" href="/acr/assets/js/52.9a8a029d.js"><link rel="prefetch" href="/acr/assets/js/53.57ca9884.js"><link rel="prefetch" href="/acr/assets/js/54.86e09cf3.js"><link rel="prefetch" href="/acr/assets/js/55.21039511.js"><link rel="prefetch" href="/acr/assets/js/56.b6f67eae.js"><link rel="prefetch" href="/acr/assets/js/57.0266cf09.js"><link rel="prefetch" href="/acr/assets/js/58.249e8925.js"><link rel="prefetch" href="/acr/assets/js/59.a2f8607d.js"><link rel="prefetch" href="/acr/assets/js/6.c89b0c48.js"><link rel="prefetch" href="/acr/assets/js/60.f13d2f1c.js"><link rel="prefetch" href="/acr/assets/js/7.cf63200c.js"><link rel="prefetch" href="/acr/assets/js/8.9e525704.js"><link rel="prefetch" href="/acr/assets/js/9.b9ebe781.js">
    <link rel="stylesheet" href="/acr/assets/css/0.styles.1adce09e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/acr/" class="home-link router-link-active"><img src="/acr/files/acr.svg" alt="Azure Container Registry" class="logo"> <span class="site-name can-hide">Azure Container Registry</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/azure/acr" target="_blank" rel="noopener noreferrer" class="repo-link">
    Star this Repo
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/azure/acr" target="_blank" rel="noopener noreferrer" class="repo-link">
    Star this Repo
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/acr/" aria-current="page" class="sidebar-link">Overview</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acr/#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/acr/#blog-posts" class="sidebar-link">Blog posts</a></li><li class="sidebar-sub-header"><a href="/acr/#links" class="sidebar-link">Links</a></li></ul></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Teleport</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Tasks</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Authentication</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/acr/AAD-OAuth.html" class="sidebar-link">AAD Integration</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acr/AAD-OAuth.html#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/acr/AAD-OAuth.html#authenticating-to-a-registry-with-azure-cli" class="sidebar-link">Authenticating to a registry with Azure CLI</a></li><li class="sidebar-sub-header"><a href="/acr/AAD-OAuth.html#listing-a-repository-with-azure-cli" class="sidebar-link">Listing a repository with Azure CLI</a></li><li class="sidebar-sub-header"><a href="/acr/AAD-OAuth.html#calling-post-oauth2-exchange-to-get-an-acr-refresh-token" class="sidebar-link">Calling POST /oauth2/exchange to get an ACR refresh token</a></li><li class="sidebar-sub-header"><a href="/acr/AAD-OAuth.html#authenticating-docker-with-an-acr-refresh-token" class="sidebar-link">Authenticating docker with an ACR refresh token</a></li><li class="sidebar-sub-header"><a href="/acr/AAD-OAuth.html#calling-post-oauth2-token-to-get-an-acr-access-token" class="sidebar-link">Calling POST /oauth2/token to get an ACR access token</a></li><li class="sidebar-sub-header"><a href="/acr/AAD-OAuth.html#calling-post-oauth2-token-to-get-an-acr-access-token-for-helm-repository" class="sidebar-link">Calling POST /oauth2/token to get an ACR access token for Helm repository</a></li><li class="sidebar-sub-header"><a href="/acr/AAD-OAuth.html#calling-an-azure-container-registry-api" class="sidebar-link">Calling an Azure Container Registry API</a></li><li class="sidebar-sub-header"><a href="/acr/AAD-OAuth.html#samples-api-call-scripts" class="sidebar-link">Samples API Call scripts</a></li></ul></li><li><a href="/acr/Token-BasicAuth.html" aria-current="page" class="active sidebar-link">Token with Basic Auth</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acr/Token-BasicAuth.html#using-the-token-api" class="sidebar-link">Using the token API</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Integration</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="azure-container-registry-s-support-of-getting-bearer-token-using-basic-authentication"><a href="#azure-container-registry-s-support-of-getting-bearer-token-using-basic-authentication" class="header-anchor">#</a> Azure Container Registry's support of getting Bearer token using Basic Authentication</h1> <p>The Azure Container Registry supports both Basic Authentication and OAuth2 for getting a registry Bearer token. This document describes how to get a Bearer token using Basic Authentication. To get the token using OAuth2, please refer to the <a href="https://github.com/Azure/acr/blob/master/docs/AAD-OAuth.md" target="_blank" rel="noopener noreferrer">AAD-OAuth doc<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="using-the-token-api"><a href="#using-the-token-api" class="header-anchor">#</a> Using the token API</h2> <p>ACR has implemented the GET method on the token endpoint for user to retrieve a Bearer token using Basic Authentication:</p> <p>GET /oauth2/token</p> <h3 id="get-the-scope-of-the-token-to-be-requested"><a href="#get-the-scope-of-the-token-to-be-requested" class="header-anchor">#</a> Get the scope of the token to be requested</h3> <p>The first thing you want is to obtain an authentication challenge for the operation you want to on the Azure Container Registry. That can be done by targetting the API you want to call without any authentication. Here's how to do that via <code>curl</code>:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">registry</span><span class="token operator">=</span><span class="token string">&quot;contosoregistry.azurecr.io&quot;</span>
<span class="token function">curl</span> -v https://<span class="token variable">$registry</span>/v2/hello-world/manifests/latest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Note that <code>curl</code> by default does the request as a <code>GET</code> unless you specify a different verb with the <code>-X</code> modifier.</p> <p>This will output the following payload, with <code>...</code> used to shorten it for illustrative purposes:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token operator">&lt;</span> HTTP/1.1 <span class="token number">401</span> Unauthorized
<span class="token punctuation">..</span>.
<span class="token operator">&lt;</span> Www-Authenticate: Bearer <span class="token assign-left variable">realm</span><span class="token operator">=</span><span class="token string">&quot;https://contosoregistry.azurecr.io/oauth2/token&quot;</span>,service<span class="token operator">=</span><span class="token string">&quot;contosoregistry.azurecr.io&quot;</span>,scope<span class="token operator">=</span><span class="token string">&quot;repository:hello-world:pull&quot;</span>
<span class="token punctuation">..</span>.
<span class="token punctuation">{</span><span class="token string">&quot;errors&quot;</span>:<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;code&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;UNAUTHORIZED&quot;</span>,<span class="token string">&quot;message&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;authentication required&quot;</span>,<span class="token string">&quot;detail&quot;</span>:<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;Type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;repository&quot;</span>,<span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;hello-world&quot;</span>,<span class="token string">&quot;Action&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;pull&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Notice the response payload has a header called <code>Www-Authenticate</code> that gives us the following information:</p> <ul><li>The type of challenge: <code>Bearer</code>.</li> <li>The realm of the challenge: <code>https://contosoregistry.azurecr.io/oauth2/token</code>.</li> <li>The service of the challenge: <code>contosoregistry.azurecr.io</code>.</li> <li>The scope of the challenge: <code>repository:hello-world:pull</code>.</li></ul> <p>The body of the payload might provide additional details, but all the information you need is contained in the <code>Www-Authenticate</code> header.</p> <p>With this information we're now ready to call <code>GET /oauth2/token</code> to obtain an ACR access token that will allow us to use the <code>GET /v2/hello-world/manifests/latest</code> API.</p> <h3 id="encode-the-username-and-password"><a href="#encode-the-username-and-password" class="header-anchor">#</a> Encode the username and password</h3> <ul><li>You can use Windows Powershell or <code>base64</code> command line utility in Linux/Mac
<ul><li>Encode using the following format: <strong>[username]</strong>:<strong>[password]</strong></li> <li>Powershell:
<ul><li><code>[convert]::ToBase64String([Text.Encoding]::UTF8.GetBytes('[username]:[password]'))</code></li></ul></li> <li>Linux/Mac Terminal:
<ul><li><code>echo -n '[username]:[password]' | base64</code></li></ul></li> <li>Copy the encoded value and set it as a environment variable</li></ul></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">acr_credential</span><span class="token operator">=</span><span class="token string">&quot;xxxxxxx&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="get-a-pull-access-token-for-the-user"><a href="#get-a-pull-access-token-for-the-user" class="header-anchor">#</a> Get a Pull access token for the user</h3> <p><strong>REST format:</strong> <code>https://</code><strong>[login-url]</strong><code>/oauth2/token?service=</code><strong>[login-url]</strong><code>&amp;scope=repository:</code><strong>[image]</strong><code>:pull,push</code></p> <p>Set the header for Authorization, setting the 'Basic' word followed by a space and the encoded usr:pwd value</p> <div class="language- extra-class"><pre><code>|Header | Value |
|-------|-------|
| Authorization | Basic [base64 encoded usr:pwd] |
| Host | [login-url] |
</code></pre></div><p>Here's how such a call looks when done via <code>curl</code>:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">registry</span><span class="token operator">=</span><span class="token string">&quot;contosoregistry.azurecr.io&quot;</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">scope</span><span class="token operator">=</span><span class="token string">&quot;repository:hello-world:pull&quot;</span>
<span class="token function">curl</span> -v -H <span class="token string">&quot;Authorization: Basic <span class="token variable">$acr_credential</span>&quot;</span> <span class="token punctuation">\</span>
<span class="token string">&quot;https://<span class="token variable">$registry</span>/oauth2/token?service=<span class="token variable">$registry</span>&amp;scope=<span class="token variable">$scope</span>&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>The outcome of this operation will be a response with status 200 OK and a body with the following JSON payload:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;access_token&quot;</span><span class="token operator">:</span><span class="token string">&quot;eyJ...xcg&quot;</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>This response is the ACR access token which you can inspect with <a href="https://jwt.ms/" target="_blank" rel="noopener noreferrer">jwt.ms<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. You can now use it to call APIs exposed by the Azure Container Registry.</p> <h3 id="calling-an-azure-container-registry-api"><a href="#calling-an-azure-container-registry-api" class="header-anchor">#</a> Calling an Azure Container Registry API</h3> <p>In this example we'll call the <code>GET /v2/{repository}/manifests/{tag}</code> API on an Azure Container Registry. Assume you have the following:</p> <ol><li>A valid container registry, which here we'll call <code>contosoregistry.azurecr.io</code>.</li> <li>A valid ACR access token, created with the correct scope for the API we're going to call.</li></ol> <p>Here's how a call to the <code>GET /v2/hello-world/manifests/latest</code> API of the given registry would look like when done via <code>curl</code>:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">registry</span><span class="token operator">=</span><span class="token string">&quot;contosoregistry.azurecr.io&quot;</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">acr_access_token</span><span class="token operator">=</span><span class="token string">&quot;eyJ...xcg&quot;</span>
<span class="token function">curl</span> -v -H <span class="token string">&quot;Authorization: Bearer <span class="token variable">$acr_access_token</span>&quot;</span> https://<span class="token variable">$registry</span>/v2/hello-world/manifests/latest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>This should result in a status 200 OK.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/azure/acr/edit/master/docs/Token-BasicAuth.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/acr/AAD-OAuth.html" class="prev">
        AAD Integration
      </a></span> <span class="next"><a href="/acr/integration/change-analysis/">
        Change Analysis
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/acr/assets/js/app.3ca3959d.js" defer></script><script src="/acr/assets/js/2.4abe739f.js" defer></script><script src="/acr/assets/js/16.28bd344b.js" defer></script>
  </body>
</html>
